(function(e,a){var b={cmdWrapperDiv:"commandToolsWrapper",create:function(a){if("#"==a.charAt(0)){var d=a.substring(1,a.length);b.utility.canvasCalcOffset(d);return new b.main(a)}alert("there is a problem with canvas id")},main:function(c){b.main.children=[];b.main.id=0;b.main.uid=0;b.main.canvas=a.querySelector(c);b.main.canid=c.substring(1,c.length);b.main.currentTransform="";b.main.replayObjs=[];b.main.dragMode=!1;b.main.scaleMode=!1;b.main.usrCurrAction="";b.main.currObj="";b.main.textObj=!1;
b.main.action="create";b.wb={};b.wb.sentPack=!1;b.activMouse=new b.mouse;b.activMouse.init()},extend:function(b,d){if("object"==typeof b&&"object"==typeof d){for(var a in d)b[a]=d[a];return b}alert("it seems that the arguments you passed are not object")},transform:function(b,d){b.translate(d.x,d.y);b.rotate(d.theta);b.scale(d.scaleX*(d.flipX?-1:1),d.scaleY*(d.flipY?-1:1))},getStates:function(a){return b.main[a]},setValInMain:function(a,d){return b.main[a]=d},ArrayIndexOf:function(b,d){if(!d||"function"!=
typeof d||!b||!b.length||1>b.length)return-1;for(var a=0;a<b.length;a++)if(d(b[a]))return a;return-1},renderAll:function(a){var d=b.main.children.length;"object"!=typeof a&&(a=b.main.canvas.getContext("2d"));b.clearContext(a);if(d)for(var f=0;f<d;++f)"freeDrawing"==b.main.children[f].type?b.fhdRender(a,b.main.children[f]):b.render(a,b.main.children[f])},clearContext:function(a){var d=b.main.canvas;a.clearRect(0,0,d.width,d.height);return d},deactivateAll:function(){for(var a=b.main.children,d=0,f=
a.length;d<f;d++)a[d].setActive(!1)},makeDispObject:function(b){return{coreObj:b,bind:function(d,b){this.addEventListener("on"+d,b)}}},remove:function(a){var d=b.main.canvas,f=b.ArrayIndexOf(b.main.children,function(d){return d.id==a.id&&(d.mt==a.mt||!0==a.multiuser)});0<=f&&b.main.children.splice(f,1);var f=d.height,h=d.width,d=d.getContext("2d");d.beginPath();d.clearRect(0,0,h,f);d.closePath();b.renderAll()},render:function(a,d,f){a.beginPath();a.save();a.lineWidth=void 0!==a.lineWidth?d.lineWidth:
2;f||b.transform(a,d);a.strokeStyle=void 0!=d.borderColor?d.borderColor:"#000000";"rectangle"==d.type?b.objRect.draw(a,d,f):"line"==d.type?b.objLine.draw(a,d,f):"oval"==d.type?b.objOval.draw(a,d,f):"triangle"==d.type?b.objTri.draw(a,d,f):"text"==d.type&&b.objTxt.draw(a,d,f);d.active&&!f&&(d.drawBorders(a),d.hideCorners||d.drawCorners(a));a.closePath();a.restore()},fhdRender:function(a,d,f){a.save();var h=d.transformMatrix;h&&a.transform(h[0],h[1],h[2],h[3],h[4],h[5]);f||b.transform(a,d);d.overlayFill?
a.fillStyle=d.overlayFill:d.fill&&(a.fillStyle=d.fill);d.stroke&&(a.strokeStyle=d.stroke);a.beginPath();var g;g=h=0;for(var n=-(d.width/2),e=-(d.height/2),l=0,k=d.path.length;l<k;++l)switch(g=d.path[l],g[0]){case "L":h=g[1];g=g[2];a.lineTo(h+n,g+e);break;case "M":h=g[1],g=g[2],a.moveTo(h+n,g+e)}d.fill&&a.fill();d.stroke&&(a.strokeStyle=d.stroke,a.lineWidth=d.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!f&&d.active&&(d.drawBorders(a),d.hideCorners||d.drawCorners(a));a.restore()},makeStackObj:function(a,
d,b,h){return{mt:a,ac:d,x:b,y:h}}};e.vcan=b})(window,document);(function(e,a){e.whiteboard=function(b){var c=b.hasOwnProperty("id")?b.id:"appWhitebaordCont";b=b.hasOwnProperty("class");return{id:c,classes:b,tool:"",obj:{},prvObj:"",replayTime:0,sentPackets:0,sentPackDiv:"sentPacket",sentPackDivPS:"sentPacketPS",receivedPackets:0,receivedPackDiv:"receivedNumber",receivedPackDivPS:"receivedNumberPS",uid:0,lt:"",commandToolsWrapperId:"commandToolsWrapper",view:{},lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],virtualWindow:!1},
init:function(){vApp.wb.vcan=e.vcan;var d=vApp.wb.vcan;vApp.wb.canvas=d.create("#canvas");d=d.main.canvas;d.setAttribute("tabindex","0");d.focus();d.onkeydown=vApp.wb.utility.keyOperation;vApp.system.setCanvasDimension();"undefined"!==typeof Storage&&(e.vApp.wb=vApp.wb);this.arrowInit();var b=vApp.wb.sentPackets;vApp.clear2=setInterval(function(){null!=a.getElementById(vApp.wb.sentPackDivPS)&&(b=vApp.wb.utility.calcPsSentPackets(b),a.getElementById(vApp.wb.sentPackDiv).innerHTML=vApp.wb.sentPackets)},
1E3);this._init()},_init:function(){vApp.vutil.chkValueInLocalStorage("orginalTeacherId")?vApp.wb.pageEnteredTime=localStorage.getItem("pageEnteredTime"):(vApp.wb.pageEnteredTime=(new Date).getTime(),localStorage.setItem("pageEnteredTime",vApp.wb.pageEnteredTime));vApp.wb.oTeacher=vApp.vutil.chkValueInLocalStorage("orginalTeacherId");vApp.vutil.chkValueInLocalStorage("rcvdPackId")?vApp.wb.gObj.rcvdPackId=parseInt(localStorage.rcvdPackId):vApp.wb.gObj.rcvdPackId=0;e.addEventListener("resize",vApp.wb.utility.lockCanvas);
e.addEventListener("click",function(){vApp.wb.view.disappearBox("WebRtc");vApp.wb.view.disappearBox("Canvas");vApp.wb.view.disappearBox("drawArea")});var d=vApp.vutil.chkValueInLocalStorage("reclaim");this.stHasTeacher=vApp.vutil.chkValueInLocalStorage("teacherId");vApp.wb.utility.setUserStatus(this.stHasTeacher,d);if(vApp.vutil.chkValueInLocalStorage("reclaim")){d=a.getElementById(vApp.wb.commandToolsWrapperId);if(null!=d)for(;d.hasChildNodes();)d.removeChild(d.lastChild);vApp.wb.utility.createReclaimButton(d)}vApp.wb.utility.crateCanvasDrawMesssage()},
arrowInit:function(){this.arrImg=new Image;this.arrImg.src="undefined"!=typeof e.whiteboardPath?e.whiteboardPath+"/images/arrow.png":"/images/arrow.png";this.arrImgDraw=!1;var d=this;this.arrImg.onload=function(){d.arrImgDraw=!0}},createCommand:function(){if(vApp.wb.utility.alreadyExistToolBar())return!0;var d=a.createElement("div");d.id=vApp.wb.commandToolsWrapperId;var b=a.getElementById(vcan.canvasWrapperId);null!=b?a.getElementById("containerWb").insertBefore(d,b):a.getElementById("containerWb").appendChild(d);
vApp.wb.createDiv("t_rectangle","rectangle",d,"tool");vApp.wb.createDiv("t_line","line",d,"tool");vApp.wb.createDiv("t_freeDrawing","freeDrawing",d,"tool");vApp.wb.createDiv("t_oval","oval",d,"tool");vApp.wb.createDiv("t_triangle","triangle",d,"tool");vApp.wb.createDiv("t_text","text",d,"tool");vApp.wb.createDiv("t_activeall","activeAll",d,"tool");vApp.wb.createDiv("t_clearall","clearAll",d,"tool");vApp.wb.createDiv("t_replay","Replay",d,"tool");vApp.wb.socketOn=parseInt(wbUser.socketOn);1==vApp.wb.socketOn&&
vApp.wb.utility.setClass("vcanvas","socketon")},createDiv:function(d,b,c,g){var n=a.createElement("a");n.href="#";var m=a.createElement("div");m.id=d;"undefined"!=typeof g&&(m.className=g);d=a.createElement("img");d.alt=vApp.lang.getString(b);d.src="undefined"!=typeof e.whiteboardPath?e.whiteboardPath+"/images/"+b+".png":"/images/"+b+".png";n.appendChild(d);n.title="";n.dataset.title=b;n.className="tooltip";m.appendChild(n);c.appendChild(m);a.getElementById(vcan.canvasWrapperId)},createCanvas:function(){var d=
a.createElement("div");d.id=vcan.canvasWrapperId;vcan.canvasWrapperId=d.id;var b=a.createElement("canvas");b.id="canvas";b.innerHTML="Canvas is missing in your browsers. Please update the latest version of your browser";d.appendChild(b);a.getElementById("containerWb").appendChild(d)},objInit:function(d){"t_replay"==this.parentNode.id?(vApp.wb.utility.clearAll(!1),vApp.wb.utility.beforeSend({replayAll:!0})):vApp.wb.toolInit(this.parentNode.id);"t_replay"!=this.parentNode.id&&"t_clearall"!=this.parentNode.id&&
"t_reclaim"!=this.parentNode.id&&"t_assign"!=this.parentNode.id&&(d=(new Date).getTime(),vApp.wb.lt=this.parentNode.id,d={cmd:this.parentNode.id,mt:d},vApp.wb.uid++,d.uid=vApp.wb.uid,vcan.main.replayObjs.push(d),vApp.storage.wholeStore(d),vApp.wb.utility.beforeSend({repObj:[d]}))},attachToolFunction:function(d,b){vcan.canvasWrapperId="canvasWrapper";vApp.wb.createCommand(b);if("undefined"==typeof b){null==a.getElementById("canvas")&&vApp.wb.createCanvas();var c=vApp.vutil.chkValueInLocalStorage("orginalTeacherId");
vApp.wb.dataInfo=parseInt(wbUser.dataInfo);c&&1==vApp.wb.dataInfo&&!vApp.wb.utility.alreadyExistPacketContainer()&&(vApp.wb.packContainer.createPacketContainer(),vApp.wb.packContainer.createPacketInfoContainer(),vApp.wb.utility.initStoredPacketsNumbers())}for(var c=a.getElementById(d).getElementsByTagName("div"),g=0;g<c.length;g++)c[g].getElementsByTagName("a")[0].addEventListener("click",vApp.wb.objInit)},toolInit:function(d,b,a,c){"object"==typeof vApp.wb.obj.drawTextObj&&!0==vApp.wb.obj.drawTextObj.wmode&&
vcan.main.canvas.getContext("2d");0<vApp.wb.vcan.getStates("children").length&&"t_clearall"!=d&&("undefined"!=typeof a&&"t_replay"==d||vApp.wb.utility.deActiveFrmDragDrop(),!0!=a&&"t_replay"!=d&&vApp.wb.vcan.renderAll());vApp.wb.utility.IsObjEmpty(vApp.wb.obj.freeDrawObj&&!1==a)||(vApp.wb.obj.freeDrawObj.freesvg=!1);vApp.wb.vcan.main.currUserCommand=d+"Init";"t_activeall"==d&&vApp.wb.utility.t_activeallInit();"t_replay"==d&&("undefined"==typeof a&&vcan.setValInMain("id",0),"undefined"!=typeof c?vApp.wb.t_replayInit(b,
c):vApp.wb.t_replayInit(b));if("t_clearall"==d){if(!confirm(vApp.lang.getString("clearAllWarnMessage")))return;vApp.wb.utility.t_clearallInit();vApp.wb.utility.makeDefaultValue();vApp.storage.clearStorageData();vApp.wb.utility.beforeSend({clearAll:!0})}"t_assign"==d&&(vApp.wb.utility.assignRole(),b=localStorage.getItem("toolHeight"),null!=b?vApp.wb.utility.beforeSend({assignRole:!0,toolHeight:b,socket:vApp.wb.socketOn}):vApp.wb.utility.beforeSend({assignRole:!0,socket:vApp.wb.socketOn}));"t_reclaim"==
d&&(vApp.wb.utility.reclaimRole(),vApp.wb.utility.sendRequest("reclaimRole",!0));"t_activeall"!=d&&"t_replay"!=d&&"t_clearallInit"!=d&&"t_assign"!=d&&"t_reclaim"!=d&&(vApp.wb.tool=new vApp.wb.tool_obj(d),vApp.wb.utility.attachEventHandlers())},tool_obj:function(d){this.cmd=d;"t_freeDrawing"!=d&&(vApp.wb.obj.freeDrawObj="");"t_text"!=d&&(vApp.wb.obj.drawTextObj="");"t_freeDrawing"==d?(vApp.wb.obj.freeDrawObj=new vApp.wb.readyFreeHandObj("#424240","3"),vApp.wb.obj.freeDrawObj.init()):"t_text"==d&&(vApp.wb.obj.drawTextObj=
new vApp.wb.readyTextObj,vApp.wb.obj.drawTextObj.init("canvasWrapper"));d=d.slice(2,d.length);vApp.wb.draw_object(d,vApp.wb.canvas,this)},t_replayInit:function(d,b){"fromFile"==d?(vApp.gObj.chat.removeAllChat(),vApp.wb.recordAudio=!0,vApp.recorder.init()):(vApp.wb.replay=vApp.wb._replay(),"undefined"!=typeof b?(vApp.wb.replay.init(d,b),vApp.wb.replay.renderObj(b)):(vApp.wb.replay.init(d),vApp.wb.replay.renderObj()))}}}})(window,document);(function(e){e.utility=function(){return{userIds:[],isObjExistRE:function(a){if(0<=vApp.wb.replay.removeElements.length){var b=vApp.wb.vcan.ArrayIndexOf(vApp.wb.replay.removeElements,function(b){return b.id==a.id});if(0<=b)return b}},IsObjEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},stringToNumber:function(a){" "==a[a.length-1]&&(a=a.substring(0,a.length-1));return a=Number(a)},clickOutSidebox:function(a){return 1!=a%2?!0:!1},keyOperation:function(a){var b=(new Date).getTime();
if(8==a.keyCode&&(a=vApp.wb.vcan,""!=a.main.currObj)){vApp.wb.canvas.removeObject(a.main.currObj);var c=a.extend({},a.main.currObj),c=a.extend(c,{mt:b,func:"remove",usrCurrAction:"delete",lastElement:!0});a.main.replayObjs.push(c);a.main.currObj=""}},attachEventHandlers:function(){vApp.wb.canvas.bind("mousedown",vApp.wb.utility.ev_canvas);vApp.wb.canvas.bind("mousemove",vApp.wb.utility.ev_canvas);vApp.wb.canvas.bind("mouseup",vApp.wb.utility.ev_canvas)},t_clearallInit:function(){vApp.wb.utility.clearAll(!0)},
clearAll:function(a,b){vApp.wb.uid=0;vApp.wb.lt="";for(var c=vApp.wb.vcan;0<c.main.children.length;)vApp.wb.canvas.removeObject(c.main.children[0]);!0==a&&c.main.replayObjs.splice(0,c.main.replayObjs.length);void 0!=vApp.wb.replay&&(vApp.wb.replay.objNo=0);"move"==c.getStates("action")&&c.setValInMain("action","create");c=document.getElementById("sendPackCont");if(null!=c){var d=c.getElementsByClassName("numbers");if(0<d.length)for(c=0;c<d.length;c++)d[c].innerHTML=0}"undefined"==typeof b&&(vApp.wb.sentPackets=
0,vApp.wb.receivedPackets=0);c=document.getElementById("sentMsgInfo");null!=c&&(c.innerHTML="");c=document.getElementById("rcvdMsgInfo");null!=c&&(c.innerHTML="");d=document.getElementsByClassName("textBoxContainer");for(c=0;c<d.length;c++)d[c].parentNode.removeChild(d[c])},deActiveFrmDragDrop:function(){var a=vApp.wb.vcan,b=a.main.children;if("move"==a.getStates("action")){a.setValInMain("action","create");for(a=0;a<b.length;a++)b[a].dragDrop(!1),b[a].setActive(!1);return!0}return!1},getOffset:function(a){for(var b=
a.target,c=y=0;b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop);)c+=b.offsetLeft-b.scrollLeft,y+=b.offsetTop-b.scrollTop,b=b.offsetParent;c=a.clientX-c;y=a.clientY-y;return{x:c,y:y}},ev_canvas:function(a){var b=vApp.wb.vcan.utility.getReltivePoint(a);a.currX=b.x;a.currY=b.y;if(b=vApp.wb.tool[a.type])return b(a),this.ev_canvas},t_activeallInit:function(){var a=vApp.wb.vcan,b=a.getStates("children");if(1<=b.length)for(a.setValInMain("action","move"),a=0;a<b.length;a++)b[a].dragDrop(!0)},drawArrowImg:function(a,
b){var c=vApp.wb.vcan.main.canvas.getContext("2d");c.clearRect(0,0,vApp.wb.vcan.main.canvas.width,vApp.wb.vcan.main.canvas.height);vcan.renderAll();c.save();c.beginPath();c.translate(b.mp.x,b.mp.y);c.drawImage(a,-3,-3,18,24);c.closePath();c.restore()},calcPsSentPackets:function(a){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId"))return a=vApp.wb.sentPackets-a,0>a&&(a=0),document.getElementById(null!=vApp.wb.sentPackDivPS)&&(document.getElementById(vApp.wb.sentPackDivPS).innerHTML=a),vApp.wb.sentPackets},
calcPsRecvdPackets:function(a){a=vApp.wb.receivedPackets-a;0>a&&(a=0);null!=document.getElementById(vApp.wb.receivedPackDivPS)&&(document.getElementById(vApp.wb.receivedPackDivPS).innerHTML=a);return vApp.wb.receivedPackets},initStoredPacketsNumbers:function(){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId")){if(localStorage.sentPackets){var a=JSON.parse(localStorage.sentPackets);vApp.wb.sentPackets=a;null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=
a)}localStorage.receivedPackets&&(vApp.wb.receivedPackets=JSON.parse(localStorage.receivedPackets),null!=document.getElementById(vApp.wb.receivedPackDiv)&&(document.getElementById(vApp.wb.receivedPackDiv).innerHTML=vApp.wb.receivedPackets))}},updateSentPackets:function(a){1==vApp.wb.dataInfo&&vApp.vutil.chkValueInLocalStorage("orginalTeacherId")&&(vApp.wb.sentPackets+=JSON.stringify(a).length,null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=
vApp.wb.sentPackets))},assignRole:function(a){vApp.wb.tool="";"move"==vcan.main.action&&vApp.wb.utility.deActiveFrmDragDrop();if("undefined"!=typeof a){if(null!=localStorage.getItem("reclaim")){var b=document.getElementById(vApp.wb.commandToolsWrapperId);b.parentNode.removeChild(b);localStorage.removeItem("reclaim")}e.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv,!0);(vApp.wb.hasOwnProperty("canvasDisable")||vApp.wb.canvasDisable)&&vApp.wb.utility.toolWrapperDisable();localStorage.setItem("teacherId",
a);vApp.wb.utility.makeCanvasEnable()}else{b=document.getElementById(vApp.wb.commandToolsWrapperId);if(null!=b)for(;b.hasChildNodes();)b.removeChild(b.lastChild);vApp.wb.utility.makeCanvasDisable();"undefined"!=typeof localStorage.orginalTeacherId?(vApp.wb.utility.createReclaimButton(b),localStorage.setItem("reclaim",!0)):null!=b&&b.parentNode.removeChild(b);localStorage.removeItem("teacherId")}},reclaimRole:function(){vApp.wb.tool="";"move"==vcan.main.action&&vApp.wb.utility.deActiveFrmDragDrop();
vApp.wb.utility.removeToolBox();e.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv,!0);localStorage.teacherId=localStorage.orginalTeacherId;"undefined"!=typeof localStorage.reclaim&&localStorage.removeItem("reclaim");vApp.wb.utility.makeCanvasEnable()},dispQueuePacket:function(a){(null!=localStorage.getItem("teacherId")||null!=localStorage.getItem("orginalTeacherId")&&vApp.vutil.chkValueInLocalStorage("reclaim"))&&vApp.wb.utility.toolWrapperEnable();vApp.wb.drawMode=!1;null!=localStorage.getItem("teacherId")&&
vApp.wb.utility.makeCanvasEnable();0<vApp.wb.gObj.packQueue.length&&(e.vApp.wb.vcan.main.replayObjs=vApp.wb.gObj.packQueue,vApp.wb.gObj.packQueue=[],vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket))},updateRcvdInformation:function(a){var b=document.getElementById("rcvdMsgInfo");if(null!=b){var c="",d;for(d in a)c+=d+" : "+a[d]+" <br />";b.innerHTML=c}},makeCanvasDisable:function(){var a=vcan.main.canvas;a.style.position="relative";a.style.pointerEvents="none"},makeCanvasEnable:function(){null==
localStorage.getItem("teacherId")||vApp.wb.hasOwnProperty("canvasDisable")&&vApp.wb.canvasDisable||(vcan.main.canvas.style.pointerEvents="visible")},removeToolBox:function(){var a=document.getElementById(vcan.cmdWrapperDiv);a.parentNode.removeChild(a)},createReclaimButton:function(a){vApp.wb.createDiv("t_reclaim","reclaim",a);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",vApp.wb.objInit)},chkValueInLocalStorage:function(a){return null===localStorage.getItem(a)?
!1:localStorage[a]},uniqueArrOfObjsToStudent:function(){var a="";vApp.wb.gObj.replayObjs=[];for(var b=0;b<vcan.main.replayObjs.length;b++)a=vcan.extend({},vcan.main.replayObjs[b]),vApp.wb.gObj.replayObjs.push(a)},uniqueArrOfObjsToTeacher:function(){vcan.main.replayObjs=[];for(var a="",b=0;b<vApp.wb.gObj.replayObjs.length;b++)a=vcan.extend({},vApp.wb.gObj.replayObjs[b]),vcan.main.replayObjs.push(a)},makeDefaultValue:function(){vApp.wb.gObj.myrepObj=[];vApp.wb.gObj.replayObjs=[];vApp.wb.gObj.rcvdPackId=
0;vApp.wb.gObj.displayedObjId=0;vApp.wb.gObj.packQueue=[];vApp.wb.uid=0;var a=vApp.vutil.chkValueInLocalStorage("teacherId"),b=vApp.vutil.chkValueInLocalStorage("orginalTeacherId"),c=vApp.vutil.chkValueInLocalStorage("wbrtcMsg"),d=vApp.vutil.chkValueInLocalStorage("canvasDrwMsg"),f=vApp.vutil.chkValueInLocalStorage("toolHeight");localStorage.clear();vApp.recorder.items=[];vApp.gObj.video.audio.bufferSize=0;vApp.gObj.video.audio.encMode="alaw";vApp.gObj.video.audio.rec="";vApp.gObj.video.audio.audioNodes=
[];vApp.gObj.video.audio.initAudioNode();a&&localStorage.setItem("teacherId",a);b&&localStorage.setItem("orginalTeacherId",b);c&&localStorage.setItem("wbrtcMsg",c);d&&localStorage.setItem("canvasDrwMsg",d);f&&localStorage.setItem("toolHeight",f);"undefined"!=typeof vcan.objTxt&&vcan.objTxt.removeTextNode();"undefined"!=typeof vcan.main.currentTransform&&(vcan.main.currentTransform="");vApp.gObj.video.audio.updateInfo()},setOrginalTeacherContent:function(){localStorage.setItem("teacherId",vApp.gObj.uid);
e.vApp.wb.view.canvasDrawMsg("Canvas");localStorage.setItem("canvasDrwMsg",!0);vApp.wb.utility.alreadyExistPacketContainer()||1!=parseInt(wbUser.dataInfo,10)||(vApp.wb.packContainer.createPacketContainer(),vApp.wb.packContainer.createPacketInfoContainer(),vApp.wb.utility.initStoredPacketsNumbers());localStorage.setItem("orginalTeacherId",vApp.gObj.uid)},initDefaultInfo:function(a){"t"==a?null==localStorage.getItem("orginalTeacherId")&&(vApp.wb.utility.setOrginalTeacherContent(),e.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv,
!0)):"s"==a&&(vcan.studentId=wbUser.id,null==localStorage.getItem("studentId")&&localStorage.setItem("studentId",wbUser.id));vApp.gObj.video.init();vApp.gObj.video.isInitiator=!0;vcan.oneExecuted=!1},checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(a){vApp.wb.gObj.virtualWindow=!0;var b=document.createElement("div");vApp.wb.utility.removeVirtualWindow("virtualWindow");
b.setAttribute("id","virtualWindow");b.style.width=a.width+"px";if("undefined"!=typeof assignRoleAtStudent)var c=0;else c=parseInt(localStorage.getItem("toolHeight")),c=null!=c?c:0;null!=localStorage.getItem("orginalTeacherId")?b.style.height=a.height+c+"px":null!=localStorage.getItem("teacherId")?b.style.height=a.height+"px":b.style.height=a.height-c+"px";a=document.getElementById("containerWb");a.insertBefore(b,a.firstChild)},removeVirtualWindow:function(a){a=document.getElementById(a);null!=a&&
(vApp.wb.gObj.virtualWindow=!1,a.parentNode.removeChild(a))},getWideValueAppliedByCss:function(a,b){var c=document.getElementById(a);if(null!=c){var d=e.getComputedStyle(c);if("undefined"!=typeof d.marginTop){var f=parseInt(d.marginTop.match(/\d+/));null==f&&(f=0)}return c.clientHeight+f}return!1},isNumber:function(a){return isNaN(+a)?!1:+a},setCommandToolHeights:function(a,b){var c=document.getElementById("virtualWindow");if(null!=c){var d=parseInt(c.style.height.match(/\d+/));c.style.height="decrement"==
b?d-parseInt(a)+"px":d+parseInt(a)+"px"}},setClass:function(a,b){var c=document.getElementById(a),d=c.classList,f="";0<d.length&&(f=2>f.length?d[0]+" ":d.join(" ")+" ");c.setAttribute("class",f+b)},setStyleUserConnetion:function(a,b,c){a=document.getElementsByClassName(a)[0];null!=a&&a.setAttribute("class",b+" controlCmd")},existUserLikeMe:function(a){if(a.fromUser.userid!=wbUser.id){if(a.message.checkUser.hasOwnProperty("role")){var b=a.message.checkUser.role;if(b){if(null==localStorage.getItem("otherRole")){var c=
[];if(b!=vApp.gObj.uRole)c.push(b);else return existUser=!0}else c=JSON.parse(localStorage.getItem("otherRole")),-1==c.indexOf(b)&&c.push(b);"undefined"!=typeof c&&(localStorage.setItem("otherRole",JSON.stringify(c)),console.log("Other Browser "+b+" "+a.fromUser.userid))}return vApp.gObj.uRole==b?!0:!1}}else{if("undefined"!=typeof existUser)return!0;a=JSON.parse(localStorage.getItem("otherRole"));if(null!=a){for(b=0;b<a.length;b++)if(vApp.gObj.uRole==a[b])return!0;return!1}}},existUserWithSameId:function(a){this.userIds.push(a.fromUser.userid);
if(1<this.userIds.length&&vApp.wb.utility.arrayContainsSameValue(this.userIds[0],this.userIds))return!0},makeUserAvailable:function(){null==localStorage.getItem("repObjs")&&(vApp.wb.utility.toolWrapperEnable(),null!=vcan.main.canvas&&vApp.wb.utility.makeCanvasEnable())},displayCanvas:function(){e.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv);e.vApp.wb.init();vApp.wb.utility.makeCanvasDisable();vApp.wb.utility.toolWrapperDisable()},initAll:function(a){null!=localStorage.getItem("teacherId")&&vApp.wb.utility.makeCanvasDisable();
vApp.system.measureResoultion({width:e.outerWidth,height:e.innerHeight})},alreadyExistToolBar:function(){var a=document.getElementById("t_rectangle");if(null!=a)return 8<=a.parentNode.getElementsByClassName("tool").length?!0:!1},alreadyExistPacketContainer:function(){var a=document.getElementById("packetContainer"),b=document.getElementById("informationCont");return 2<=a.getElementsByTagName("div").length||1<=b.getElementsByTagName("div").length?!0:!1},toolWrapperDisable:function(){var a=document.getElementById("commandToolsWrapper");
null!=a&&(a.style.pointerEvents="none")},toolWrapperEnable:function(){var a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="visible")},replayFromLocalStroage:function(a){"undefined"!==typeof Storage&&(vApp.wb.vcan.main.replayObjs=a,vApp.wb.utility.clearAll(!1,"dontClear"),vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.concat(a),0<a.length&&(vApp.wb.uid=a[a.length-1].uid,vApp.wb.gObj.rcvdPackId=vApp.wb.uid,vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket)))},
setUserStatus:function(a,b){a||b?vApp.wb.utility.setClass("vcanvas","teacher"):(vApp.wb.utility.removeToolBox(),vApp.wb.utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage:function(){"undefined"!=typeof localStorage.teacherId&&null==localStorage.getItem("canvasDrwMsg")&&(e.vApp.wb.view.canvasDrawMsg("Canvas"),e.vApp.wb.view.drawLabel("drawArea"),localStorage.canvasDrwMsg=!0)},removeOtherUserExist:function(a){"t"==a?null!=localStorage.getItem("studentId")&&localStorage.removeItem("studentId"):
"s"==a&&null!=localStorage.getItem("orginalTeacherId")&&(localStorage.removeItem("orginalTeacherId"),null!=localStorage.getItem("teacherId")&&localStorage.removeItem("teacherId"),null!=localStorage.getItem("reclaim")&&localStorage.removeItem("reclaim"),vApp.wb.utility.removeToolBox())},canvasEnabelWhenRefresh:function(){null!=localStorage.getItem("teacherId")&&vApp.wb.utility.makeCanvasEnable()},arrayContainsSameValue:function(a,b){for(var c=0;c<b.length;c++)if(b[c]!==a)return!1;return!0},actionAfterRemovedUser:function(){vApp.wb.utility.makeCanvasDisable();
vApp.wb.utility.setStyleUserConnetion("con","coff");vApp.wb.utility.removeVirtualWindow("virtualWindow");vApp.wb.user.connected=!1;localStorage.removeItem("otherRole");"undefined"!=typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest:function(a,b){vApp.wb.utility.beforeSend({reclaimRole:!0})},updateSentInformation:function(a,b){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId")){var c=JSON.parse(a),c="undefined"!=typeof b?c:c.repObj[0],d="",f;for(f in c)d+=
f+" : "+c[f]+" <br />";null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=d)}},audioSend:function(a){1==io.sock.readyState&&io.sendBinary(a)},beforeSend:function(a){var b=JSON.stringify(a);a.hasOwnProperty("createArrow")?vApp.wb.vcan.optimize.sendPacketWithOptimization(b,io.sock.readyState,100):(vApp.wb.sentPackets+=b.length,1==io.sock.readyState&&io.send(a),JSON.parse(b).hasOwnProperty("repObj")&&vApp.wb.utility.updateSentInformation(b));localStorage.sentPackets=
vApp.wb.sentPackets},checkCanvasHasParents:function(){for(var a=document.getElementById("vcanvas");"BODY"!=a.parentNode.tagName;)"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding="0"),a=a.parentNode;"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding="0")},lockCanvas:function(){if(e.earlierWidth!=e.innerWidth&&(vApp.wb.canvasDisable=!0,vApp.wb.utility.makeCanvasDisable(),vApp.wb.utility.toolWrapperDisable(),null==document.getElementById("divForReloadMsg"))){var a=null!=localStorage.getItem("teacherId")?
"msgForReload":"msgStudentForReload";e.vApp.wb.view.displayMsgBox("divForReloadMsg",a);e.earlierWidth=e.innerWidth}},getElementRightOffSet:function(a){var b=20;null!=a.parentNode&&(a=a.parentNode,b=vcan.utility.getElementOffset(a),b=e.innerWidth-(a.clientWidth+(b.x-0)));return b},initUpdateInfo:function(a){a=vApp.wb.receivedPackets;setInterval(function(){null!=document.getElementById(vApp.wb.receivedPackDivPS)&&(a=vApp.wb.utility.calcPsRecvdPackets(a),document.getElementById(vApp.wb.receivedPackDiv).innerHTML=
vApp.wb.receivedPackets)},1E3)},objPutInContainer:function(a){vcan.main.replayObjs.push(a);vApp.storage.store(JSON.stringify(vcan.main.replayObjs))}}}})(window);(function(e){e.message={notSupportCanvas:'This browser does not support Canvas. Please update your browser with the latest versionFor more information about Canvas, click on the link given here <a href="http://en.wikipedia.org/wiki/Canvas_element/">Canvas</a>',notSupportGetUserMedia:'The browser does not support getUserMedia for webRtc. Please update your browser with the latest version For more information about getUuserMedia, click on the link given here <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">getUserMedia</a>',
notSupportPeerConnect:'The browser is unable to create Peer Connection object for WebRtc Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',notSupportWebSocket:'This browser does not support WebSocket. Please update your browser with the latest version. For more information about WebSocket, click on the link given here <a href="http://www.websocket.org/">WebSocket</a>.',notSupportWebRtc:'This browser does not support WebRTC. Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',
line:"Line",rectangle:"Rectangle",triangle:"Triangle",oval:"Oval",assign:"Assign",reclaim:"Reclaim",freeDrawing:"Free Drawing",text:"Text",replay:"Replay",activeAll:"Active All",clearAll:"Clear All",drawArea:"Draw Area",totRcvdPackets:"Total Received Packets",perSecRcvdData:"Per Second Recevied Packet",totSentPackets:"Total Sent Packets",perSecSentPacket:"Per Second Sent Packets",perSecond:"Per Second",sentPackets:"Sent <br/><span>Packets</span>",receviedPackets:"Received <br/><span>Pacekts</span>",
total:"Total",dataDetails:"Data Details",sentMessageInfo:"Sent Message <br/><span>Information</span>",receivedMessageInfo:"Received Message <br/><span>information</span>",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your microphone and camera with other users',wbrtcMsgChrome:"You can click on deny button for not sharing your microphone and camera with other users.or click on allow button to share your microphone and camera with other users.",canvasDrawMsg:"You can click on any tool to draw object with a mouse click, mouse move and mouse up in the Draw Area",
clearAllWarnMessage:"Would you like to clear all what you have drawn on the whiteboard, Once you clear the whiteboard, you will never get those drawn objects back.",cof:"connection off",askForConnect:"You will be able to perform this action only when other user get connected",msgForReload:"You will be unable to draw the objects after resizing the window. <br />  So, please reload the page for drawing. ",msgStudentForReload:"After resizing the window, there can be a problem over the drawn objects, <br />  So, please realod the page for better results ",
reload:"Reload"}})(window);(function(e){e.getString=function(a){return e.vApp.lang.message[a]}})(window);(function(e){var a={init:function(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage:function(b,a,d,f,h){b="undefined"==typeof h?this.createMsgBox(b,a,d):this.createMsgBox(b,a,d,h);a=document.getElementById("vcanvas");"undefined"!=typeof f?document.getElementById(f).appendChild(b):a.insertBefore(b,a.childNodes[0])},customCreateElement:function(b,a,d){b=document.createElement(b);"undefined"!=typeof a&&(b.id=a);"undefined"!=typeof d&&(b.className=d);return b},
createMsgBox:function(a,c,d,f){var h=this.customCreateElement("div",c,d);"undefined"==typeof f&&(d=this.customCreateElement("div",c+"img",d+"img"),h.appendChild(d));c=this.customCreateElement("p",c+"Para");c.innerHTML=a;h.appendChild(c);return h},disappearBox:function(a){a=document.getElementsByClassName(this.msgBoxClass+a);null!=a[0]&&a[0].parentNode.removeChild(a[0])},multiMediaMsg:function(a){if("Firefox"==vApp.system.mybrowser.name){var c=vApp.lang.getString("wbrtcMsgFireFox");this.displayMessage(c,
"fireFoxWebrtcCont",this.msgBoxClass+a)}else"Chrome"==vApp.system.mybrowser.name&&(c=vApp.lang.getString("wbrtcMsgChrome"),this.displayMessage(c,"chormeWebrtcCont",this.msgBoxClass+a))},canvasDrawMsg:function(a){document.getElementById("vcanvas").className="canvasMsgBoxParent";if("Firefox"==vApp.system.mybrowser.name){var c=vApp.lang.getString("canvasDrawMsg");this.displayMessage(c,"canvasDrawMsgContFirefox",this.msgBoxClass+a,"containerWb")}else"Chrome"==vApp.system.mybrowser.name&&(c=vApp.lang.getString("canvasDrawMsg"),
this.displayMessage(c,"canvasDrawMsgContChrome",this.msgBoxClass+a,"containerWb"))},drawLabel:function(a){var c=vApp.lang.getString("drawArea");this.displayMessage(c,"canvasDrawArea",this.msgBoxClass+a,"containerWb",!1)},displayMsgBox:function(a,c){var d=this.customCreateElement("div",a),f=this.customCreateElement("p",a+"Para");f.innerHTML=vApp.lang.getString(c);d.appendChild(f);f=this.customCreateElement("a",a+"Anchor");f.href=e.location;f.innerHTML=vApp.lang.getString("reload");f.onclick=function(){e.location.reload()};
d.appendChild(f);f=document.getElementById("vAppCont");f.insertBefore(d,f.firstChild)},displayServerError:function(a,c){var d=this.customCreateElement("div",a);d.innerHTML=c;var f=document.getElementById("vcanvas");f.parentNode.insertBefore(d,f)},removeElement:function(a){a=document.getElementById(a);null!=a&&a.parentNode.removeChild(a)}},a=a.init();count=0;a.window.resizeFinished=function(){var a=0;return function(c,d){clearTimeout(a);a=setTimeout(c,d)}}();a.window.resize=function(){var a=vApp.system.measureResoultion({width:e.innerWidth,
height:e.innerHeight});vApp.vutil.setContainerWidth(a);vcan.renderAll()};a.virtualWindow.manupulation=function(a){var c=a.message.virtualWindow;if(c.hasOwnProperty("removeVirtualWindow"))a.fromUser.userid!=wbUser.id&&vApp.wb.utility.removeVirtualWindow("virtualWindow");else if(c.hasOwnProperty("createVirtualWindow"))c.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",c.toolHeight),a.fromUser.userid!=wbUser.id&&vApp.wb.utility.createVirtualWindow(c.createVirtualWindow);else if(c.hasOwnProperty("shareBrowserWidth")){c.hasOwnProperty("toolHeight")&&
localStorage.setItem("toolHeight",c.toolHeight);if(null!=localStorage.getItem("teacherId")){var d=vApp.wb.utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",d)}a.fromUser.userid!=wbUser.id?(null!=localStorage.getItem("teacherId")&&vApp.wb.utility.makeCanvasEnable(),otherBrowser=c.browserRes):myBrowser=vApp.system.measureResoultion({width:e.outerWidth,height:e.innerHeight});"object"==typeof myBrowser&&"object"==typeof otherBrowser&&(myBrowser.width>otherBrowser.width?
vApp.wb.gObj.virtualWindow||(vApp.wb.utility.createVirtualWindow(otherBrowser),vApp.wb.gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!vApp.wb.gObj.virtualWindow&&(a=document.getElementById("vcanvas"),a=vApp.wb.utility.getElementRightOffSet(a),null!=localStorage.getItem("teacherId")?vApp.wb.utility.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a,toolHeight:d}}):vApp.wb.utility.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a}})))}};e.view=a})(window);(function(e){var a={init:function(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport:function(a,c,d){"MSIE"==c?9!=d&&vApp.error.push({msg:vApp.lang.getString("notSupportCanvas"),id:"errorCanvas",className:"error"}):e.CanvasRenderingContext2D||vApp.error.push({msg:vApp.lang.getString("notSupportCanvas"),id:"errorCanvas",className:"error"})},isWebRtcSupport:function(a,c,d){"Firefox"==c?a.mozGetUserMedia?(this.wbRtc.userMedia=!0,e.mozRTCPeerConnection?this.wbRtc.peerCon=
!0:vApp.error.push({msg:vApp.lang.getString("notSupportPeerConnect"),id:"errorPeerConnect",className:"error"})):vApp.error.push({msg:vApp.lang.getString("notSupportGetUserMedia"),id:"errorGetUserMedia",className:"error"}):"Chrome"==c||"Safari"==c?a.webkitGetUserMedia?(this.wbRtc.userMedia=!0,e.webkitRTCPeerConnection?this.wbRtc.peerCon=!0:vApp.error.push({msg:vApp.lang.getString("notSupportPeerConnect"),id:"errorPeerConnect",className:"error"})):vApp.error.push({msg:vApp.lang.getString("notSupportGetUserMedia"),
id:"errorGetUserMedia",className:"error"}):"MSIE"==c&&9>=d&&vApp.error.push({msg:vApp.lang.getString("notSupportWebRtc"),id:"errorWebRtc",className:"error"})},isWebSocketSupport:function(a,c,d){this.webSocket={};"undefined"==typeof e.WebSocket||"function"!=typeof e.WebSocket&&"object"!=typeof e.WebSocket||!e.WebSocket.hasOwnProperty("OPEN")?vApp.error.push({msg:vApp.lang.getString("notSupportWebSocket"),id:"errorWebSocket",className:"error"}):this.webSocket=!0},measureResoultion:function(a){var c=
document.getElementById("vAppCont"),c=vcan.utility.getElementOffset(c),d=c.x;return{width:1024>a.width?1024-d:a.width-d,height:a.height-c.y}},setCanvasDimension:function(){var a=this.measureResoultion({width:e.innerWidth,height:e.innerHeight});document.getElementById("vAppCont");vApp.vutil.setContainerWidth(a);if("undefined"!=typeof vcan.main.canvas){var c=vcan.main.canvas;ctx=vcan.main.canvas.getContext("2d");c.width=a.width;c.height=a.height;console.log("canvas width "+c.width);a=document.getElementById("canvas");
a=vcan.utility.getElementOffset(a);vcan.main.offset.x=a.x}},getResoultion:function(a){var c={};1280>a?(c.width=1024,c.height=768):1280<=a&&1366>a?(c.width=1280,c.height=1024):1366<=a&&1920>a?(c.width=1366,c.height=768):1920<=a&&(c.width=1920,c.height=1080);return c},check:function(){var a=this.mybrowser.detection(),c=a[0],a=a[1];this.mybrowser.name=c;this.mybrowser.version=a;this.isCanvasSupport(navigator,c,a);this.isWebRtcSupport(navigator,c,a);this.isWebSocketSupport(navigator,c,a)}},a=a.init();
e.addEventListener("resize",function(){vApp.gObj.video.updateVidContHeight();e.earlierWidth!=e.innerWidth&&a.setCanvasDimension()});e.addEventListener("resize",function(){e.earlierWidth!=e.innerWidth&&vApp.wb.view.window.resize()});a.mybrowser.detection=function(){var a=navigator.userAgent,c,d=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(d[1]))return c=/\brv[ :]+(\d+(\.\d+)?)/g.exec(a)||[],"IE "+(c[1]||"");d=d[2]?[d[1],d[2]]:[navigator.appName,
navigator.appVersion,"-?"];null!=(c=a.match(/version\/([\.\d]+)/i))&&(d[2]=c[1]);return d};e.system=a})(window);(function(e){e.packContainer=function(){return{createPacketContDiv:function(a,b){var c=document.createElement("div");"undefined"!=typeof a&&(c.id=a);"undefined"!=typeof b&&(c.clasName=b);return c},togglePacketCont:function(a){for(var b=this.className.split(" "),c=0;c<b.length;c++)if("display"==b[c]){this.className="hide";this.innerHTML="+";a._togglePacketCont(b[c]);break}else if("hide"==b[c]){this.className="display";this.innerHTML="-";a._togglePacketCont(b[c]);break}},_togglePacketCont:function(a){a=
"display"==a?"none":"block";document.getElementById("dataInfoHeading").style.display=a;var b=document.getElementById("packetContainer");b.style.display=a;b=document.getElementById("informationCont");b.style.display=a},createPacketContainer:function(){var a=document.getElementById("packetContainer"),b=document.createElement("h4");b.id="dataInfoHeading";b.innerHTML=vApp.lang.getString("dataDetails");var c=document.createElement("div");c.id="toggleContainer";c.className="display";var d=this;c.addEventListener("click",
function(){d.togglePacketCont.call(this,d)});c.innerHTML="-";var f=document.getElementById("mainContainer");f.insertBefore(c,f.firstChild);f.insertBefore(b,a);b=this.createPacketContDiv("dataInformation");a.appendChild(b);c=this.createPacketContDiv("blankDiv");c.innerHTML="&nbsp;<br/>&nbsp;";b.appendChild(c);c=this.createPacketContDiv("perSecData");c.innerHTML=vApp.lang.getString("perSecond");b.appendChild(c);c=this.createPacketContDiv("totalDataLabel");c.innerHTML=vApp.lang.getString("total");b.appendChild(c);
c=this.createPacketContDiv("sendPackCont");a.appendChild(c);b=this.createPacketContDiv("sentPacketsLabel");b.innerHTML=vApp.lang.getString("sentPackets");c.appendChild(b);f=this.createPacketContDiv("sendPackPsCont");c.appendChild(f);b=this.createPacketContDiv(this.sentPackDivPS,"numbers");b.innerHTML=0;f.appendChild(b);f=this.createPacketContDiv("totSendPackCont");c.appendChild(f);b=this.createPacketContDiv(this.sentPackDiv,"numbers");b.innerHTML=0;f.appendChild(b);c=this.createPacketContDiv("receivePackCont");
a.appendChild(c);a=this.createPacketContDiv("receivedPacketsLabel");a.innerHTML=vApp.lang.getString("receviedPackets");c.appendChild(a);a=this.createPacketContDiv("receivePackPsCont");c.appendChild(a);b=this.createPacketContDiv(this.receivedPackDivPS,"numbers");b.innerHTML=0;a.appendChild(b);a=this.createPacketContDiv("totReceivedPackCont");c.appendChild(a);b=this.createPacketContDiv(this.receivedPackDiv,"numbers");b.innerHTML=0;a.appendChild(b)},createPacketInfoContainer:function(){var a=document.getElementById("informationCont");
label=document.createElement("label");label.innerHTML=vApp.lang.getString("sentMessageInfo");var b=this.createPacketContDiv("sentMsgInfoContainer");b.appendChild(label);var c=this.createPacketContDiv("sentMsgInfo");b.appendChild(c);a.appendChild(b);b=this.createPacketContDiv("receivedMsgInfoContainer");label=document.createElement("label");label.innerHTML=vApp.lang.getString("receivedMessageInfo");b.appendChild(label);c=this.createPacketContDiv("rcvdMsgInfo");b.appendChild(c);a.appendChild(b)}}}})(window);(function(e){e.draw_object=function(a,b,c){var d=this;c.started=!1;var f,h,g=[];c.mousedown=function(b,f){var h=(new Date).getTime();console.log("sumanbogati"+(h-vApp.wb.pageEnteredTime));b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+d.vcan.main.offset.x,b.clientY=b.detail.cevent.y+d.vcan.main.offset.y,b.x=b.detail.cevent.x+d.vcan.main.offset.x,b.y=b.detail.cevent.x+d.vcan.main.offset.y,b.pageX=b.detail.cevent.x+d.vcan.main.offset.x,b.pageY=b.detail.cevent.y+d.vcan.main.offset.y,
b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);h=d.vcan;lastmousemovetime=null;c.startPosX=b.currX;c.startPosY=b.currY;if("create"==h.getStates("action")){var g=(new Date).getTime();if("text"!=a&&"t_clearall"!=d.tool.cmd){var e=h.getStates("currentTransform");if(""==e||null==e)b.detail.hasOwnProperty("cevent")||h.optimize.calculatePackets(g,"d",c.startPosX,c.startPosY),c.started=!0}else d.obj.drawTextObj.muser=!1,b.detail.hasOwnProperty("cevent")||"t_clearall"==d.tool.cmd?d.obj.drawTextObj.muser=
!0:d.utility.clickOutSidebox(d.obj.drawTextObj.textWriteMode)&&h.optimize.calculatePackets(g,"d",c.startPosX,c.startPosY),b.detail.hasOwnProperty("cevent")?b.detail.cevent.hasOwnProperty("mtext")?d.obj.drawTextObj.textUtility(c.startPosX,c.startPosY,b.detail.cevent.mtext):d.obj.drawTextObj.textUtility(c.startPosX,c.startPosY):"object"==typeof d.obj.drawTextObj&&d.obj.drawTextObj.textUtility(c.startPosX,c.startPosY)}"freeDrawing"==a&&!0==d.obj.freeDrawObj.freesvg&&d.obj.freeDrawObj.drawStart(b)};c.mousemove=
function(b,e){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+d.vcan.main.offset.x,b.clientY=b.detail.cevent.y+d.vcan.main.offset.y,b.x=b.detail.cevent.x+d.vcan.main.offset.x,b.y=b.detail.cevent.x+d.vcan.main.offset.y,b.pageX=b.detail.cevent.x+d.vcan.main.offset.x,b.pageY=b.detail.cevent.y+d.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if(c.started&&"t_clearall"!=d.tool.cmd)if(void 0!=d.obj.freeDrawObj&&!0==d.obj.freeDrawObj.freesvg){if(d.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&
(d.obj.freeDrawObj.wb_draw(b),!b.detail.hasOwnProperty("cevent"))){"undefined"!=typeof e||"undefined"!=typeof lastmousemovetime&&null!=lastmousemovetime||(lastmousemovetime=(new Date).getTime(),vcan.optimize.calculatePackets(lastmousemovetime,"m",b.currX,b.currY));var l=(new Date).getTime(),l=vcan.makeStackObj(l,"m",b.currX,b.currY);g.push(l);if("undefined"==typeof e&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-lastmousemovetime)){for(l=0;l<g.length;l++)d.uid++,g[l].uid=d.uid,
vcan.main.replayObjs.push(g[l]);d.utility.beforeSend({repObj:g});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(g);d.utility.updateSentPackets(g);g=[];lastmousemovetime=(new Date).getTime()}}}else{f=b.currX;h=b.currY;""!=d.prvObj&&d.canvas.removeObject(d.prvObj);var l=d.makeobj(c.startPosX,c.startPosY,f,h,a),k=d.canvas.readyObject(l);d.canvas.addObject(k);k.coreObj.usrCurrAction="create";l=(new Date).getTime();if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=
(new Date).getTime(),b.detail.hasOwnProperty("cevent")||"text"==a||"t_clearall"==d.tool.cmd||vcan.optimize.calculatePackets(l,"m",f,h);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&(b.detail.hasOwnProperty("cevent")||"text"==a||"t_clearall"==d.tool.cmd||vcan.optimize.calculatePackets(l,"m",f,h),lastmousemovetime=(new Date).getTime());d.prvObj=k.coreObj}else"move"==d.vcan.main.action&&(""!=vcan.main.currentTransform&&null!=vcan.main.currentTransform||"move"!=
d.vcan.main.action)||d.utility.beforeSend({createArrow:!0,x:b.currX,y:b.currY})};c.mouseup=function(b,e){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+d.vcan.main.offset.x,b.clientY=b.detail.cevent.y+d.vcan.main.offset.y,b.x=b.detail.cevent.x+d.vcan.main.offset.x,b.y=b.detail.cevent.x+d.vcan.main.offset.y,b.pageX=b.detail.cevent.x+d.vcan.main.offset.x,b.pageY=b.detail.cevent.y+d.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);f=b.currX;h=b.currY;lastmousemovetime=
null;if(c.started&&"text"!=a){c.mousemove(b,"up");if(!b.detail.hasOwnProperty("cevent")&&"freeDrawing"!=a){var l=(new Date).getTime();vcan.optimize.calculatePackets(l,"u",f,h)}if(void 0!=d.obj.freeDrawObj&&!0==d.obj.freeDrawObj.freesvg&&(d.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&d.obj.freeDrawObj.finalizeDraw(b),!b.detail.hasOwnProperty("cevent")&&0<g.length)){l=(new Date).getTime();l=vcan.makeStackObj(l,"u",f,h);g.push(l);for(l=0;l<g.length;l++)d.uid++,g[l].uid=d.uid,vcan.main.replayObjs.push(g[l]);
d.utility.beforeSend({repObj:g});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(g);d.utility.updateSentPackets(g);g=[]}""!=d.prvObj&&(d.prvObj="");d.prvObj="";c.started=!1}d.vcan.wb.sentPack&&(d.vcan.wb.sentPack=!1)}}})(window);(function(e){e.makeobj=function(a,b,c,d,f){var h={mp:{}};h.mp.x=c;h.mp.y=d;if(a>c){var g=c,e=d;c=a;d=b;a=g;b=e;h.dRoad="b2t"}else h.dRoad="t2b";h.type=f;if("rectangle"==f||"triangle"==f)h.sx=a,h.sy=b,h.ex=c,h.ey=d;if("line"==f)h.lineColor="#424240",h.lineWidth=3,h.start={x:a,y:b},h.end={x:c,y:d};else if("rectangle"==f)h.width=c-a,h.height=d-b,h.borderColor="#424240",h.lineWidth=3;else if("oval"==f)h.lineWidth=3,h.borderColor="#424240",h.width=c-a,h.height=d-b,h.x=c-h.width/2,h.y=d-h.height/2,h.rx=
h.width/2,h.ry=h.height/2;else if("triangle"==f)h.lineWidth=3,h.borderColor="#424240";else if("text"==f)return;return h}})(window);(function(e){var a=e.vcan;a.utility={canvasCalcOffset:function(b){var c=a.main;b=document.getElementById(b);b=a.utility.getElementOffset(b);return c.offset=b},getElementOffset:function(a){var c=0,d=0;do c+=a.offsetTop||0,d+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:d,y:c}},setVal:function(b,c,d){("scaleX"===c||"scaleY"===c)&&d<b.MIN_SCALE_LIMIT&&(d=b.MIN_SCALE_LIMIT);if("object"==typeof c)for(var f in c)a.utility.setVal(b,f,c[f]);else"angle"===c?a.utility.setAngle(b,d):b[c]=d;return b},getVal:function(a,
c){return a[c]},setAngle:function(a,c){a.theta=c/180*Math.PI;a.angle=c;return a},actualPointer:function(b){return{x:a.utility.pointerX(b),y:a.utility.pointerY(b)}},pointerX:function(a){var c=document.documentElement,d=document.body||{scrollLeft:0};return a.pageX||("unknown"!=typeof a.clientX?a.clientX:0)+(c.scrollLeft||d.scrollLeft)-(c.clientLeft||0)},pointerY:function(a){var c=document.documentElement,d=document.body||{scrollTop:0};return a.pageY||("unknown"!=typeof a.clientY?a.clientY:0)+(c.scrollTop||
d.scrollTop)-(c.clientTop||0)},getReltivePoint:function(b){var c=a.main.offset;b=a.utility.actualPointer(b);return{x:b.x-c.x,y:b.y-c.y}},degreesToRadians:function(a){return Math.PI/180*a},setActiveObject:function(b){a.main.activeObject&&a.main.activeObject.setActive(!1);a.main.activeObject=b;b.setActive(!0);return b},updateObj:function(a){var c={};for(prop in a)"oCoords"!=prop?c[prop]=a[prop]:(c.start={},c.end={},c.start.x=a[prop].tl.x,c.start.y=a[prop].tl.y,c.end.x=a[prop].br.x,c.end.y=a[prop].br.y);
return c},setCursorFromEvent:function(a,c,d){var f=a.upperCanvasEl.style;if(d)if(c=d.findTargetCorner(c))if(c in a.cursorMap)f.cursor=a.cursorMap[c];else if("mtr"===c&&d.hasRotatingPoint)f.cursor=a.rotationCursor;else return f.cursor=this.defaulCursor,!1;else f.cursor=a.hoverCursor;else return f.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return a.main.children}}})(window);(function(e){var a=e.vcan;a.main.prototype={addObject:function(b){if("object"==typeof b.coreObj){"freehand"!=b.coreObj.type&&a.main.children.push(b.coreObj);var c=a.main.canvas.getContext("2d");a.render(c,b.coreObj)}},removeObject:function(b){a.remove(b)},bind:function(b,c){a.events().bind(a.main.canvas,b,c)},readyObject:function(b,c){b=a.extend({},b);c||void 0!=b.id||(a.main.id++,b.id=a.main.id);b.cornersize=12;b.rotatingPointOffset=40;b.selectable=!0;b.downObj=!1;b.active=!1;b.cornersize=12;b.padding=
0;b.hasControls=!0;b.cornerColor="rgba(102,153,255,0.5)";void 0==b.borderColor&&(b.borderColor="#000");b.flipX=!1;b.flipY=!1;b.draggable=!1;b.hasBorders=!0;b.hasRotatingPoint=!1;b.hideCorners=!1;b.lockRotation=!1;b.MIN_SCALE_LIMIT=.1;b.borderOpacityWhenMoving=.4;b.hasOwnProperty("theta")||(b.theta=0);b.hasOwnProperty("scaleX")||(b.scaleX=1);b.hasOwnProperty("scaleY")||(b.scaleY=1);"line"==b.type?(a.objLine=new a.line,a.objLine.init(b)):"rectangle"==b.type?(a.objRect=new a.rectangle,a.objRect.init(b)):
"oval"==b.type?(a.objOval=new a.oval,a.objOval.init(b)):"triangle"==b.type?(a.objTri=new a.triangle,a.objTri.init(b)):"text"==b.type&&(a.objTxt=new a.text,a.objTxt.init(b));b.getWidth=function(){return this.width*this.scaleX};b.getHeight=function(){return this.height*this.scaleY};b.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/
this.currentWidth);this.theta=this.theta;var d=Math.cos(this.angle+this.theta)*this.hypotenuse,c=Math.sin(this.angle+this.theta)*this.hypotenuse,h=this.theta,g=Math.sin(h),h=Math.cos(h),d={x:this.x-d,y:this.y-c},c={x:d.x+this.currentWidth*h,y:d.y+this.currentWidth*g},e={x:d.x-this.currentHeight*g,y:d.y+this.currentHeight*h};this.oCoords={tl:d,tr:c,br:{x:c.x-this.currentHeight*g,y:c.y+this.currentHeight*h},bl:e,ml:{x:d.x-this.currentHeight/2*g,y:d.y+this.currentHeight/2*h},mt:{x:d.x+this.currentWidth/
2*h,y:d.y+this.currentWidth/2*g},mr:{x:c.x-this.currentHeight/2*g,y:c.y+this.currentHeight/2*h},mb:{x:e.x+this.currentWidth/2*h,y:e.y+this.currentWidth/2*g},mtr:{x:d.x+this.currentWidth/2*h,y:d.y+this.currentWidth/2*g}};this.setCornerCoords();b.findTargetCorner=function(d){var c=a.main.offset;if(!this.hasControls)return!1;var f=a.utility.actualPointer(d);d=f.x-c.x;var c=f.y-c.y,h;for(h in this.oCoords){if("mtr"===h&&!this.hasRotatingPoint)break;f=a.virtual_box.getImageLines(this.oCoords[h].corner,
h);f=a.virtual_box.findCrossPoints(d,c,f);if(1==f%2&&0!=f)return b.corner=h}return!1};return this};b.drawBorders=function(a){if(this.hasBorders){var b=this.padding,c=2*b;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var g=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),e=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(g,e);g=this.getWidth();e=this.getHeight();
a.strokeRect(~~(-(g/2)-b)+.5,~~(-(e/2)-b)+.5,~~(g+c),~~(e+c));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(b=(this.flipY?e:-e)/2,a.beginPath(),a.moveTo(0,b),a.lineTo(0,b+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};b.drawCorners=function(a){if(this.hasControls){var b=this.cornersize,c=b/2,g=this.padding,e=-(this.width/2),m=-(this.height/2),l=b/this.scaleX,k=b/this.scaleY,p=(g+c)/this.scaleY,q=(g+c)/this.scaleX,
s=(g+c-b)/this.scaleX,c=(g+c-b)/this.scaleY,g=this.height;a.save();a.fillStyle=this.cornerColor;a.fillRect(e-q,m-p,l,k);b=e+this.width-q;a.fillRect(b,m-p,l,k);a.fillRect(e-q,m+g+c,l,k);b=e+this.width+s;a.fillRect(b,m+g+c,l,k);b=e+this.width/2-q;a.fillRect(b,m-p,l,k);b=e+this.width/2-q;a.fillRect(b,m+g+c,l,k);b=e+this.width+s;a.fillRect(b,m+g/2-p,l,k);a.fillRect(e-q,m+g/2-p,l,k);this.hasRotatingPoint&&(b=e+this.width/2-q,e=this.flipY?m+g+this.rotatingPointOffset/this.scaleY-k/2:m-this.rotatingPointOffset/
this.scaleY-k/2,a.fillRect(b,e,l,k));a.restore();return this}};b.setActive=function(a){this.active=!!a;return this};b.dragDrop=function(a){this.draggable=void 0!=a?a:!1};b.setCornerCoords=function(){var d=this.oCoords,b=a.utility.degreesToRadians(45-this.getAngle()),c=Math.sqrt(2*Math.pow(this.cornersize,2))/2,g=c*Math.cos(b),b=c*Math.sin(b),c=Math.sin(this.theta),e=Math.cos(this.theta);d.tl.corner={tl:{x:d.tl.x-b,y:d.tl.y-g},tr:{x:d.tl.x+g,y:d.tl.y-b},bl:{x:d.tl.x-g,y:d.tl.y+b},br:{x:d.tl.x+b,y:d.tl.y+
g}};d.tr.corner={tl:{x:d.tr.x-b,y:d.tr.y-g},tr:{x:d.tr.x+g,y:d.tr.y-b},br:{x:d.tr.x+b,y:d.tr.y+g},bl:{x:d.tr.x-g,y:d.tr.y+b}};d.bl.corner={tl:{x:d.bl.x-b,y:d.bl.y-g},bl:{x:d.bl.x-g,y:d.bl.y+b},br:{x:d.bl.x+b,y:d.bl.y+g},tr:{x:d.bl.x+g,y:d.bl.y-b}};d.br.corner={tr:{x:d.br.x+g,y:d.br.y-b},bl:{x:d.br.x-g,y:d.br.y+b},br:{x:d.br.x+b,y:d.br.y+g},tl:{x:d.br.x-b,y:d.br.y-g}};d.ml.corner={tl:{x:d.ml.x-b,y:d.ml.y-g},tr:{x:d.ml.x+g,y:d.ml.y-b},bl:{x:d.ml.x-g,y:d.ml.y+b},br:{x:d.ml.x+b,y:d.ml.y+g}};d.mt.corner=
{tl:{x:d.mt.x-b,y:d.mt.y-g},tr:{x:d.mt.x+g,y:d.mt.y-b},bl:{x:d.mt.x-g,y:d.mt.y+b},br:{x:d.mt.x+b,y:d.mt.y+g}};d.mr.corner={tl:{x:d.mr.x-b,y:d.mr.y-g},tr:{x:d.mr.x+g,y:d.mr.y-b},bl:{x:d.mr.x-g,y:d.mr.y+b},br:{x:d.mr.x+b,y:d.mr.y+g}};d.mb.corner={tl:{x:d.mb.x-b,y:d.mb.y-g},tr:{x:d.mb.x+g,y:d.mb.y-b},bl:{x:d.mb.x-g,y:d.mb.y+b},br:{x:d.mb.x+b,y:d.mb.y+g}};d.mtr.corner={tl:{x:d.mtr.x-b+c*this.rotatingPointOffset,y:d.mtr.y-g-e*this.rotatingPointOffset},tr:{x:d.mtr.x+g+c*this.rotatingPointOffset,y:d.mtr.y-
b-e*this.rotatingPointOffset},bl:{x:d.mtr.x-g+c*this.rotatingPointOffset,y:d.mtr.y+b-e*this.rotatingPointOffset},br:{x:d.mtr.x+b+c*this.rotatingPointOffset,y:d.mtr.y+g-e*this.rotatingPointOffset}}};b.getAngle=function(){return 180*this.theta/Math.PI};b.setZindex=function(){for(var d=0;d<a.main.children.length;d++)if(this.id==a.main.children[d].id){var b=a.main.children[d];a.main.children.splice(d,1);break}return" "!=b?(a.main.children.push(b),!0):!1};b.setupCurrentTransform=function(b){var c=a.main,
h="drag",g=a.utility.actualPointer(b);if(b=this.findTargetCorner(b))h="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":this.hasRotatingPoint?"scale":"rotate";c.currentTransform={target:this,action:h,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:g.x-this.x,offsetY:g.y-this.y,ex:g.x,ey:g.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};c.currentTransform.original={x:this.x,y:this.y}};"text"!=b.type&&b.setCoords();return a.makeDispObject(b)}}})(window);(function(e){var a=e.vcan;a.events=function(){return{bind:function(a,c,d){a["on"+c]=d},findTarget:function(b){for(var c,d=a.main.children,f=d.length;f--;)if(d[f]&&a.virtual_box.containsPoint(b,d[f])){c=d[f];break}if(c&&c.selectable)return c}}}})(window);(function(e){var a=e.vcan;a.virtual_box={findCrossPoints:function(a,c,d){var f,h,g,e=0,m;for(m in d)if(g=d[m],!(g.o.y<c&&g.d.y<c||g.o.y>=c&&g.d.y>=c)&&(g.o.x==g.d.x&&g.o.x>=a?f=g.o.x:(f=(g.d.y-g.o.y)/(g.d.x-g.o.x),h=c-0*a,g=g.o.y-f*g.o.x,f=-(h-g)/(0-f)),f>=a&&(e+=1),2==e))break;return e},getImageLines:function(a,c){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint:function(b,c){var d=a.utility.getReltivePoint(b),f=d.x,d=d.y,
h=a.virtual_box.getImageLines(c.oCoords);return(f=a.virtual_box.findCrossPoints(f,d,h))&&1===f%2||c.findTargetCorner(b)?!0:!1}}})(window);(function(e){var a=e.vcan;a.interact={rotateObject:function(b,c){var d=a.main.currentTransform,f=a.main.offset;if(!d.target.lockRotation){var h=Math.atan2(d.ey-d.y-f.y,d.ex-d.x-f.x),f=Math.atan2(c-d.y-f.y,b-d.x-f.x);a.utility.setVal(d.target,"theta",f-h+d.theta)}},scaleObject:function(b,c,d){var f=a.main.currentTransform,h=a.main.offset;target=f.target;if(!target.lockScalingX||!target.lockScalingY){var g=Math.sqrt(Math.pow(f.ey-f.y-h.y,2)+Math.pow(f.ex-f.x-h.x,2));b=Math.sqrt(Math.pow(c-f.y-h.y,2)+
Math.pow(b-f.x-h.x,2));target.scaling=!0;d?"x"!==d||target.lockUniScaling?"y"!==d||target.lockUniScaling||target.lockScalingY||a.utility.setVal(target,"scaleY",f.scaleY*b/g):target.lockScalingX||a.utility.setVal(target,"scaleX",f.scaleX*b/g):(target.lockScalingX||a.utility.setVal(target,"scaleX",f.scaleX*b/g),target.lockScalingY||a.utility.setVal(target,"scaleY",f.scaleY*b/g))}},translateObject:function(b,c){var d=a.main.currentTransform.target;d.lockMovementX||a.utility.setVal(d,"x",b-a.main.currentTransform.offsetX);
d.lockMovementY||a.utility.setVal(d,"y",c-a.main.currentTransform.offsetY);return d}}})(window);(function(e){e.vcan.rectangle=function(){return{type:"rectangle",init:function(a){void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,c){c=-b.width/2;var d=-b.height/2,f=b.width,h=b.height;a.beginPath();a.strokeStyle=void 0!=b.borderColor?'"'+b.strokeColor+'"':"#000";a.moveTo(c,d);a.stroke();a.lineTo(c+f,d);a.stroke();a.lineTo(c+f,d+h);a.stroke();a.lineTo(c,d+h);a.stroke();a.lineTo(c,d);a.fillStyle=void 0!=b.fillColor?b.fillColor:" ";a.closePath();a.stroke();
void 0!=b.fillColor&&(a.fillStyle=b.fillColor,a.fill())}}}})(window);(function(e){e.vcan.oval=function(){return{type:"oval",init:function(a){void 0==a.width&&(a.width=2*a.rx);void 0==a.height&&(a.height=2*a.ry);void 0==a.borderColor&&(a.borderColor="#000000");void 0!=a.fillColor&&(a.fillStyle=a.fillColor);return a},draw:function(a,b,c){a.beginPath();a.save();var d=2*Math.PI;a.lineWidth=b.lineWidth;var f=b.ry/b.rx,f=f.toFixed(3);0==f&&(f=.01);a.transform(1,0,0,f,0,0);a.arc(c?b.x:0,c?b.y:0,b.rx,0,d,!1);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());
void 0!=b.borderColor&&(a.fillStyle=b.borderColor,a.stroke());a.restore()}}}})(window);(function(e){e.vcan.triangle=function(){return{type:"triangle",init:function(a){a.fillStyle=a.fillColor;void 0==a.dRoad&&(a.dRoad="ltr");void 0==a.width&&(a.width=a.ex-a.sx);void 0==a.height&&(a.height=a.ey-a.sy);void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,c){a.beginPath();if("t2b"==b.dRoad){c=b.width/2;var d=b.height/2}else c=-b.width/2,d=-b.height/2;a.lineWidth=b.lineWidth;void 0!=b.borderColor&&(a.strokeStyle=b.borderColor);a.moveTo(-c,d);a.lineTo(0,
-d);a.lineTo(c,d);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());a.stroke()}}}})(window);(function(e){e.vcan.line=function(){return{type:"line",init:function(a){var b=a.start.x,c=a.start.y,d=a.end.x,f=a.end.y;void 0==a.width&&(a.width=d-b,a.height=f-c);a.x=b+(d-b)/2;a.y=c+(f-c)/2;return a},draw:function(a,b,c){a.beginPath();c=1===b.width?0:b.width/2;var d=1===b.height?0:b.height/2;a.moveTo(1===b.width?0:-b.width/2,1===b.height?0:-b.height/2);a.lineTo(c,d);a.lineWidth=b.lineWidth;void 0!=b.lineColor&&(a.strokeStyle=b.lineColor);a.closePath();a.stroke()}}}})(window);(function(e){e.vcan.text=function(){return{type:"text",init:function(a){a.lineHeight=1.3;void 0==a.fontSize&&(a.fontSize=30);a.font=a.fontSize+"px Times New Roman";return a},draw:function(a,b,c){a.font=b.font;c=b.text.split(/\r?\n/);b.height=this.getTextHeight(a,c,b);b.width=this.getTextWidth(a,c);a.beginPath();for(var d=0,f=c.length;d<f;d++)a.fillText(c[d],-b.width/2,-b.height/2+d*b.fontSize*b.lineHeight+b.fontSize);a.closePath();b.setCoords()},getTextWidth:function(a,b){for(var c=a.measureText(b[0]).width,
d=1,f=b.length;d<f;d++){var h=a.measureText(b[d]).width;h>c&&(c=h)}return c},getTextHeight:function(a,b,c){return c.fontSize*b.length*c.lineHeight},removeTextNode:function(){for(var a=document.getElementsByClassName("textBoxContainer"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])}}}})(window);(function(e){var a=e.vcan;a.main.freeHandDrawing=function(b){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==b.borderColor?"#000000":b.borderColor;this.freeDrawingLineWidth=void 0!=b.lineWidth?b.lineWidth:"3";return this},fhdStart:function(a,b,f){f=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);
this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(f);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,b){var f=(new Date).getTime();this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(f)},finalizeDrawingPath:function(c,d,f){(new Date).getTime();
this.contextTop.closePath();this.isCurrentlyDrawing=!1;var h=this.utility.min(this.freeDrawingXPoints);d=this.utility.min(this.freeDrawingYPoints);var g=this.utility.max(this.freeDrawingXPoints);f=this.utility.max(this.freeDrawingYPoints);var e=[],m,l,k,p=this.freeDrawingXPoints,q=this.freeDrawingYPoints,s=this.mdTime;e.push("M ",p[0]-h," ",q[0]-d," ",s[0]," ");for(var r=1;m=p[r],l=q[r],k=s[r];r++)e.push("L ",m-h," ",l-d," ",k," ");e=e.join("");if("M 0 0 L 0 0 "!==e)return m=this.freeDrawingXPoints[this.freeDrawingXPoints.length-
1],l=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],k=new a.Path(e,this),k.mp={},k.mp.x=m,k.mp.y=l,k.init(e),k=c.readyObject(k),k.coreObj.type="freeDrawing",k=k.coreObj,k.fill=null,k.stroke=this.freeDrawingColor,k.strokeWidth=this.freeDrawingLineWidth,k.minX=h,k.minY=d,this.utility.objAdd(k),c=a.utility.setVal(k,"x",h+(g-h)/2),c=a.utility.setVal(c,"y",d+(f-d)/2),c.setCoords(),"object"==typeof b&&this.contextTop.restore(),a.renderAll(this.contextTop),c},utility:{max:function(a,b){if(a&&
0!==a.length){var f=a.length-1,h=b?a[f][b]:a[f];if(b)for(;f--;)a[f][b]>=h&&(h=a[f][b]);else for(;f--;)a[f]>=h&&(h=a[f]);return h}},min:function(a,b){if(a&&0!==a.length){var f=a.length-1,h=b?a[f][b]:a[f];if(b)for(;f--;)a[f][b]<h&&(h=a[f][b]);else for(;f--;)a[f]<h&&(h=a[f]);return h}},objAdd:function(b){a.main.children.push(b);return this}}}}})(window);(function(e){var a=e.vcan;a.Path=function(b,c){return{objectType:"path",init:function(a,b){b=b||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(b),this},initializeFromArray:function(a){var b="width"in a,c="height"in a;this.path=this._parsePath();b&&c||(this.utility.extend(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height))},
_render:function(a){var b,c=0;b=0;for(var g=-(this.width/2),e=-(this.height/2),m=0,l=this.path.length;m<l;++m)switch(b=this.path[m],b[0]){case "L":c=b[1];b=b[2];a.lineTo(c+g,b+e);break;case "M":c=b[1],b=b[2],a.moveTo(c+g,b+e)}},replay_render:function(a,b,c,g){var e=y=0;switch(b[0]){case "L":e+=b[1];y+=b[2];a.lineTo(e+c,y+g);a.stroke();break;case "M":e+=b[1],y+=b[2],a.moveTo(e+c,y+g)}},render:function(b,c){b.save();var h=this.transformMatrix;h&&b.transform(h[0],h[1],h[2],h[3],h[4],h[5]);c||a.transform(b,
this);this.overlayFill?b.fillStyle=this.overlayFill:this.fill&&(b.fillStyle=this.fill);this.stroke&&(b.strokeStyle=this.stroke);b.beginPath();this._render(b);this.fill&&b.fill();this.stroke&&(b.strokeStyle=this.stroke,b.lineWidth=this.strokeWidth,b.lineCap=b.lineJoin="round",b.stroke());!c&&this.active&&(this.drawBorders(b),this.hideCorners||this.drawCorners(b));b.restore()},_parsePath:function(){for(var a=[],b,c,g,e=0,m,l=this.path.length;e<l;e++){var k=/\d+\s$/.exec(this.path[e]);null!=k&&(b=this.path[e].indexOf(k),
this.path[e]=this.path[e].substring(0,b));b=this.path[e];c=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);b=[b.charAt(0)];m=0;for(var p=c.length;m<p;m++)g=parseFloat(c[m]),isNaN(g)||b.push(g);c=b[0].toLowerCase();c=this.commandLengths[c];if(b.length-1>c)for(g=1,m=b.length;g<m;g+=c)null==k?a.push([b[0]].concat(b.slice(g,g+c))):(a.push([b[0]].concat(b.slice(g,g+c))),b.push(k),a.push(b));else null!=k&&b.push(k[0]),a.push(b)}return a},_parseDimensions:function(){var a=[],b=[],h,g,e=!1,
m,l;this.path.forEach(function(c,k){if(" "!=c[3])var s=c.splice(3);"H"!==c[0]&&(h=0===k?this.utility.getX(c):this.utility.getX(this.path[k-1]));"V"!==c[0]&&(g=0===k?this.utility.getY(c):this.utility.getY(this.path[k-1]));c[0]===c[0].toLowerCase()&&(e=!0);m=e?h+this.utility.getX(c):"V"===c[0]?h:this.utility.getX(c);l=e?g+this.utility.getY(c):"H"===c[0]?g:this.utility.getY(c);var r=parseInt(m,10);isNaN(r)||a.push(r);r=parseInt(l,10);isNaN(r)||b.push(r);void 0!=s&&1<=s.length&&c.push(s[0])},this);var k=
c.utility.min(a),k={y:c.utility.min(b)-0,x:k-0,bottom:c.utility.max(b)-0,right:c.utility.max(a)-0};k.width=k.right-k.x;k.height=k.bottom-k.y;return k},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,b){for(var c in b)a[c]=b[c];return a}}}}})(window);(function(e){var a=e.vcan;a.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){canvasElement=a.main.canvas;var b={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};for(type in b)"mousedown"==type?canvasElement.addEventListener(type,this.mousedown,!1):"mousemove"==type?canvasElement.addEventListener(type,this.mousemove,!1):"mouseup"==type&&canvasElement.addEventListener(type,this.mouseup,!1)},mousedown:function(b,c){b.detail.hasOwnProperty("cevent")&&
"create"!=a.main.action&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];if("move"==a.main.action){if(!a.main.currentTransform){var d=a.events().findTarget(b);a.utility.getReltivePoint(b);d?(0<a.main.children.length&&
d.setZindex(),d.downObj=!0,d.setupCurrentTransform(b),a.utility.setActiveObject(d),a.main.currObj=d):a.deactivateAll();void 0!=d&&a.renderAll();b.detail.hasOwnProperty("cevent")||(d=(new Date).getTime(),d=a.makeStackObj(d,"d",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y),vApp.wb.uid++,console.log("uid "+vApp.wb.uid),d.uid=vApp.wb.uid,a.main.replayObjs.push(d),vApp.wb.utility.beforeSend({repObj:[d]}),vApp.wb.utility.updateSentPackets(d))}}else"create"==a.main.action&&(b.detail.hasOwnProperty("cevent")&&
(b.clientX=b.detail.cevent.x+vApp.wb.vcan.main.offset.x,b.clientY=b.detail.cevent.y+vApp.wb.vcan.main.offset.y,b.x=b.detail.cevent.x+vApp.wb.vcan.main.offset.x,b.y=b.detail.cevent.x+vApp.wb.vcan.main.offset.y,b.pageX=b.detail.cevent.x+vApp.wb.vcan.main.offset.x,b.pageY=b.detail.cevent.y+vApp.wb.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y),d=a.events().findTarget(b),a.utility.getReltivePoint(b),d&&"text"==d.type&&"t_text"==vApp.wb.tool.cmd&&d.setupCurrentTransform(b))},mousemove:function(b){b.detail.hasOwnProperty("cevent")&&
(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if("move"==a.main.action){var c=a.main;if(c.currentTransform){var d=a.utility.actualPointer(b),f=d.x,d=d.y;c.currentTransform.target.isMoving=!0;if("rotate"===c.currentTransform.action)a.interact.rotateObject(f,
d),c.currentTransform.target.hasRotatingPoint||a.interact.scaleObject(f,d),b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b);else if("scale"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(f,d);else if("scaleX"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(f,d,"x");else if("scaleY"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),
a.interact.scaleObject(f,d,"y");else if(c.currentTransform.target.draggable){var h=a.extend({},a.main.currentTransform.target);(new Date).getTime();!0==c.currentTransform.target.downObj&&(a.main.dragMode=!0,c.currentTransform.target.downObj=!1);h=a.interact.translateObject(f,d);b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b);h.setActive(!0);h.setCoords()}if("scaleX"===c.currentTransform.action||"scaleY"===c.currentTransform.action||"rotate"===c.currentTransform.action&&!c.currentTransform.target.hasRotatingPoint)a.main.scaleMode=
!0,(new Date).getTime(),c.currentTransform.target.downObj&&(c.currentTransform.target.downObj=!1),h=a.extend({},a.main.currentTransform.target),h.setCoords();a.renderAll()}else a.events().findTarget(b)}},mouseup:function(b){b.detail.hasOwnProperty("cevent")&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,
b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;if("move"==a.main.action){a.activMouse.mousemove(b);var c=a.main;if(c.currentTransform){var d=c.currentTransform.target;d.scaling&&(d.scaling=!1);for(d=c.children.length;d--;)c.children[d].setCoords()}c.currentTransform=null;a.renderAll();if(!0==a.main.dragMode||!0==a.main.scaleMode){a.utility.actualPointer(b);var f=(new Date).getTime();b.detail.hasOwnProperty("cevent")||a.optimize.calculatePackets(f,"u",b.clientX-a.main.offset.x,
b.clientY-a.main.offset.y);a.main.dragMode&&(a.main.dragMode=!1);a.main.scaleMode&&(a.main.scaleMode=!1)}else b.detail.hasOwnProperty("cevent")||a.optimize.calculatePackets(f,"u",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y);a.wb.sentPack=!0}}}}})(window);(function(e){e.readyFreeHandObj=function(a,b){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=a;this.freeDrawingLineWidth=b},drawStart:function(a){var b=vApp.wb.vcan;if(!0==vApp.wb.obj.freeDrawObj.freesvg){var f=b.main.canvas.getContext("2d");this.fdObj=b.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=b.utility.getReltivePoint(a);this.fdObj.fhdStart(f,pointer)}},wb_draw:function(a){a=vcan.utility.getReltivePoint(a);
this.fdObj.fhRendering(a)},finalizeDraw:function(a){a=vApp.wb.vcan;vApp.wb.prvObj=this.fdObj.finalizeDrawingPath(vApp.wb.canvas);a.main.children[a.main.children.length-1].mt=vApp.wb.utility.stringToNumber(vApp.wb.prvObj.path[vApp.wb.prvObj.path.length-1][3])}}}})(window);(function(e){_replay=function(){return{init:function(a,b){var c=vApp.wb.vcan;this.objs="undefined"!=typeof b?c.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=a;this.callBkfunc=""},renderObj:function(a){vApp.wb.drawMode=!0;if("undefined"==typeof this.objs[this.objNo])console.log("is this happend");else{"undefined"!=typeof a&&(this.callBkfunc=a);if(this.objs[this.objNo].hasOwnProperty("cmd"))vApp.wb.gObj.displayedObjId=this.objs[this.objNo].uid,vApp.wb.toolInit(this.objs[this.objNo].cmd,
"fromFile",!0);else{a="";"d"==this.objs[this.objNo].ac?a="mousedown":"m"==this.objs[this.objNo].ac?a="mousemove":"u"==this.objs[this.objNo].ac&&(a="mouseup");var b=this.objs[this.objNo],b=b.hasOwnProperty("mtext")?{detail:{cevent:{x:b.x,y:b.y,mtext:b.mtext}}}:{detail:{cevent:{x:b.x,y:b.y}}};vApp.wb.gObj.displayedObjId=this.objs[this.objNo].uid;a=new CustomEvent(a,b);vcan.main.canvas.dispatchEvent(a)}"function"==typeof this.callBkfunc&&this.objs[this.objs.length-1].uid==vApp.wb.gObj.displayedObjId&&
this.callBkfunc("callBkfunc");if("object"==typeof this.objs[this.objNo+1]){vApp.wb.replayTime="undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?this.objs[this.objNo].mt-vApp.wb.pageEnteredTime:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;this.objNo++;var c=this;setTimeout(function(){c.renderObj.call(c)},vApp.wb.replayTime)}}}}};e._replay=_replay})(window);(function(e){e.readyTextObj=function(){return{init:function(a){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=a;this.muser=!1},textUtility:function(a,b,c){this.startPosX=a;this.startPosY=b;var d=vApp.wb.vcan,f=d.main.canvas.getContext("2d"),h={};this.textWriteMode++;this.wmode=!0;void 0!=d.main.currentTransform&&""!=d.main.currentTransform?(this.currObject=d.main.currentTransform.target,
void 0!=this.currObject&&"text"==this.currObject.type&&(h={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},vApp.wb.utility.clickOutSidebox(this.textWriteMode)||vApp.wb.obj.drawTextObj.drawTextBoxWrapper(h,this.currObject.id),d.main.currentTransform=""),vApp.wb.utility.clickOutSidebox(this.textWriteMode)&&vApp.wb.obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,f),void 0!=this.currObject&&"text"==this.currObject.type&&
(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):vApp.wb.utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof c?vApp.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,f,c):vApp.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,f):(this.totalBox++,h={x:a,y:b,width:300,height:100},"undefined"==typeof c?vApp.wb.obj.drawTextObj.drawTextBoxWrapper(h,
this.totalBox):vApp.wb.obj.drawTextObj.drawTextBoxWrapper(h,this.totalBox,c))},drawTextBoxWrapper:function(a,b,c){var d=vApp.wb.vcan;c=document.createElement("div");c.id="box"+b;c.className="textBoxContainer";c.style.position="absolute";c.style.left=d.main.offset.x+a.x+"px";c.style.top=a.y+"px";b=document.createElement("textarea");b.id=c.id+"textarea";b.rows=8;b.cols=41;void 0!=a.text&&""!=a.text&&(b.value=a.text);c.appendChild(b);document.getElementById(this.boxContainer).appendChild(c);this.prevTextObj=
c;this.currTextObjWrapper=a;this.prevTextObj.measure=a},renderText:function(a,b,c,d){var f=vApp.wb.vcan;if(""!=this.prevTextObj){if(!vApp.wb.utility.IsObjEmpty(a))for(var h=0;h<f.main.children.length;h++)if(a.id==f.main.children[h].id){f.main.children.splice(h,1);this.currObject="";break}vApp.wb.utility.IsObjEmpty(a)?"undefined"!=typeof d?this.finalizeText(c,this.prevTextObj,void 0,d):this.finalizeText(c,this.prevTextObj):"undefined"!=typeof d?this.finalizeText(c,this.prevTextObj,b,d):this.finalizeText(c,
this.prevTextObj,b);vApp.wb.obj.drawTextObj.wmode=!1}},finalizeText:function(a,b,c,d){c=vApp.wb.vcan;var f=document.getElementById(b.id),h="";if("undefined"==typeof d){d=f.getElementsByTagName("textarea");for(var g=0;g<d.length;g++)if(d[g].id==f.id+"textarea"){h=d[g].value;break}}else h=d;a.font="20px Times New Roman";var e=0,m=h.split(/\r?\n/),e=a.measureText(m[0]).width;d=15;for(g=1;g<m.length;g++){d+=15;var l=a.measureText(m[g]).width;l>e&&(e=l)}e/=2;g=(new Date).getTime();a={type:"text",text:h,
x:b.measure.x+e,y:b.measure.y+d,fontSize:20,fontWidth:a.measureText(h).width,mp:{x:b.measure.x,y:b.measure.y}};!1==vApp.wb.obj.drawTextObj.muser&&(h={mt:g,ac:"d",x:this.startPosX,y:this.startPosY,mtext:a.text},vApp.wb.uid++,h.uid=vApp.wb.uid,c.main.replayObjs.push(h),vApp.storage.store(JSON.stringify(c.main.replayObjs)),vApp.storage.wholeStore(h),vApp.wb.utility.beforeSend({repObj:[h]}),vApp.wb.utility.updateSentPackets(h));a=vApp.wb.canvas.readyObject(a);vApp.wb.canvas.addObject(a);c.main.children[c.main.children.length-
1].mt=g;f.parentNode.removeChild(b);c.renderAll();0<vApp.wb.sentPackets&&null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=vApp.wb.sentPackets)}}}})(window);(function(e){e.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(a){a.shiftKey&&(console.log("what happend mere bhai"),vApp.wb.keyBoard.skey=!0,vApp.wb.keyBoard.prvTool=vApp.wb.tool.cmd,vApp.wb.toolInit("t_activeall"),a={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(a),vApp.wb.utility.beforeSend({repObj:[a]}),vApp.wb.vcan.main.action="move")},triggerdeActiveAll:function(a){vApp.wb.keyBoard.skey&&(console.log("what happend mere bhai ddd"),a=(new Date).getTime(),vApp.wb.utility.deActiveFrmDragDrop(),
vApp.wb.toolInit(vApp.wb.keyBoard.prvTool),a={cmd:vApp.wb.keyBoard.prvTool,mt:a},vcan.main.replayObjs.push(a),vApp.wb.utility.beforeSend({repObj:[a]}))}}})(window);(function(e){e.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init:function(a){!0==vApp.system.wbRtc.peerCon&&!0==vApp.system.wbRtc.userMedia&&(a.mozGetUserMedia?(e.webrtcDetectedBrowser="firefox",this.RTCPeerConnection=mozRTCPeerConnection,this.RTCSessionDescription=mozRTCSessionDescription,this.RTCIceCandidate=mozRTCIceCandidate,a.getUserMedia=a.mozGetUserMedia,this.attachMediaStream=function(a,c){this.videoAdd=!0;console.log("Attaching media stream");a.mozSrcObject=
c;a.play()},reattachMediaStream=function(a,c){console.log("Reattaching media stream");a.mozSrcObject=c.mozSrcObject;a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):a.webkitGetUserMedia?(console.log("This appears to be Chrome"),e.webrtcDetectedBrowser="chrome",this.RTCPeerConnection=webkitRTCPeerConnection,this.RTCSessionDescription=RTCSessionDescription,this.RTCIceCandidate=RTCIceCandidate,a.getUserMedia=a.webkitGetUserMedia,
this.attachMediaStream=function(a,c){a.src=e.URL.createObjectURL(c);this.videoAdd=!0},reattachMediaStream=function(a,c){a.src=c.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=
function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable"));return a}}}})(window);(function(e){repMode=!1;var a=e.io,b=0,c=0;e.media=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",localStream:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,resampler:new Resampler(44100,8E3,1,4096),rec:"",audioNodes:[],Html5Audio:{audioContext:new AudioContext},init:function(){this.graph=
{height:56,width:4,average:0,display:function(){var a=cthis.video;if("t"==vApp.gObj.uRole){var b=this.height-this.height*this.average/100;this._display(a.tempVidCont,b);this._display(cthis.audio.graph.cvCont,b)}},_display:function(a,b){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,b);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()},canvasForVideo:function(){var a=cthis.video.myVideo.parentNode,b=document.createElement("canvas");b.width=this.width+
3;b.height=this.height;b.id="graphCanvas";a.style.position="relative";b.style.position="absolute";b.style.left=0;b.style.top=-7;a.appendChild(b)}}},ab2str:function(a){return String.fromCharCode.apply(null,new Int8Array(a))},str2ab:function(a){for(var b=new ArrayBuffer(a.length),b=new Int8Array(b),c=0,g=a.length;c<g;c++)b[c]=a.charCodeAt(c);return b},recorderProcess:function(a){(new Date).getTime();if(!repMode){this.calcAverage();a=a.inputBuffer.getChannelData(0);a=this.resampler.resampler(a);this.recordAudio||
(this.recordingLength+=this.bufferSize);a=convertFloat32ToInt16(a);var f=this.audioInLocalStorage(a),h=0,g=0;for(i=0;i<a.length;i++){var e=Math.abs(a[i]);h<e&&(h=e);1E3<e&&g++}1500<h&&150<g?(console.log("Vol "+h+" Count "+g),0==b&&0!=c&&vApp.wb.utility.audioSend(c),vApp.wb.utility.audioSend(f),b=1):1==b?(vApp.wb.utility.audioSend(f),b=0):(console.log("NOT SENT Vol "+h+" Count "+g),c=f)}},audioInLocalStorage:function(a){return G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1})},calcAverage:function(){var a=
new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);for(var b=0,c=a.length,g=0;g<c;g++)b+=a[g];this.graph.average=b/c},audioInGraph:function(){var a=cthis.video;if("t"==vApp.gObj.uRole){var b=this.graph.height-this.graph.height*this.graph.average/100;a.tempVidCont.beginPath();a.tempVidCont.moveTo(a.tempVid.width-this.graph.width,this.graph.height);a.tempVidCont.lineTo(a.tempVid.width-this.graph.width,b);a.tempVidCont.lineWidth=this.graph.width;a.tempVidCont.strokeStyle="rgba(247, 25, 77, 1)";
a.tempVidCont.closePath();a.tempVidCont.stroke()}},play:function(a,b,c){a=G711.decode(a,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});b=this.Html5Audio.audioContext.currentTime+b;var g=this.Html5Audio.audioContext.createBuffer(1,a.length,8E3);g.getChannelData(0).set(a);a=this.Html5Audio.audioContext.createBufferSource();a.buffer=g;a.connect(this.Html5Audio.audioContext.destination);a.start(b,c)},replayInit:function(){vApp.storage.getAllObjs(["audioData"],function(){vApp.gObj.video.audio.replay(0,
0)})},replay:function(a,b){repMode=!0;var c,g,e;0<this.audioNodes.length&&(c=this.mergeBuffers(this.audioNodes),g=this.Html5Audio.audioContext.currentTime+a,e=this.Html5Audio.audioContext.createBuffer(1,c.length,7800),e.getChannelData(0).set(c),c=this.Html5Audio.audioContext.createBufferSource(),c.buffer=e,c.connect(this.Html5Audio.audioContext.destination),c.start(g,b))},mergeBuffers:function(a){for(var b=new Float32Array(this.recordingLength),c=0,g=a.length,e=0;e<g;e++){var m=a[e];console.log("bf Length "+
m.length);b.set(m,c);c+=m.length}return b},assignFromLocal:function(a,b){this.init();for(var c=0;c<a.length;c++){var e=LZString.decompressFromBase64(a[c]),e=this.str2ab(e);samples=G711.decode(e,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});this.audioNodes.push(new Float32Array(samples));this.recordingLength+=16384}"undefined"!=typeof b&&b()},manuPulateStream:function(){var a=cthis.stream;vApp.vutil.chkValueInLocalStorage("recordStart")?vApp.wb.recordStarted=localStorage.getItem("recordStart"):
(vApp.wb.recordStarted=(new Date).getTime(),localStorage.setItem("recordStart",vApp.wb.recordStarted));var b=new (e.AudioContext||e.webkitAudioContext||e.mozAudioContext);analyser=b.createAnalyser();a=b.createMediaStreamSource(a);cthis.audio.bufferSize=16384;cthis.audio.rec=b.createScriptProcessor(cthis.audio.bufferSize,1,1);cthis.audio.initAudioNode();cthis.audio.rec.onaudioprocess=cthis.audio.recorderProcess.bind(cthis.audio);a.connect(analyser);analyser.connect(cthis.audio.rec);cthis.audio.rec.connect(b.destination)},
initAudioNode:function(){(new Date).getTime()},updateInfo:function(){this.audioStreamArr=[];vApp.wb.pageEnteredTime=vApp.wb.recordStarted=(new Date).getTime();repMode=this.recordAudio=!1}},video:{width:75,height:56,tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init:function(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&(this.videoCont.style.maxHeight=this.maxHeight+"px")},calcDimension:function(){this.myVideo.width=this.width;this.myVideo.height=
this.height},removeUser:function(a){a=document.getElementById("user"+a);null!=a&&a.parentNode.removeChild(a)},createElement:function(a){var b=document.createElement("div");b.className="videoWrapper";var c=document.createElement("div");c.className="videoSubWrapper";c.id="user"+a.id;b.appendChild(c);vidId=a.id;var e=document.createElement("canvas");e.id="video"+vidId;e.className="userVideos";e.width=this.width;e.height=this.height;c.appendChild(e);cthis.video.imageReplaceWithVideo(a.id,b)},updateHightInSideBar:function(a){var b=
document.getElementById("widgetRightSide").offsetHeight;document.getElementById("chatContainer").style.height=b-a+"px"},send:function(){function a(){console.log("send time "+(5E3*parseInt(vApp.gObj.totalUser,10)+randomTime));clearInterval(vApp.gObj.video.smallVid);if("t"==vApp.gObj.uRole){if("undefined"==typeof e){var e=document.getElementById("graphCanvas");null!=e&&(cthis.audio.graph.cvCont=e.getContext("2d"))}null!=e&&cthis.audio.graph.cvCont.clearRect(0,0,e.width,e.height)}b.tempVidCont.clearRect(0,
0,b.tempVid.width,b.tempVid.height);b.tempVidCont.drawImage(b.myVideo,0,0,b.width,b.height);"t"==vApp.gObj.uRole&&cthis.audio.graph.display();c=b.tempVid.toDataURL("image/jpg",.2);e={name:vApp.gObj.uName,id:vApp.gObj.uid};"t"==vApp.gObj.uRole&&(e.role=vApp.gObj.uRole);vApp.wb.utility.beforeSend({user:e,videoByImage:c});vApp.gObj.video.smallVid=setInterval(a,5E3*vApp.gObj.totalUser+randomTime)}var b=this,c;randomTime=Math.floor(10001*Math.random())+5E3;vApp.gObj.video.smallVid=setInterval(a,5E3*vApp.gObj.totalUser+
randomTime)},startToStream:function(){cthis.video.calcDimension();cthis.video.send()},playWithoutSlice:function(a){var b=a.videoByImage,c=new Image;c.src=b;this.remoteVid=document.getElementById("video"+a.user.id);this.remoteVidCont=this.remoteVid.getContext("2d");var e=this;c.onload=function(){e.remoteVidCont.drawImage(this,0,0)}},justForDemo:function(){var a=0,b=document.getElementById("allVideosCont");b.style.maxHeight="250px";setInterval(function(){if(20>=++a){b=document.getElementById("allVideosCont");
var c=document.createElement("div");c.className="videoWrapper";var e=document.createElement("div");e.className="videoSubWrapper";e.setAttribute("data-uname","suman"+a);c.appendChild(e);var n=document.createElement("video");n.className="userVideo";n.src="http://html5demos.com/assets/dizzy.mp4";e.appendChild(n);b.appendChild(c);250<=b.offsetHeight&&"undefined"!=b.style.overflowY&&"scroll"!=b.style.overflowY&&(b.style.overflowY="scroll",document.getElementById(vApp.gObj.chat.mainChatBoxId).style.borderTop=
"3px solid #bbb")}},200)},createVideoElement:function(){var a=document.createElement("div");a.className="videoWrapper";var b=document.createElement("div");b.className="videoSubWrapper";a.appendChild(b);var c=document.createElement("video");c.id="video"+vApp.gObj.uid;c.autoplay=!0;b.appendChild(c);return a},imageReplaceWithVideo:function(a,b){var c=document.getElementById("ml"+a).getElementsByTagName("a")[0],e=c.getElementsByTagName("img")[0];c.replaceChild(b,e)},insertTempVideo:function(a){var b=
document.createElement("canvas");b.id="tempVideo";a.parentNode.insertBefore(b,a)},tempVideoInit:function(){cthis.video.tempVid=document.getElementById("tempVideo");cthis.video.tempVid.width=cthis.video.width;cthis.video.tempVid.height=cthis.video.height;cthis.video.tempVidCont=cthis.video.tempVid.getContext("2d")}},init:function(a){cthis=this;vcan.oneExecuted=!0;a={audio:!0,video:!0};cthis.video.init();vApp.adpt=new vApp.adapter;vApp.adpt.init(navigator).getUserMedia(a,this.handleUserMedia,this.handleUserMediaError);
vApp.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(vApp.wb.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0)},handleUserMedia:function(a){cthis.video.tempStream=a;cthis.audio.init();a=document.getElementById("ml"+vApp.gObj.uid);null!=a&&null!=a.getElementsByTagName("video")&&cthis._handleUserMedia()},_handleUserMedia:function(){var a=cthis.video.tempStream,b=document.getElementById("ml"+vApp.gObj.uid);null!=b&&(b.style.pointerEvents="none");"undefined"!=typeof a&&(b=cthis.video.createVideoElement(),
cthis.video.imageReplaceWithVideo(id,b),cthis.video.insertTempVideo(b),cthis.video.tempVideoInit(),cthis.video.myVideo=document.getElementById("video"+vApp.gObj.uid),vApp.adpt.attachMediaStream(cthis.video.myVideo,a),cthis.video.myVideo.muted=!0,a.ontimeupdate=function(){console.log("raja"+a.currentTime)},"t"==vApp.gObj.uRole&&(cthis.stream=a,cthis.audio.manuPulateStream(),cthis.audio.graph.canvasForVideo()),cthis.video.myVideo.onloadedmetadata=function(){cthis.video.startToStream()})},updateVidContHeight:function(){var a=
document.getElementById("vAppCont"),a=vcan.utility.getElementOffset(a),a=e.innerHeight-(a.y+75);document.getElementById("chat_div").style.maxHeight=a+"px"},createDemoUserList:function(){for(var a,b=5;15>b;b++)a={img:"./images/quality-support.png",name:"Student "+b,userid:100+b},memberUpdate({message:[a]});return[]},close:function(){vApp.gObj.video.hasOwnProperty("smallVid")&&clearInterval(vApp.gObj.video.smallVid)},dispAllVideo:function(a){setTimeout(function(){var b=document.getElementById(a);if(null!=
b)for(var b=b.getElementsByTagName("video"),c=0;c<b.length;c++)b[c].play()},1040)},sendMessage:function(a){1<arguments.length?vApp.wb.utility.beforeSend({video:a},arguments[1]):vApp.wb.utility.beforeSend({video:a})},existVideoContainer:function(a){for(var b=document.getElementsByClassName("userVideos"),c=0;c<b.length;c++)if(b[c].id=="video"+a.id)return!0;return!1},handleUserMediaError:function(a){vApp.wb.view.disappearBox("WebRtc");console.log("navigator.getUserMedia error: ",a)}}};e.onbeforeunload=
function(){if("undefined"!=typeof vApp.storage.wholeStoreData){var b=JSON.parse(vApp.storage.wholeStoreData);b.beforeRefresh=!0;vApp.storage.wholeStore(b,"put")}localStorage.removeItem("otherRole");vApp.wb.utility.userIds=[];cthis.sendMessage("bye");a.disconnect()}})(window);(function(e){var a={requestPackets:function(a){1<a.length&&(vApp.wb.gObj.myArr=a);vApp.wb.sentReq=!0;return[vApp.wb.gObj.rcvdPackId,a[0].uid]},makeQueue:function(a){vApp.wb.gObj.rcvdPackId!=vApp.wb.gObj.displayedObjId&&(vApp.wb.gObj.packQueue=vApp.wb.gObj.packQueue.concat(a.message.repObj))},sendPackets:function(a,c){if(0==a.message.getMsPckt[0])var d=-1;else for(d=0;d<vApp.wb.gObj.myrepObj.length&&a.message.getMsPckt[0]!=vApp.wb.gObj.myrepObj[d].uid;d++);for(d+=1;d<a.message.getMsPckt[1];d++)c.push(vApp.wb.gObj.myrepObj[d]);
return c},handleMissedPackets:function(b,c,d){d=this.removeDupObjs(d);vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.concat(d);a.sortingReplyObjs();b!=c&&vApp.storage.store(JSON.stringify(vApp.wb.gObj.replayObjs));this.containsIfQueuePacks(b,c,vApp.wb.gObj.displayedObjId,d)},removeDupObjs:function(a){0<vApp.wb.gObj.myArr.length&&(a[a.length-1].uid==vApp.wb.gObj.myArr[0].uid&&(vApp.wb.gObj.myArr[0].hasOwnProperty("cmd")||vApp.wb.gObj.myArr.shift()),a=a.concat(vApp.wb.gObj.myArr),vApp.wb.gObj.myArr=
[]);return a},containsIfQueuePacks:function(a,c,d,e){a!=c&&d+1!=e[0].uid&&0<vApp.wb.gObj.packQueue.length&&e[e.length-1].uid==vApp.wb.gObj.packQueue[0].uid&&(vApp.wb.gObj.packQueue=e.concat(vApp.wb.gObj.packQueue))},sortingReplyObjs:function(){vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.sort(function(a,c){return a.uid-c.uid})}};e.bridge=a})(window);(function(e){vcan.optimize={sendPacketWithOptimization:function(a,b,c){"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),vApp.wb.sentPackets+=a.length,1==b&&vApp.wb.utility.beforeSend(JSON.parse(a)),vApp.wb.utility.updateSentInformation(a,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=c&&(vApp.wb.sentPackets+=a.length,1==b&&io.send(JSON.parse(a)),vApp.wb.utility.updateSentInformation(a,!0),this.lastarrowtime=(new Date).getTime())},
doOptiMize:function(a){if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),a.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,a.clientY-vcan.main.offset.y);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),a.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,
a.clientY-vcan.main.offset.y),vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,a.clientY-vcan.main.offset.y),lastmousemovetime=(new Date).getTime())},calculatePackets:function(a,b,c,d){a=vcan.makeStackObj(a,b,c,d);vApp.wb.uid++;a.uid=vApp.wb.uid;vcan.main.replayObjs.push(a);vApp.wb.utility.beforeSend({repObj:[a]});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(a);vApp.wb.utility.updateSentPackets(a)}}})(window);(function(e){e.response={reclaimRole:function(a,b){if(a!=b){vApp.wb.utility.removeToolBox();vApp.wb.utility.makeCanvasDisable();"undefined"!=typeof localStorage.teacherId&&localStorage.removeItem("teacherId");vApp.wb.utility.uniqueArrOfObjsToStudent();vApp.wb.view.disappearBox("Canvas");vApp.wb.view.disappearBox("drawArea");var c=document.getElementById("vcanvas");c.className=c.className.replace(/\bteacher\b/," ");c.className="student";localStorage.setItem("canvasDrwMsg",!0);vApp.vutil.chkValueInLocalStorage("orginialTeacherId")||
vApp.wb.utility.setCommandToolHeights(d,"decrement")}else{if(vApp.vutil.chkValueInLocalStorage("orginialTeacherId")){var d=localStorage.getItem("toolHeight");vApp.wb.utility.setCommandToolHeights(d,"increment")}vApp.wb.utility.uniqueArrOfObjsToTeacher();c=document.getElementById("vcanvas");c.className=c.className.replace(/\bstudent\b/," ");c.className="teacher";localStorage.canvasDrwMsg=!0}},assignRole:function(a,b,c,d){a!=b?(vApp.wb.socketOn=parseInt(c),vApp.wb.utility.setClass("vcanvas","socketon"),
vApp.wb.utility.assignRole(b),vApp.wb.utility.uniqueArrOfObjsToTeacher(),vApp.vutil.chkValueInLocalStorage("canvasDrwMsg")||(e.vApp.wb.view.canvasDrawMsg("Canvas"),e.vApp.wb.view.drawLabel("drawArea"),localStorage.setItem("canvasDrwMsg",!0)),a=document.getElementById("vcanvas"),a.className=a.className.replace(/\bstudent\b/," "),a.className="teacher",d=localStorage.getItem("toolHeight"),vApp.wb.utility.setCommandToolHeights(d,"increment")):(vApp.wb.utility.uniqueArrOfObjsToStudent(),vApp.vutil.chkValueInLocalStorage("orginalTeacherId")||
(a=document.getElementById("vcanvas"),a.className=a.className.replace(/\bteacher\b/," "),a.className="student"),null==localStorage.getItem("orginialTeacherId")&&vApp.wb.utility.setCommandToolHeights(d,"decrement"),localStorage.setItem("canvasDrwMsg",!0))},checkUser:function(a,b,c){"undefined"!=typeof vcan.teacher||c||vApp.wb.utility.makeCanvasDisable();vApp.wb.utility.initDefaultInfo(a,wbUser.role);vApp.wb.utility.makeUserAvailable(a.message.checkUser.e.clientLen)},clearAll:function(a,b,c,d){a!=b&&
(vApp.wb.tool=new vApp.wb.tool_obj("t_clearall"),vApp.wb.utility.t_clearallInit(),vApp.wb.utility.makeDefaultValue(),vApp.storage.clearStorageData());d&&vApp.wb.utility.updateRcvdInformation(c)},replayAll:function(){e.vApp.wb.vcan.main.replayObjs=vApp.wb.gObj.replayObjs;vApp.wb.utility.clearAll(!1);vApp.wb.toolInit("t_replay","fromFile")},createArrow:function(a,b){var c=vApp.wb.arrImg,d={};d.mp={x:a.x,y:a.y};vApp.wb.utility.drawArrowImg(c,d);b&&vApp.wb.utility.updateRcvdInformation(a)},replayObj:function(a){e.vApp.wb.vcan.main.replayObjs=
[];0<a.length&&vApp.wb.gObj.displayedObjId+1==a[0].uid&&(e.vApp.wb.vcan.main.replayObjs=a,vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket))},chunk:function(a,b,c){vApp.wb.bridge.handleMissedPackets(a,b,c)},repObjForMissedPkts:function(a){(0!=vApp.wb.gObj.rcvdPackId||0<vApp.wb.uid&&0==vApp.wb.gObj.rcvdPackId)&&("object"==typeof a||a instanceof Array)&&a[0].hasOwnProperty("uid")&&vApp.wb.gObj.rcvdPackId+1!=a[0].uid&&!a.hasOwnProperty("chunk")&&Number(vApp.wb.gObj.rcvdPackId)<
Number(a[0].uid)&&(a=vApp.wb.bridge.requestPackets(a),vApp.wb.utility.beforeSend({getMsPckt:a}))}}})(window);
