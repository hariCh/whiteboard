(function(f,b){var a={cmdWrapperDiv:"commandToolsWrapper",create:function(b){if("#"==b.charAt(0)){var c=b.substring(1,b.length);a.utility.canvasCalcOffset(c);return new a.main(b)}alert("there is a problem with canvas id")},main:function(d){a.main.children=[];a.main.id=0;a.main.uid=0;a.main.canvas=b.querySelector(d);a.main.canid=d.substring(1,d.length);a.main.currentTransform="";a.main.replayObjs=[];a.main.dragMode=!1;a.main.scaleMode=!1;a.main.usrCurrAction="";a.main.currObj="";a.main.textObj=!1;
a.main.action="create";a.wb={};a.wb.sentPack=!1;a.activMouse=new a.mouse;a.activMouse.init()},extend:function(a,c){if("object"==typeof a&&"object"==typeof c){for(var b in c)a[b]=c[b];return a}alert("it seems that the arguments you passed are not object")},transform:function(a,c){a.translate(c.x,c.y);a.rotate(c.theta);a.scale(c.scaleX*(c.flipX?-1:1),c.scaleY*(c.flipY?-1:1))},getStates:function(b){return a.main[b]},setValInMain:function(b,c){return a.main[b]=c},ArrayIndexOf:function(a,c){if(!c||"function"!=
typeof c||!a||!a.length||1>a.length)return-1;for(var b=0;b<a.length;b++)if(c(a[b]))return b;return-1},renderAll:function(b){var c=a.main.children.length;"object"!=typeof b&&(b=a.main.canvas.getContext("2d"));a.clearContext(b);if(c)for(var e=0;e<c;++e)"freeDrawing"==a.main.children[e].type?a.fhdRender(b,a.main.children[e]):a.render(b,a.main.children[e])},clearContext:function(b){var c=a.main.canvas;b.clearRect(0,0,c.width,c.height);return c},deactivateAll:function(){for(var b=a.main.children,c=0,e=
b.length;c<e;c++)b[c].setActive(!1)},makeDispObject:function(a){return{coreObj:a,bind:function(a,b){this.addEventListener("on"+a,b)}}},remove:function(b){var c=a.main.canvas,e=a.ArrayIndexOf(a.main.children,function(a){return a.id==b.id&&(a.mt==b.mt||!0==b.multiuser)});0<=e&&a.main.children.splice(e,1);var e=c.height,g=c.width,c=c.getContext("2d");c.beginPath();c.clearRect(0,0,g,e);c.closePath();a.renderAll()},render:function(b,c,e){b.beginPath();b.save();b.lineWidth=void 0!==b.lineWidth?c.lineWidth:
2;e||a.transform(b,c);b.strokeStyle=void 0!=c.borderColor?c.borderColor:"#000000";"rectangle"==c.type?a.objRect.draw(b,c,e):"line"==c.type?a.objLine.draw(b,c,e):"oval"==c.type?a.objOval.draw(b,c,e):"triangle"==c.type?a.objTri.draw(b,c,e):"text"==c.type&&a.objTxt.draw(b,c,e);c.active&&!e&&(c.drawBorders(b),c.hideCorners||c.drawCorners(b));b.closePath();b.restore()},fhdRender:function(b,c,e){b.save();var g=c.transformMatrix;g&&b.transform(g[0],g[1],g[2],g[3],g[4],g[5]);e||a.transform(b,c);c.overlayFill?
b.fillStyle=c.overlayFill:c.fill&&(b.fillStyle=c.fill);c.stroke&&(b.strokeStyle=c.stroke);b.beginPath();var h;h=g=0;for(var n=-(c.width/2),f=-(c.height/2),l=0,k=c.path.length;l<k;++l)switch(h=c.path[l],h[0]){case "L":g=h[1];h=h[2];b.lineTo(g+n,h+f);break;case "M":g=h[1],h=h[2],b.moveTo(g+n,h+f)}c.fill&&b.fill();c.stroke&&(b.strokeStyle=c.stroke,b.lineWidth=c.strokeWidth,b.lineCap=b.lineJoin="round",b.stroke());!e&&c.active&&(c.drawBorders(b),c.hideCorners||c.drawCorners(b));b.restore()},makeStackObj:function(a,
c,b,g){return{mt:a,ac:c,x:b,y:g}}};f.vcan=a})(window,document);(function(f,b){f.whiteboard=function(a){var d=a.hasOwnProperty("id")?a.id:"appWhitebaordCont";a=a.hasOwnProperty("class");return{id:d,classes:a,tool:"",obj:{},prvObj:"",replayTime:0,sentPackets:0,sentPackDiv:"sentPacket",sentPackDivPS:"sentPacketPS",receivedPackets:0,receivedPackDiv:"receivedNumber",receivedPackDivPS:"receivedNumberPS",uid:0,lt:"",commandToolsWrapperId:"commandToolsWrapper",view:{},lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],virtualWindow:!1},
init:function(){vApp.wb.vcan=f.vcan;var a=vApp.wb.vcan;vApp.wb.canvas=a.create("#canvas");a=a.main.canvas;a.setAttribute("tabindex","0");a.focus();a.onkeydown=vApp.wb.utility.keyOperation;vApp.system.setCanvasDimension();"undefined"!==typeof Storage&&(f.vApp.wb=vApp.wb);this.arrowInit();var d=vApp.wb.sentPackets;vApp.clear=setInterval(function(){null!=b.getElementById(vApp.wb.sentPackDivPS)&&(d=vApp.wb.utility.calcPsSentPackets(d),b.getElementById(vApp.wb.sentPackDiv).innerHTML=vApp.wb.sentPackets)},
1E3);this._init()},_init:function(){vApp.vutil.chkValueInLocalStorage("orginalTeacherId")?vApp.wb.pageEnteredTime=localStorage.getItem("pageEnteredTime"):(vApp.wb.pageEnteredTime=(new Date).getTime(),localStorage.setItem("pageEnteredTime",vApp.wb.pageEnteredTime));vApp.wb.oTeacher=vApp.vutil.chkValueInLocalStorage("orginalTeacherId");vApp.vutil.chkValueInLocalStorage("rcvdPackId")?vApp.wb.gObj.rcvdPackId=parseInt(localStorage.rcvdPackId):vApp.wb.gObj.rcvdPackId=0;f.addEventListener("resize",vApp.wb.utility.lockCanvas);
f.addEventListener("click",function(){vApp.wb.view.disappearBox("WebRtc");vApp.wb.view.disappearBox("Canvas");vApp.wb.view.disappearBox("drawArea")});var a=vApp.vutil.chkValueInLocalStorage("reclaim");this.stHasTeacher=vApp.vutil.chkValueInLocalStorage("teacherId");vApp.wb.utility.setUserStatus(this.stHasTeacher,a);if(vApp.vutil.chkValueInLocalStorage("reclaim")){a=b.getElementById(vApp.wb.commandToolsWrapperId);if(null!=a)for(;a.hasChildNodes();)a.removeChild(a.lastChild);vApp.wb.utility.createReclaimButton(a)}vApp.wb.utility.crateCanvasDrawMesssage()},
arrowInit:function(){this.arrImg=new Image;this.arrImg.src="undefined"!=typeof f.whiteboardPath?f.whiteboardPath+"/images/arrow.png":"/images/arrow.png";this.arrImgDraw=!1;var a=this;this.arrImg.onload=function(){a.arrImgDraw=!0}},createCommand:function(){if(vApp.wb.utility.alreadyExistToolBar())return!0;var a=b.createElement("div");a.id=vApp.wb.commandToolsWrapperId;var d=b.getElementById(vcan.canvasWrapperId);null!=d?b.getElementById("containerWb").insertBefore(a,d):b.getElementById("containerWb").appendChild(a);
vApp.wb.createDiv("t_rectangle","rectangle",a,"tool");vApp.wb.createDiv("t_line","line",a,"tool");vApp.wb.createDiv("t_freeDrawing","freeDrawing",a,"tool");vApp.wb.createDiv("t_oval","oval",a,"tool");vApp.wb.createDiv("t_triangle","triangle",a,"tool");vApp.wb.createDiv("t_text","text",a,"tool");vApp.wb.createDiv("t_activeall","activeAll",a,"tool");vApp.wb.createDiv("t_clearall","clearAll",a,"tool");vApp.wb.createDiv("t_replay","Replay",a,"tool");vApp.wb.socketOn=parseInt(wbUser.socketOn);1==vApp.wb.socketOn&&
vApp.wb.utility.setClass("vcanvas","socketon")},createDiv:function(a,d,g,h){var n=b.createElement("a");n.href="#";var m=b.createElement("div");m.id=a;"undefined"!=typeof h&&(m.className=h);a=b.createElement("img");a.alt=vApp.lang.getString(d);a.src="undefined"!=typeof f.whiteboardPath?f.whiteboardPath+"/images/"+d+".png":"/images/"+d+".png";n.appendChild(a);n.title="";n.dataset.title=d;n.className="tooltip";m.appendChild(n);g.appendChild(m);b.getElementById(vcan.canvasWrapperId)},createCanvas:function(){var a=
b.createElement("div");a.id=vcan.canvasWrapperId;vcan.canvasWrapperId=a.id;var d=b.createElement("canvas");d.id="canvas";d.innerHTML="Canvas is missing in your browsers. Please update the latest version of your browser";a.appendChild(d);b.getElementById("containerWb").appendChild(a)},objInit:function(a){"t_replay"==this.parentNode.id?(vApp.wb.utility.clearAll(!1),vApp.wb.utility.beforeSend({replayAll:!0})):vApp.wb.toolInit(this.parentNode.id);"t_replay"!=this.parentNode.id&&"t_clearall"!=this.parentNode.id&&
"t_reclaim"!=this.parentNode.id&&"t_assign"!=this.parentNode.id&&(a=(new Date).getTime(),vApp.wb.lt=this.parentNode.id,a={cmd:this.parentNode.id,mt:a},vApp.wb.uid++,a.uid=vApp.wb.uid,vcan.main.replayObjs.push(a),vApp.storage.wholeStore(a),vApp.wb.utility.beforeSend({repObj:[a]}))},attachToolFunction:function(a,d){vcan.canvasWrapperId="canvasWrapper";vApp.wb.createCommand(d);if("undefined"==typeof d){null==b.getElementById("canvas")&&vApp.wb.createCanvas();var g=vApp.vutil.chkValueInLocalStorage("orginalTeacherId");
vApp.wb.dataInfo=parseInt(wbUser.dataInfo);g&&1==vApp.wb.dataInfo&&!vApp.wb.utility.alreadyExistPacketContainer()&&(vApp.wb.packContainer.createPacketContainer(),vApp.wb.packContainer.createPacketInfoContainer(),vApp.wb.utility.initStoredPacketsNumbers())}for(var g=b.getElementById(a).getElementsByTagName("div"),h=0;h<g.length;h++)g[h].getElementsByTagName("a")[0].addEventListener("click",vApp.wb.objInit)},toolInit:function(a,b,d,h){"object"==typeof vApp.wb.obj.drawTextObj&&!0==vApp.wb.obj.drawTextObj.wmode&&
vcan.main.canvas.getContext("2d");0<vApp.wb.vcan.getStates("children").length&&"t_clearall"!=a&&("undefined"!=typeof d&&"t_replay"==a||vApp.wb.utility.deActiveFrmDragDrop(),!0!=d&&"t_replay"!=a&&vApp.wb.vcan.renderAll());vApp.wb.utility.IsObjEmpty(vApp.wb.obj.freeDrawObj&&!1==d)||(vApp.wb.obj.freeDrawObj.freesvg=!1);vApp.wb.vcan.main.currUserCommand=a+"Init";"t_activeall"==a&&vApp.wb.utility.t_activeallInit();"t_replay"==a&&("undefined"==typeof d&&vcan.setValInMain("id",0),"undefined"!=typeof h?vApp.wb.t_replayInit(b,
h):vApp.wb.t_replayInit(b));if("t_clearall"==a){if(!confirm(vApp.lang.getString("clearAllWarnMessage")))return;vApp.wb.utility.t_clearallInit();vApp.wb.utility.makeDefaultValue();vApp.storage.clearStorageData();vApp.wb.utility.beforeSend({clearAll:!0})}"t_assign"==a&&(vApp.wb.utility.assignRole(),b=localStorage.getItem("toolHeight"),null!=b?vApp.wb.utility.beforeSend({assignRole:!0,toolHeight:b,socket:vApp.wb.socketOn}):vApp.wb.utility.beforeSend({assignRole:!0,socket:vApp.wb.socketOn}));"t_reclaim"==
a&&(vApp.wb.utility.reclaimRole(),vApp.wb.utility.sendRequest("reclaimRole",!0));"t_activeall"!=a&&"t_replay"!=a&&"t_clearallInit"!=a&&"t_assign"!=a&&"t_reclaim"!=a&&(vApp.wb.tool=new vApp.wb.tool_obj(a),vApp.wb.utility.attachEventHandlers())},tool_obj:function(a){this.cmd=a;"t_freeDrawing"!=a&&(vApp.wb.obj.freeDrawObj="");"t_text"!=a&&(vApp.wb.obj.drawTextObj="");"t_freeDrawing"==a?(vApp.wb.obj.freeDrawObj=new vApp.wb.readyFreeHandObj("#424240","3"),vApp.wb.obj.freeDrawObj.init()):"t_text"==a&&(vApp.wb.obj.drawTextObj=
new vApp.wb.readyTextObj,vApp.wb.obj.drawTextObj.init("canvasWrapper"));a=a.slice(2,a.length);vApp.wb.draw_object(a,vApp.wb.canvas,this)},t_replayInit:function(a,b){"fromFile"==a?(vApp.gObj.chat.removeAllChat(),vApp.wb.recordAudio=!0,vApp.recorder.init()):(vApp.wb.replay=vApp.wb._replay(),"undefined"!=typeof b?(vApp.wb.replay.init(a,b),vApp.wb.replay.renderObj(b)):(vApp.wb.replay.init(a),vApp.wb.replay.renderObj()))}}}})(window,document);(function(f){f.utility=function(){return{userIds:[],isObjExistRE:function(b){if(0<=vApp.wb.replay.removeElements.length){var a=vApp.wb.vcan.ArrayIndexOf(vApp.wb.replay.removeElements,function(a){return a.id==b.id});if(0<=a)return a}},IsObjEmpty:function(b){for(var a in b)if(b.hasOwnProperty(a))return!1;return!0},stringToNumber:function(b){" "==b[b.length-1]&&(b=b.substring(0,b.length-1));return b=Number(b)},clickOutSidebox:function(b){return 1!=b%2?!0:!1},keyOperation:function(b){var a=(new Date).getTime();
if(8==b.keyCode&&(b=vApp.wb.vcan,""!=b.main.currObj)){vApp.wb.canvas.removeObject(b.main.currObj);var d=b.extend({},b.main.currObj),d=b.extend(d,{mt:a,func:"remove",usrCurrAction:"delete",lastElement:!0});b.main.replayObjs.push(d);b.main.currObj=""}},attachEventHandlers:function(){vApp.wb.canvas.bind("mousedown",vApp.wb.utility.ev_canvas);vApp.wb.canvas.bind("mousemove",vApp.wb.utility.ev_canvas);vApp.wb.canvas.bind("mouseup",vApp.wb.utility.ev_canvas)},t_clearallInit:function(){vApp.wb.utility.clearAll(!0)},
clearAll:function(b,a){vApp.wb.uid=0;vApp.wb.lt="";for(var d=vApp.wb.vcan;0<d.main.children.length;)vApp.wb.canvas.removeObject(d.main.children[0]);!0==b&&d.main.replayObjs.splice(0,d.main.replayObjs.length);void 0!=vApp.wb.replay&&(vApp.wb.replay.objNo=0);"move"==d.getStates("action")&&d.setValInMain("action","create");d=document.getElementById("sendPackCont");if(null!=d){var c=d.getElementsByClassName("numbers");if(0<c.length)for(d=0;d<c.length;d++)c[d].innerHTML=0}"undefined"==typeof a&&(vApp.wb.sentPackets=
0,vApp.wb.receivedPackets=0);d=document.getElementById("sentMsgInfo");null!=d&&(d.innerHTML="");d=document.getElementById("rcvdMsgInfo");null!=d&&(d.innerHTML="");c=document.getElementsByClassName("textBoxContainer");for(d=0;d<c.length;d++)c[d].parentNode.removeChild(c[d])},deActiveFrmDragDrop:function(){var b=vApp.wb.vcan,a=b.main.children;if("move"==b.getStates("action")){b.setValInMain("action","create");for(b=0;b<a.length;b++)a[b].dragDrop(!1),a[b].setActive(!1);return!0}return!1},getOffset:function(b){for(var a=
b.target,d=y=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)d+=a.offsetLeft-a.scrollLeft,y+=a.offsetTop-a.scrollTop,a=a.offsetParent;d=b.clientX-d;y=b.clientY-y;return{x:d,y:y}},ev_canvas:function(b){var a=vApp.wb.vcan.utility.getReltivePoint(b);b.currX=a.x;b.currY=a.y;if(a=vApp.wb.tool[b.type])return a(b),this.ev_canvas},t_activeallInit:function(){var b=vApp.wb.vcan,a=b.getStates("children");if(1<=a.length)for(b.setValInMain("action","move"),b=0;b<a.length;b++)a[b].dragDrop(!0)},drawArrowImg:function(b,
a){var d=vApp.wb.vcan.main.canvas.getContext("2d");d.clearRect(0,0,vApp.wb.vcan.main.canvas.width,vApp.wb.vcan.main.canvas.height);vcan.renderAll();d.save();d.beginPath();d.translate(a.mp.x,a.mp.y);d.drawImage(b,-3,-3,18,24);d.closePath();d.restore()},calcPsSentPackets:function(b){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId"))return b=vApp.wb.sentPackets-b,0>b&&(b=0),document.getElementById(null!=vApp.wb.sentPackDivPS)&&(document.getElementById(vApp.wb.sentPackDivPS).innerHTML=b),vApp.wb.sentPackets},
calcPsRecvdPackets:function(b){b=vApp.wb.receivedPackets-b;0>b&&(b=0);null!=document.getElementById(vApp.wb.receivedPackDivPS)&&(document.getElementById(vApp.wb.receivedPackDivPS).innerHTML=b);return vApp.wb.receivedPackets},initStoredPacketsNumbers:function(){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId")){if(localStorage.sentPackets){var b=JSON.parse(localStorage.sentPackets);vApp.wb.sentPackets=b;null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=
b)}localStorage.receivedPackets&&(vApp.wb.receivedPackets=JSON.parse(localStorage.receivedPackets),null!=document.getElementById(vApp.wb.receivedPackDiv)&&(document.getElementById(vApp.wb.receivedPackDiv).innerHTML=vApp.wb.receivedPackets))}},updateSentPackets:function(b){1==vApp.wb.dataInfo&&vApp.vutil.chkValueInLocalStorage("orginalTeacherId")&&(vApp.wb.sentPackets+=JSON.stringify(b).length,null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=
vApp.wb.sentPackets))},assignRole:function(b){vApp.wb.tool="";"move"==vcan.main.action&&vApp.wb.utility.deActiveFrmDragDrop();if("undefined"!=typeof b){if(null!=localStorage.getItem("reclaim")){var a=document.getElementById(vApp.wb.commandToolsWrapperId);a.parentNode.removeChild(a);localStorage.removeItem("reclaim")}f.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv,!0);(vApp.wb.hasOwnProperty("canvasDisable")||vApp.wb.canvasDisable)&&vApp.wb.utility.toolWrapperDisable();localStorage.setItem("teacherId",
b);vApp.wb.utility.makeCanvasEnable()}else{a=document.getElementById(vApp.wb.commandToolsWrapperId);if(null!=a)for(;a.hasChildNodes();)a.removeChild(a.lastChild);vApp.wb.utility.makeCanvasDisable();"undefined"!=typeof localStorage.orginalTeacherId?(vApp.wb.utility.createReclaimButton(a),localStorage.setItem("reclaim",!0)):null!=a&&a.parentNode.removeChild(a);localStorage.removeItem("teacherId")}},reclaimRole:function(){vApp.wb.tool="";"move"==vcan.main.action&&vApp.wb.utility.deActiveFrmDragDrop();
vApp.wb.utility.removeToolBox();f.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv,!0);localStorage.teacherId=localStorage.orginalTeacherId;"undefined"!=typeof localStorage.reclaim&&localStorage.removeItem("reclaim");vApp.wb.utility.makeCanvasEnable()},dispQueuePacket:function(b){(null!=localStorage.getItem("teacherId")||null!=localStorage.getItem("orginalTeacherId")&&vApp.vutil.chkValueInLocalStorage("reclaim"))&&vApp.wb.utility.toolWrapperEnable();vApp.wb.drawMode=!1;null!=localStorage.getItem("teacherId")&&
vApp.wb.utility.makeCanvasEnable();0<vApp.wb.gObj.packQueue.length&&(f.vApp.wb.vcan.main.replayObjs=vApp.wb.gObj.packQueue,vApp.wb.gObj.packQueue=[],vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket))},updateRcvdInformation:function(b){var a=document.getElementById("rcvdMsgInfo");if(null!=a){var d="",c;for(c in b)d+=c+" : "+b[c]+" <br />";a.innerHTML=d}},makeCanvasDisable:function(){var b=vcan.main.canvas;b.style.position="relative";b.style.pointerEvents="none"},makeCanvasEnable:function(){null==
localStorage.getItem("teacherId")||vApp.wb.hasOwnProperty("canvasDisable")&&vApp.wb.canvasDisable||(vcan.main.canvas.style.pointerEvents="visible")},removeToolBox:function(){var b=document.getElementById(vcan.cmdWrapperDiv);b.parentNode.removeChild(b)},createReclaimButton:function(b){vApp.wb.createDiv("t_reclaim","reclaim",b);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",vApp.wb.objInit)},chkValueInLocalStorage:function(b){return null===localStorage.getItem(b)?
!1:localStorage[b]},uniqueArrOfObjsToStudent:function(){var b="";vApp.wb.gObj.replayObjs=[];for(var a=0;a<vcan.main.replayObjs.length;a++)b=vcan.extend({},vcan.main.replayObjs[a]),vApp.wb.gObj.replayObjs.push(b)},uniqueArrOfObjsToTeacher:function(){vcan.main.replayObjs=[];for(var b="",a=0;a<vApp.wb.gObj.replayObjs.length;a++)b=vcan.extend({},vApp.wb.gObj.replayObjs[a]),vcan.main.replayObjs.push(b)},makeDefaultValue:function(){vApp.wb.gObj.myrepObj=[];vApp.wb.gObj.replayObjs=[];vApp.wb.gObj.rcvdPackId=
0;vApp.wb.gObj.displayedObjId=0;vApp.wb.gObj.packQueue=[];vApp.wb.uid=0;var b=vApp.vutil.chkValueInLocalStorage("teacherId"),a=vApp.vutil.chkValueInLocalStorage("orginalTeacherId"),d=vApp.vutil.chkValueInLocalStorage("wbrtcMsg"),c=vApp.vutil.chkValueInLocalStorage("canvasDrwMsg"),e=vApp.vutil.chkValueInLocalStorage("toolHeight");localStorage.clear();vApp.recorder.items=[];vApp.gObj.video.audio.bufferSize=0;vApp.gObj.video.audio.encMode="alaw";vApp.gObj.video.audio.rec="";vApp.gObj.video.audio.audioNodes=
[];vApp.gObj.video.audio.initAudioNode();b&&localStorage.setItem("teacherId",b);a&&localStorage.setItem("orginalTeacherId",a);d&&localStorage.setItem("wbrtcMsg",d);c&&localStorage.setItem("canvasDrwMsg",c);e&&localStorage.setItem("toolHeight",e);"undefined"!=typeof vcan.objTxt&&vcan.objTxt.removeTextNode();"undefined"!=typeof vcan.main.currentTransform&&(vcan.main.currentTransform="");vApp.gObj.video.audio.updateInfo()},setOrginalTeacherContent:function(){localStorage.setItem("teacherId",vApp.gObj.uid);
f.vApp.wb.view.canvasDrawMsg("Canvas");localStorage.setItem("canvasDrwMsg",!0);vApp.wb.utility.alreadyExistPacketContainer()||1!=parseInt(wbUser.dataInfo,10)||(vApp.wb.packContainer.createPacketContainer(),vApp.wb.packContainer.createPacketInfoContainer(),vApp.wb.utility.initStoredPacketsNumbers());localStorage.setItem("orginalTeacherId",vApp.gObj.uid)},initDefaultInfo:function(b){"t"==b?null==localStorage.getItem("orginalTeacherId")&&(vApp.wb.utility.setOrginalTeacherContent(),f.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv,
!0)):"s"==b&&(vcan.studentId=wbUser.id,null==localStorage.getItem("studentId")&&localStorage.setItem("studentId",wbUser.id));vApp.gObj.video.init();vApp.gObj.video.isInitiator=!0;vcan.oneExecuted=!1},checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(b){vApp.wb.gObj.virtualWindow=!0;var a=document.createElement("div");vApp.wb.utility.removeVirtualWindow("virtualWindow");
a.setAttribute("id","virtualWindow");a.style.width=b.width+"px";if("undefined"!=typeof assignRoleAtStudent)var d=0;else d=parseInt(localStorage.getItem("toolHeight")),d=null!=d?d:0;null!=localStorage.getItem("orginalTeacherId")?a.style.height=b.height+d+"px":null!=localStorage.getItem("teacherId")?a.style.height=b.height+"px":a.style.height=b.height-d+"px";b=document.getElementById("containerWb");b.insertBefore(a,b.firstChild)},removeVirtualWindow:function(b){b=document.getElementById(b);null!=b&&
(vApp.wb.gObj.virtualWindow=!1,b.parentNode.removeChild(b))},getWideValueAppliedByCss:function(b,a){var d=document.getElementById(b);if(null!=d){var c=f.getComputedStyle(d);if("undefined"!=typeof c.marginTop){var e=parseInt(c.marginTop.match(/\d+/));null==e&&(e=0)}return d.clientHeight+e}return!1},isNumber:function(b){return isNaN(+b)?!1:+b},setCommandToolHeights:function(b,a){var d=document.getElementById("virtualWindow");if(null!=d){var c=parseInt(d.style.height.match(/\d+/));d.style.height="decrement"==
a?c-parseInt(b)+"px":c+parseInt(b)+"px"}},setClass:function(b,a){var d=document.getElementById(b),c=d.classList,e="";0<c.length&&(e=2>e.length?c[0]+" ":c.join(" ")+" ");d.setAttribute("class",e+a)},setStyleUserConnetion:function(b,a,d){b=document.getElementsByClassName(b)[0];null!=b&&b.setAttribute("class",a+" controlCmd")},existUserLikeMe:function(b){if(b.fromUser.userid!=wbUser.id){if(b.message.checkUser.hasOwnProperty("role")){var a=b.message.checkUser.role;if(a){if(null==localStorage.getItem("otherRole")){var d=
[];if(a!=vApp.gObj.uRole)d.push(a);else return existUser=!0}else d=JSON.parse(localStorage.getItem("otherRole")),-1==d.indexOf(a)&&d.push(a);"undefined"!=typeof d&&(localStorage.setItem("otherRole",JSON.stringify(d)),console.log("Other Browser "+a+" "+b.fromUser.userid))}return vApp.gObj.uRole==a?!0:!1}}else{if("undefined"!=typeof existUser)return!0;b=JSON.parse(localStorage.getItem("otherRole"));if(null!=b){for(a=0;a<b.length;a++)if(vApp.gObj.uRole==b[a])return!0;return!1}}},existUserWithSameId:function(b){this.userIds.push(b.fromUser.userid);
if(1<this.userIds.length&&vApp.wb.utility.arrayContainsSameValue(this.userIds[0],this.userIds))return!0},makeUserAvailable:function(){null==localStorage.getItem("repObjs")&&(vApp.wb.utility.toolWrapperEnable(),null!=vcan.main.canvas&&vApp.wb.utility.makeCanvasEnable())},displayCanvas:function(){f.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv);f.vApp.wb.init();vApp.wb.utility.makeCanvasDisable();vApp.wb.utility.toolWrapperDisable()},initAll:function(b){null!=localStorage.getItem("teacherId")&&vApp.wb.utility.makeCanvasDisable();
vApp.system.measureResoultion({width:f.outerWidth,height:f.innerHeight})},alreadyExistToolBar:function(){var b=document.getElementById("t_rectangle");if(null!=b)return 8<=b.parentNode.getElementsByClassName("tool").length?!0:!1},alreadyExistPacketContainer:function(){var b=document.getElementById("packetContainer"),a=document.getElementById("informationCont");return 2<=b.getElementsByTagName("div").length||1<=a.getElementsByTagName("div").length?!0:!1},toolWrapperDisable:function(){var b=document.getElementById("commandToolsWrapper");
null!=b&&(b.style.pointerEvents="none")},toolWrapperEnable:function(){var b=document.getElementById("commandToolsWrapper");null!=b&&(b.style.pointerEvents="visible")},replayFromLocalStroage:function(b){"undefined"!==typeof Storage&&(vApp.wb.vcan.main.replayObjs=b,vApp.wb.utility.clearAll(!1,"dontClear"),vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.concat(b),0<b.length&&(vApp.wb.uid=b[b.length-1].uid,vApp.wb.gObj.rcvdPackId=vApp.wb.uid,vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket)))},
setUserStatus:function(b,a){b||a?vApp.wb.utility.setClass("vcanvas","teacher"):(vApp.wb.utility.removeToolBox(),vApp.wb.utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage:function(){"undefined"!=typeof localStorage.teacherId&&null==localStorage.getItem("canvasDrwMsg")&&(f.vApp.wb.view.canvasDrawMsg("Canvas"),f.vApp.wb.view.drawLabel("drawArea"),localStorage.canvasDrwMsg=!0)},removeOtherUserExist:function(b){"t"==b?null!=localStorage.getItem("studentId")&&localStorage.removeItem("studentId"):
"s"==b&&null!=localStorage.getItem("orginalTeacherId")&&(localStorage.removeItem("orginalTeacherId"),null!=localStorage.getItem("teacherId")&&localStorage.removeItem("teacherId"),null!=localStorage.getItem("reclaim")&&localStorage.removeItem("reclaim"),vApp.wb.utility.removeToolBox())},canvasEnabelWhenRefresh:function(){null!=localStorage.getItem("teacherId")&&vApp.wb.utility.makeCanvasEnable()},arrayContainsSameValue:function(b,a){for(var d=0;d<a.length;d++)if(a[d]!==b)return!1;return!0},actionAfterRemovedUser:function(){vApp.wb.utility.makeCanvasDisable();
vApp.wb.utility.setStyleUserConnetion("con","coff");vApp.wb.utility.removeVirtualWindow("virtualWindow");vApp.wb.user.connected=!1;localStorage.removeItem("otherRole");"undefined"!=typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest:function(b,a){vApp.wb.utility.beforeSend({reclaimRole:!0})},updateSentInformation:function(b,a){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId")){var d=JSON.parse(b),d="undefined"!=typeof a?d:d.repObj[0],c="",e;for(e in d)c+=
e+" : "+d[e]+" <br />";null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=c)}},beforeSend:function(b){var a=JSON.stringify(b);b.hasOwnProperty("createArrow")?vApp.wb.vcan.optimize.sendPacketWithOptimization(a,io.sock.readyState,100):(vApp.wb.sentPackets+=a.length,1==io.sock.readyState&&io.send(b),JSON.parse(a).hasOwnProperty("repObj")&&vApp.wb.utility.updateSentInformation(a));localStorage.sentPackets=vApp.wb.sentPackets},checkCanvasHasParents:function(){for(var b=
document.getElementById("vcanvas");"BODY"!=b.parentNode.tagName;)"vcanvas"!=b.id&&(b.style.margin="0",b.style.padding="0"),b=b.parentNode;"vcanvas"!=b.id&&(b.style.margin="0",b.style.padding="0")},lockCanvas:function(){if(f.earlierWidth!=f.innerWidth&&(vApp.wb.canvasDisable=!0,vApp.wb.utility.makeCanvasDisable(),vApp.wb.utility.toolWrapperDisable(),null==document.getElementById("divForReloadMsg"))){var b=null!=localStorage.getItem("teacherId")?"msgForReload":"msgStudentForReload";f.vApp.wb.view.displayMsgBox("divForReloadMsg",
b);f.earlierWidth=f.innerWidth}},getElementRightOffSet:function(b){var a=20;null!=b.parentNode&&(b=b.parentNode,a=vcan.utility.getElementOffset(b),a=f.innerWidth-(b.clientWidth+(a.x-0)));return a},initUpdateInfo:function(b){b=vApp.wb.receivedPackets;setInterval(function(){null!=document.getElementById(vApp.wb.receivedPackDivPS)&&(b=vApp.wb.utility.calcPsRecvdPackets(b),document.getElementById(vApp.wb.receivedPackDiv).innerHTML=vApp.wb.receivedPackets)},1E3)},objPutInContainer:function(b){vcan.main.replayObjs.push(b);
vApp.storage.store(JSON.stringify(vcan.main.replayObjs))}}}})(window);(function(f){f.message={notSupportCanvas:'This browser does not support Canvas. Please update your browser with the latest versionFor more information about Canvas, click on the link given here <a href="http://en.wikipedia.org/wiki/Canvas_element/">Canvas</a>',notSupportGetUserMedia:'The browser does not support getUserMedia for webRtc. Please update your browser with the latest version For more information about getUuserMedia, click on the link given here <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">getUserMedia</a>',
notSupportPeerConnect:'The browser is unable to create Peer Connection object for WebRtc Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',notSupportWebSocket:'This browser does not support WebSocket. Please update your browser with the latest version. For more information about WebSocket, click on the link given here <a href="http://www.websocket.org/">WebSocket</a>.',notSupportWebRtc:'This browser does not support WebRTC. Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',
line:"Line",rectangle:"Rectangle",triangle:"Triangle",oval:"Oval",assign:"Assign",reclaim:"Reclaim",freeDrawing:"Free Drawing",text:"Text",replay:"Replay",activeAll:"Active All",clearAll:"Clear All",drawArea:"Draw Area",totRcvdPackets:"Total Received Packets",perSecRcvdData:"Per Second Recevied Packet",totSentPackets:"Total Sent Packets",perSecSentPacket:"Per Second Sent Packets",perSecond:"Per Second",sentPackets:"Sent <br/><span>Packets</span>",receviedPackets:"Received <br/><span>Pacekts</span>",
total:"Total",dataDetails:"Data Details",sentMessageInfo:"Sent Message <br/><span>Information</span>",receivedMessageInfo:"Received Message <br/><span>information</span>",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your microphone and camera with other users',wbrtcMsgChrome:"You can click on deny button for not sharing your microphone and camera with other users.or click on allow button to share your microphone and camera with other users.",canvasDrawMsg:"You can click on any tool to draw object with a mouse click, mouse move and mouse up in the Draw Area",
clearAllWarnMessage:"Would you like to clear all what you have drawn on the whiteboard, Once you clear the whiteboard, you will never get those drawn objects back.",cof:"connection off",askForConnect:"You will be able to perform this action only when other user get connected",msgForReload:"You will be unable to draw the objects after resizing the window. <br />  So, please reload the page for drawing. ",msgStudentForReload:"After resizing the window, there can be a problem over the drawn objects, <br />  So, please realod the page for better results ",
reload:"Reload"}})(window);(function(f){f.getString=function(b){return f.vApp.lang.message[b]}})(window);(function(f){var b={init:function(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage:function(a,b,c,e,g){a="undefined"==typeof g?this.createMsgBox(a,b,c):this.createMsgBox(a,b,c,g);b=document.getElementById("vcanvas");"undefined"!=typeof e?document.getElementById(e).appendChild(a):b.insertBefore(a,b.childNodes[0])},customCreateElement:function(a,b,c){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);"undefined"!=typeof c&&(a.className=c);return a},
createMsgBox:function(a,b,c,e){var g=this.customCreateElement("div",b,c);"undefined"==typeof e&&(c=this.customCreateElement("div",b+"img",c+"img"),g.appendChild(c));b=this.customCreateElement("p",b+"Para");b.innerHTML=a;g.appendChild(b);return g},disappearBox:function(a){a=document.getElementsByClassName(this.msgBoxClass+a);null!=a[0]&&a[0].parentNode.removeChild(a[0])},multiMediaMsg:function(a){if("Firefox"==vApp.system.mybrowser.name){var b=vApp.lang.getString("wbrtcMsgFireFox");this.displayMessage(b,
"fireFoxWebrtcCont",this.msgBoxClass+a)}else"Chrome"==vApp.system.mybrowser.name&&(b=vApp.lang.getString("wbrtcMsgChrome"),this.displayMessage(b,"chormeWebrtcCont",this.msgBoxClass+a))},canvasDrawMsg:function(a){document.getElementById("vcanvas").className="canvasMsgBoxParent";if("Firefox"==vApp.system.mybrowser.name){var b=vApp.lang.getString("canvasDrawMsg");this.displayMessage(b,"canvasDrawMsgContFirefox",this.msgBoxClass+a,"containerWb")}else"Chrome"==vApp.system.mybrowser.name&&(b=vApp.lang.getString("canvasDrawMsg"),
this.displayMessage(b,"canvasDrawMsgContChrome",this.msgBoxClass+a,"containerWb"))},drawLabel:function(a){var b=vApp.lang.getString("drawArea");this.displayMessage(b,"canvasDrawArea",this.msgBoxClass+a,"containerWb",!1)},displayMsgBox:function(a,b){var c=this.customCreateElement("div",a),e=this.customCreateElement("p",a+"Para");e.innerHTML=vApp.lang.getString(b);c.appendChild(e);e=this.customCreateElement("a",a+"Anchor");e.href=f.location;e.innerHTML=vApp.lang.getString("reload");e.onclick=function(){f.location.reload()};
c.appendChild(e);e=document.getElementById("vAppCont");e.insertBefore(c,e.firstChild)},displayServerError:function(a,b){var c=this.customCreateElement("div",a);c.innerHTML=b;var e=document.getElementById("vcanvas");e.parentNode.insertBefore(c,e)},removeElement:function(a){a=document.getElementById(a);null!=a&&a.parentNode.removeChild(a)}},b=b.init();count=0;b.window.resizeFinished=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();b.window.resize=function(){var a=vApp.system.measureResoultion({width:f.innerWidth,
height:f.innerHeight});vApp.vutil.setContainerWidth(a);vcan.renderAll()};b.virtualWindow.manupulation=function(a){var b=a.message.virtualWindow;if(b.hasOwnProperty("removeVirtualWindow"))a.fromUser.userid!=wbUser.id&&vApp.wb.utility.removeVirtualWindow("virtualWindow");else if(b.hasOwnProperty("createVirtualWindow"))b.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",b.toolHeight),a.fromUser.userid!=wbUser.id&&vApp.wb.utility.createVirtualWindow(b.createVirtualWindow);else if(b.hasOwnProperty("shareBrowserWidth")){b.hasOwnProperty("toolHeight")&&
localStorage.setItem("toolHeight",b.toolHeight);if(null!=localStorage.getItem("teacherId")){var c=vApp.wb.utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",c)}a.fromUser.userid!=wbUser.id?(null!=localStorage.getItem("teacherId")&&vApp.wb.utility.makeCanvasEnable(),otherBrowser=b.browserRes):myBrowser=vApp.system.measureResoultion({width:f.outerWidth,height:f.innerHeight});"object"==typeof myBrowser&&"object"==typeof otherBrowser&&(myBrowser.width>otherBrowser.width?
vApp.wb.gObj.virtualWindow||(vApp.wb.utility.createVirtualWindow(otherBrowser),vApp.wb.gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!vApp.wb.gObj.virtualWindow&&(a=document.getElementById("vcanvas"),a=vApp.wb.utility.getElementRightOffSet(a),null!=localStorage.getItem("teacherId")?vApp.wb.utility.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a,toolHeight:c}}):vApp.wb.utility.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a}})))}};f.view=b})(window);(function(f){var b={init:function(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport:function(a,b,c){"MSIE"==b?9!=c&&vApp.error.push({msg:vApp.lang.getString("notSupportCanvas"),id:"errorCanvas",className:"error"}):f.CanvasRenderingContext2D||vApp.error.push({msg:vApp.lang.getString("notSupportCanvas"),id:"errorCanvas",className:"error"})},isWebRtcSupport:function(a,b,c){"Firefox"==b?a.mozGetUserMedia?(this.wbRtc.userMedia=!0,f.mozRTCPeerConnection?this.wbRtc.peerCon=
!0:vApp.error.push({msg:vApp.lang.getString("notSupportPeerConnect"),id:"errorPeerConnect",className:"error"})):vApp.error.push({msg:vApp.lang.getString("notSupportGetUserMedia"),id:"errorGetUserMedia",className:"error"}):"Chrome"==b||"Safari"==b?a.webkitGetUserMedia?(this.wbRtc.userMedia=!0,f.webkitRTCPeerConnection?this.wbRtc.peerCon=!0:vApp.error.push({msg:vApp.lang.getString("notSupportPeerConnect"),id:"errorPeerConnect",className:"error"})):vApp.error.push({msg:vApp.lang.getString("notSupportGetUserMedia"),
id:"errorGetUserMedia",className:"error"}):"MSIE"==b&&9>=c&&vApp.error.push({msg:vApp.lang.getString("notSupportWebRtc"),id:"errorWebRtc",className:"error"})},isWebSocketSupport:function(a,b,c){this.webSocket={};"undefined"==typeof f.WebSocket||"function"!=typeof f.WebSocket&&"object"!=typeof f.WebSocket||!f.WebSocket.hasOwnProperty("OPEN")?vApp.error.push({msg:vApp.lang.getString("notSupportWebSocket"),id:"errorWebSocket",className:"error"}):this.webSocket=!0},measureResoultion:function(a){var b=
document.getElementById("vAppCont"),b=vcan.utility.getElementOffset(b),c=b.x;return{width:1024>a.width?1024-c:a.width-c,height:a.height-b.y}},setCanvasDimension:function(){var a=this.measureResoultion({width:f.innerWidth,height:f.innerHeight});document.getElementById("vAppCont");vApp.vutil.setContainerWidth(a);if("undefined"!=typeof vcan.main.canvas){var b=vcan.main.canvas;ctx=vcan.main.canvas.getContext("2d");b.width=a.width;b.height=a.height;console.log("canvas width "+b.width);a=document.getElementById("canvas");
a=vcan.utility.getElementOffset(a);vcan.main.offset.x=a.x}},getResoultion:function(a){var b={};1280>a?(b.width=1024,b.height=768):1280<=a&&1366>a?(b.width=1280,b.height=1024):1366<=a&&1920>a?(b.width=1366,b.height=768):1920<=a&&(b.width=1920,b.height=1080);return b},check:function(){var a=this.mybrowser.detection(),b=a[0],a=a[1];this.mybrowser.name=b;this.mybrowser.version=a;this.isCanvasSupport(navigator,b,a);this.isWebRtcSupport(navigator,b,a);this.isWebSocketSupport(navigator,b,a)}},b=b.init();
f.addEventListener("resize",function(){vApp.gObj.video.updateVidContHeight();f.earlierWidth!=f.innerWidth&&b.setCanvasDimension()});f.addEventListener("resize",function(){f.earlierWidth!=f.innerWidth&&vApp.wb.view.window.resize()});b.mybrowser.detection=function(){var a=navigator.userAgent,b,c=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(c[1]))return b=/\brv[ :]+(\d+(\.\d+)?)/g.exec(a)||[],"IE "+(b[1]||"");c=c[2]?[c[1],c[2]]:[navigator.appName,
navigator.appVersion,"-?"];null!=(b=a.match(/version\/([\.\d]+)/i))&&(c[2]=b[1]);return c};f.system=b})(window);(function(f){f.packContainer=function(){return{createPacketContDiv:function(b,a){var d=document.createElement("div");"undefined"!=typeof b&&(d.id=b);"undefined"!=typeof a&&(d.clasName=a);return d},togglePacketCont:function(b){for(var a=this.className.split(" "),d=0;d<a.length;d++)if("display"==a[d]){this.className="hide";this.innerHTML="+";b._togglePacketCont(a[d]);break}else if("hide"==a[d]){this.className="display";this.innerHTML="-";b._togglePacketCont(a[d]);break}},_togglePacketCont:function(b){b=
"display"==b?"none":"block";document.getElementById("dataInfoHeading").style.display=b;var a=document.getElementById("packetContainer");a.style.display=b;a=document.getElementById("informationCont");a.style.display=b},createPacketContainer:function(){var b=document.getElementById("packetContainer"),a=document.createElement("h4");a.id="dataInfoHeading";a.innerHTML=vApp.lang.getString("dataDetails");var d=document.createElement("div");d.id="toggleContainer";d.className="display";var c=this;d.addEventListener("click",
function(){c.togglePacketCont.call(this,c)});d.innerHTML="-";var e=document.getElementById("mainContainer");e.insertBefore(d,e.firstChild);e.insertBefore(a,b);a=this.createPacketContDiv("dataInformation");b.appendChild(a);d=this.createPacketContDiv("blankDiv");d.innerHTML="&nbsp;<br/>&nbsp;";a.appendChild(d);d=this.createPacketContDiv("perSecData");d.innerHTML=vApp.lang.getString("perSecond");a.appendChild(d);d=this.createPacketContDiv("totalDataLabel");d.innerHTML=vApp.lang.getString("total");a.appendChild(d);
d=this.createPacketContDiv("sendPackCont");b.appendChild(d);a=this.createPacketContDiv("sentPacketsLabel");a.innerHTML=vApp.lang.getString("sentPackets");d.appendChild(a);e=this.createPacketContDiv("sendPackPsCont");d.appendChild(e);a=this.createPacketContDiv(this.sentPackDivPS,"numbers");a.innerHTML=0;e.appendChild(a);e=this.createPacketContDiv("totSendPackCont");d.appendChild(e);a=this.createPacketContDiv(this.sentPackDiv,"numbers");a.innerHTML=0;e.appendChild(a);d=this.createPacketContDiv("receivePackCont");
b.appendChild(d);b=this.createPacketContDiv("receivedPacketsLabel");b.innerHTML=vApp.lang.getString("receviedPackets");d.appendChild(b);b=this.createPacketContDiv("receivePackPsCont");d.appendChild(b);a=this.createPacketContDiv(this.receivedPackDivPS,"numbers");a.innerHTML=0;b.appendChild(a);b=this.createPacketContDiv("totReceivedPackCont");d.appendChild(b);a=this.createPacketContDiv(this.receivedPackDiv,"numbers");a.innerHTML=0;b.appendChild(a)},createPacketInfoContainer:function(){var b=document.getElementById("informationCont");
label=document.createElement("label");label.innerHTML=vApp.lang.getString("sentMessageInfo");var a=this.createPacketContDiv("sentMsgInfoContainer");a.appendChild(label);var d=this.createPacketContDiv("sentMsgInfo");a.appendChild(d);b.appendChild(a);a=this.createPacketContDiv("receivedMsgInfoContainer");label=document.createElement("label");label.innerHTML=vApp.lang.getString("receivedMessageInfo");a.appendChild(label);d=this.createPacketContDiv("rcvdMsgInfo");a.appendChild(d);b.appendChild(a)}}}})(window);(function(f){f.draw_object=function(b,a,d){var c=this;d.started=!1;var e,g,h=[];d.mousedown=function(a,e){var g=(new Date).getTime();console.log("sumanbogati"+(g-vApp.wb.pageEnteredTime));a.detail.hasOwnProperty("cevent")&&(a.clientX=a.detail.cevent.x+c.vcan.main.offset.x,a.clientY=a.detail.cevent.y+c.vcan.main.offset.y,a.x=a.detail.cevent.x+c.vcan.main.offset.x,a.y=a.detail.cevent.x+c.vcan.main.offset.y,a.pageX=a.detail.cevent.x+c.vcan.main.offset.x,a.pageY=a.detail.cevent.y+c.vcan.main.offset.y,
a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);g=c.vcan;lastmousemovetime=null;d.startPosX=a.currX;d.startPosY=a.currY;if("create"==g.getStates("action")){var h=(new Date).getTime();if("text"!=b&&"t_clearall"!=c.tool.cmd){var f=g.getStates("currentTransform");if(""==f||null==f)a.detail.hasOwnProperty("cevent")||g.optimize.calculatePackets(h,"d",d.startPosX,d.startPosY),d.started=!0}else c.obj.drawTextObj.muser=!1,a.detail.hasOwnProperty("cevent")||"t_clearall"==c.tool.cmd?c.obj.drawTextObj.muser=
!0:c.utility.clickOutSidebox(c.obj.drawTextObj.textWriteMode)&&g.optimize.calculatePackets(h,"d",d.startPosX,d.startPosY),a.detail.hasOwnProperty("cevent")?a.detail.cevent.hasOwnProperty("mtext")?c.obj.drawTextObj.textUtility(d.startPosX,d.startPosY,a.detail.cevent.mtext):c.obj.drawTextObj.textUtility(d.startPosX,d.startPosY):"object"==typeof c.obj.drawTextObj&&c.obj.drawTextObj.textUtility(d.startPosX,d.startPosY)}"freeDrawing"==b&&!0==c.obj.freeDrawObj.freesvg&&c.obj.freeDrawObj.drawStart(a)};d.mousemove=
function(a,f){a.detail.hasOwnProperty("cevent")&&(a.clientX=a.detail.cevent.x+c.vcan.main.offset.x,a.clientY=a.detail.cevent.y+c.vcan.main.offset.y,a.x=a.detail.cevent.x+c.vcan.main.offset.x,a.y=a.detail.cevent.x+c.vcan.main.offset.y,a.pageX=a.detail.cevent.x+c.vcan.main.offset.x,a.pageY=a.detail.cevent.y+c.vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);if(d.started&&"t_clearall"!=c.tool.cmd)if(void 0!=c.obj.freeDrawObj&&!0==c.obj.freeDrawObj.freesvg){if(c.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&
(c.obj.freeDrawObj.wb_draw(a),!a.detail.hasOwnProperty("cevent"))){"undefined"!=typeof f||"undefined"!=typeof lastmousemovetime&&null!=lastmousemovetime||(lastmousemovetime=(new Date).getTime(),vcan.optimize.calculatePackets(lastmousemovetime,"m",a.currX,a.currY));var l=(new Date).getTime(),l=vcan.makeStackObj(l,"m",a.currX,a.currY);h.push(l);if("undefined"==typeof f&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-lastmousemovetime)){for(l=0;l<h.length;l++)c.uid++,h[l].uid=c.uid,
vcan.main.replayObjs.push(h[l]);c.utility.beforeSend({repObj:h});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(h);c.utility.updateSentPackets(h);h=[];lastmousemovetime=(new Date).getTime()}}}else{e=a.currX;g=a.currY;""!=c.prvObj&&c.canvas.removeObject(c.prvObj);var l=c.makeobj(d.startPosX,d.startPosY,e,g,b),k=c.canvas.readyObject(l);c.canvas.addObject(k);k.coreObj.usrCurrAction="create";l=(new Date).getTime();if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=
(new Date).getTime(),a.detail.hasOwnProperty("cevent")||"text"==b||"t_clearall"==c.tool.cmd||vcan.optimize.calculatePackets(l,"m",e,g);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&(a.detail.hasOwnProperty("cevent")||"text"==b||"t_clearall"==c.tool.cmd||vcan.optimize.calculatePackets(l,"m",e,g),lastmousemovetime=(new Date).getTime());c.prvObj=k.coreObj}else"move"==c.vcan.main.action&&(""!=vcan.main.currentTransform&&null!=vcan.main.currentTransform||"move"!=
c.vcan.main.action)||c.utility.beforeSend({createArrow:!0,x:a.currX,y:a.currY})};d.mouseup=function(a,f){a.detail.hasOwnProperty("cevent")&&(a.clientX=a.detail.cevent.x+c.vcan.main.offset.x,a.clientY=a.detail.cevent.y+c.vcan.main.offset.y,a.x=a.detail.cevent.x+c.vcan.main.offset.x,a.y=a.detail.cevent.x+c.vcan.main.offset.y,a.pageX=a.detail.cevent.x+c.vcan.main.offset.x,a.pageY=a.detail.cevent.y+c.vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);e=a.currX;g=a.currY;lastmousemovetime=
null;if(d.started&&"text"!=b){d.mousemove(a,"up");if(!a.detail.hasOwnProperty("cevent")&&"freeDrawing"!=b){var l=(new Date).getTime();vcan.optimize.calculatePackets(l,"u",e,g)}if(void 0!=c.obj.freeDrawObj&&!0==c.obj.freeDrawObj.freesvg&&(c.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&c.obj.freeDrawObj.finalizeDraw(a),!a.detail.hasOwnProperty("cevent")&&0<h.length)){l=(new Date).getTime();l=vcan.makeStackObj(l,"u",e,g);h.push(l);for(l=0;l<h.length;l++)c.uid++,h[l].uid=c.uid,vcan.main.replayObjs.push(h[l]);
c.utility.beforeSend({repObj:h});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(h);c.utility.updateSentPackets(h);h=[]}""!=c.prvObj&&(c.prvObj="");c.prvObj="";d.started=!1}c.vcan.wb.sentPack&&(c.vcan.wb.sentPack=!1)}}})(window);(function(f){f.makeobj=function(b,a,d,c,e){var g={mp:{}};g.mp.x=d;g.mp.y=c;if(b>d){var h=d,f=c;d=b;c=a;b=h;a=f;g.dRoad="b2t"}else g.dRoad="t2b";g.type=e;if("rectangle"==e||"triangle"==e)g.sx=b,g.sy=a,g.ex=d,g.ey=c;if("line"==e)g.lineColor="#424240",g.lineWidth=3,g.start={x:b,y:a},g.end={x:d,y:c};else if("rectangle"==e)g.width=d-b,g.height=c-a,g.borderColor="#424240",g.lineWidth=3;else if("oval"==e)g.lineWidth=3,g.borderColor="#424240",g.width=d-b,g.height=c-a,g.x=d-g.width/2,g.y=c-g.height/2,g.rx=
g.width/2,g.ry=g.height/2;else if("triangle"==e)g.lineWidth=3,g.borderColor="#424240";else if("text"==e)return;return g}})(window);(function(f){var b=f.vcan;b.utility={canvasCalcOffset:function(a){var d=b.main;a=document.getElementById(a);a=b.utility.getElementOffset(a);return d.offset=a},getElementOffset:function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:c,y:b}},setVal:function(a,d,c){("scaleX"===d||"scaleY"===d)&&c<a.MIN_SCALE_LIMIT&&(c=a.MIN_SCALE_LIMIT);if("object"==typeof d)for(var e in d)b.utility.setVal(a,e,d[e]);else"angle"===d?b.utility.setAngle(a,c):a[d]=c;return a},getVal:function(a,
b){return a[b]},setAngle:function(a,b){a.theta=b/180*Math.PI;a.angle=b;return a},actualPointer:function(a){return{x:b.utility.pointerX(a),y:b.utility.pointerY(a)}},pointerX:function(a){var b=document.documentElement,c=document.body||{scrollLeft:0};return a.pageX||("unknown"!=typeof a.clientX?a.clientX:0)+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0)},pointerY:function(a){var b=document.documentElement,c=document.body||{scrollTop:0};return a.pageY||("unknown"!=typeof a.clientY?a.clientY:0)+(b.scrollTop||
c.scrollTop)-(b.clientTop||0)},getReltivePoint:function(a){var d=b.main.offset;a=b.utility.actualPointer(a);return{x:a.x-d.x,y:a.y-d.y}},degreesToRadians:function(a){return Math.PI/180*a},setActiveObject:function(a){b.main.activeObject&&b.main.activeObject.setActive(!1);b.main.activeObject=a;a.setActive(!0);return a},updateObj:function(a){var b={};for(prop in a)"oCoords"!=prop?b[prop]=a[prop]:(b.start={},b.end={},b.start.x=a[prop].tl.x,b.start.y=a[prop].tl.y,b.end.x=a[prop].br.x,b.end.y=a[prop].br.y);
return b},setCursorFromEvent:function(a,b,c){var e=a.upperCanvasEl.style;if(c)if(b=c.findTargetCorner(b))if(b in a.cursorMap)e.cursor=a.cursorMap[b];else if("mtr"===b&&c.hasRotatingPoint)e.cursor=a.rotationCursor;else return e.cursor=this.defaulCursor,!1;else e.cursor=a.hoverCursor;else return e.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return b.main.children}}})(window);(function(f){var b=f.vcan;b.main.prototype={addObject:function(a){if("object"==typeof a.coreObj){"freehand"!=a.coreObj.type&&b.main.children.push(a.coreObj);var d=b.main.canvas.getContext("2d");b.render(d,a.coreObj)}},removeObject:function(a){b.remove(a)},bind:function(a,d){b.events().bind(b.main.canvas,a,d)},readyObject:function(a,d){a=b.extend({},a);d||void 0!=a.id||(b.main.id++,a.id=b.main.id);a.cornersize=12;a.rotatingPointOffset=40;a.selectable=!0;a.downObj=!1;a.active=!1;a.cornersize=12;a.padding=
0;a.hasControls=!0;a.cornerColor="rgba(102,153,255,0.5)";void 0==a.borderColor&&(a.borderColor="#000");a.flipX=!1;a.flipY=!1;a.draggable=!1;a.hasBorders=!0;a.hasRotatingPoint=!1;a.hideCorners=!1;a.lockRotation=!1;a.MIN_SCALE_LIMIT=.1;a.borderOpacityWhenMoving=.4;a.hasOwnProperty("theta")||(a.theta=0);a.hasOwnProperty("scaleX")||(a.scaleX=1);a.hasOwnProperty("scaleY")||(a.scaleY=1);"line"==a.type?(b.objLine=new b.line,b.objLine.init(a)):"rectangle"==a.type?(b.objRect=new b.rectangle,b.objRect.init(a)):
"oval"==a.type?(b.objOval=new b.oval,b.objOval.init(a)):"triangle"==a.type?(b.objTri=new b.triangle,b.objTri.init(a)):"text"==a.type&&(b.objTxt=new b.text,b.objTxt.init(a));a.getWidth=function(){return this.width*this.scaleX};a.getHeight=function(){return this.height*this.scaleY};a.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/
this.currentWidth);this.theta=this.theta;var c=Math.cos(this.angle+this.theta)*this.hypotenuse,d=Math.sin(this.angle+this.theta)*this.hypotenuse,g=this.theta,h=Math.sin(g),g=Math.cos(g),c={x:this.x-c,y:this.y-d},d={x:c.x+this.currentWidth*g,y:c.y+this.currentWidth*h},f={x:c.x-this.currentHeight*h,y:c.y+this.currentHeight*g};this.oCoords={tl:c,tr:d,br:{x:d.x-this.currentHeight*h,y:d.y+this.currentHeight*g},bl:f,ml:{x:c.x-this.currentHeight/2*h,y:c.y+this.currentHeight/2*g},mt:{x:c.x+this.currentWidth/
2*g,y:c.y+this.currentWidth/2*h},mr:{x:d.x-this.currentHeight/2*h,y:d.y+this.currentHeight/2*g},mb:{x:f.x+this.currentWidth/2*g,y:f.y+this.currentWidth/2*h},mtr:{x:c.x+this.currentWidth/2*g,y:c.y+this.currentWidth/2*h}};this.setCornerCoords();a.findTargetCorner=function(c){var d=b.main.offset;if(!this.hasControls)return!1;var e=b.utility.actualPointer(c);c=e.x-d.x;var d=e.y-d.y,g;for(g in this.oCoords){if("mtr"===g&&!this.hasRotatingPoint)break;e=b.virtual_box.getImageLines(this.oCoords[g].corner,
g);e=b.virtual_box.findCrossPoints(c,d,e);if(1==e%2&&0!=e)return a.corner=g}return!1};return this};a.drawBorders=function(a){if(this.hasBorders){var b=this.padding,d=2*b;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var h=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),f=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(h,f);h=this.getWidth();f=this.getHeight();
a.strokeRect(~~(-(h/2)-b)+.5,~~(-(f/2)-b)+.5,~~(h+d),~~(f+d));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(b=(this.flipY?f:-f)/2,a.beginPath(),a.moveTo(0,b),a.lineTo(0,b+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};a.drawCorners=function(a){if(this.hasControls){var b=this.cornersize,d=b/2,h=this.padding,f=-(this.width/2),m=-(this.height/2),l=b/this.scaleX,k=b/this.scaleY,p=(h+d)/this.scaleY,q=(h+d)/this.scaleX,
s=(h+d-b)/this.scaleX,d=(h+d-b)/this.scaleY,h=this.height;a.save();a.fillStyle=this.cornerColor;a.fillRect(f-q,m-p,l,k);b=f+this.width-q;a.fillRect(b,m-p,l,k);a.fillRect(f-q,m+h+d,l,k);b=f+this.width+s;a.fillRect(b,m+h+d,l,k);b=f+this.width/2-q;a.fillRect(b,m-p,l,k);b=f+this.width/2-q;a.fillRect(b,m+h+d,l,k);b=f+this.width+s;a.fillRect(b,m+h/2-p,l,k);a.fillRect(f-q,m+h/2-p,l,k);this.hasRotatingPoint&&(b=f+this.width/2-q,f=this.flipY?m+h+this.rotatingPointOffset/this.scaleY-k/2:m-this.rotatingPointOffset/
this.scaleY-k/2,a.fillRect(b,f,l,k));a.restore();return this}};a.setActive=function(a){this.active=!!a;return this};a.dragDrop=function(a){this.draggable=void 0!=a?a:!1};a.setCornerCoords=function(){var a=this.oCoords,d=b.utility.degreesToRadians(45-this.getAngle()),g=Math.sqrt(2*Math.pow(this.cornersize,2))/2,h=g*Math.cos(d),d=g*Math.sin(d),g=Math.sin(this.theta),f=Math.cos(this.theta);a.tl.corner={tl:{x:a.tl.x-d,y:a.tl.y-h},tr:{x:a.tl.x+h,y:a.tl.y-d},bl:{x:a.tl.x-h,y:a.tl.y+d},br:{x:a.tl.x+d,y:a.tl.y+
h}};a.tr.corner={tl:{x:a.tr.x-d,y:a.tr.y-h},tr:{x:a.tr.x+h,y:a.tr.y-d},br:{x:a.tr.x+d,y:a.tr.y+h},bl:{x:a.tr.x-h,y:a.tr.y+d}};a.bl.corner={tl:{x:a.bl.x-d,y:a.bl.y-h},bl:{x:a.bl.x-h,y:a.bl.y+d},br:{x:a.bl.x+d,y:a.bl.y+h},tr:{x:a.bl.x+h,y:a.bl.y-d}};a.br.corner={tr:{x:a.br.x+h,y:a.br.y-d},bl:{x:a.br.x-h,y:a.br.y+d},br:{x:a.br.x+d,y:a.br.y+h},tl:{x:a.br.x-d,y:a.br.y-h}};a.ml.corner={tl:{x:a.ml.x-d,y:a.ml.y-h},tr:{x:a.ml.x+h,y:a.ml.y-d},bl:{x:a.ml.x-h,y:a.ml.y+d},br:{x:a.ml.x+d,y:a.ml.y+h}};a.mt.corner=
{tl:{x:a.mt.x-d,y:a.mt.y-h},tr:{x:a.mt.x+h,y:a.mt.y-d},bl:{x:a.mt.x-h,y:a.mt.y+d},br:{x:a.mt.x+d,y:a.mt.y+h}};a.mr.corner={tl:{x:a.mr.x-d,y:a.mr.y-h},tr:{x:a.mr.x+h,y:a.mr.y-d},bl:{x:a.mr.x-h,y:a.mr.y+d},br:{x:a.mr.x+d,y:a.mr.y+h}};a.mb.corner={tl:{x:a.mb.x-d,y:a.mb.y-h},tr:{x:a.mb.x+h,y:a.mb.y-d},bl:{x:a.mb.x-h,y:a.mb.y+d},br:{x:a.mb.x+d,y:a.mb.y+h}};a.mtr.corner={tl:{x:a.mtr.x-d+g*this.rotatingPointOffset,y:a.mtr.y-h-f*this.rotatingPointOffset},tr:{x:a.mtr.x+h+g*this.rotatingPointOffset,y:a.mtr.y-
d-f*this.rotatingPointOffset},bl:{x:a.mtr.x-h+g*this.rotatingPointOffset,y:a.mtr.y+d-f*this.rotatingPointOffset},br:{x:a.mtr.x+d+g*this.rotatingPointOffset,y:a.mtr.y+h-f*this.rotatingPointOffset}}};a.getAngle=function(){return 180*this.theta/Math.PI};a.setZindex=function(){for(var a=0;a<b.main.children.length;a++)if(this.id==b.main.children[a].id){var d=b.main.children[a];b.main.children.splice(a,1);break}return" "!=d?(b.main.children.push(d),!0):!1};a.setupCurrentTransform=function(a){var d=b.main,
g="drag",h=b.utility.actualPointer(a);if(a=this.findTargetCorner(a))g="ml"===a||"mr"===a?"scaleX":"mt"===a||"mb"===a?"scaleY":"mtr"===a?"rotate":this.hasRotatingPoint?"scale":"rotate";d.currentTransform={target:this,action:g,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:h.x-this.x,offsetY:h.y-this.y,ex:h.x,ey:h.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};d.currentTransform.original={x:this.x,y:this.y}};"text"!=a.type&&a.setCoords();return b.makeDispObject(a)}}})(window);(function(f){var b=f.vcan;b.events=function(){return{bind:function(a,b,c){a["on"+b]=c},findTarget:function(a){for(var d,c=b.main.children,e=c.length;e--;)if(c[e]&&b.virtual_box.containsPoint(a,c[e])){d=c[e];break}if(d&&d.selectable)return d}}}})(window);(function(f){var b=f.vcan;b.virtual_box={findCrossPoints:function(a,b,c){var e,g,h,f=0,m;for(m in c)if(h=c[m],!(h.o.y<b&&h.d.y<b||h.o.y>=b&&h.d.y>=b)&&(h.o.x==h.d.x&&h.o.x>=a?e=h.o.x:(e=(h.d.y-h.o.y)/(h.d.x-h.o.x),g=b-0*a,h=h.o.y-e*h.o.x,e=-(g-h)/(0-e)),e>=a&&(f+=1),2==f))break;return f},getImageLines:function(a,b){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint:function(a,d){var c=b.utility.getReltivePoint(a),e=c.x,c=c.y,
g=b.virtual_box.getImageLines(d.oCoords);return(e=b.virtual_box.findCrossPoints(e,c,g))&&1===e%2||d.findTargetCorner(a)?!0:!1}}})(window);(function(f){var b=f.vcan;b.interact={rotateObject:function(a,d){var c=b.main.currentTransform,e=b.main.offset;if(!c.target.lockRotation){var g=Math.atan2(c.ey-c.y-e.y,c.ex-c.x-e.x),e=Math.atan2(d-c.y-e.y,a-c.x-e.x);b.utility.setVal(c.target,"theta",e-g+c.theta)}},scaleObject:function(a,d,c){var e=b.main.currentTransform,g=b.main.offset;target=e.target;if(!target.lockScalingX||!target.lockScalingY){var h=Math.sqrt(Math.pow(e.ey-e.y-g.y,2)+Math.pow(e.ex-e.x-g.x,2));a=Math.sqrt(Math.pow(d-e.y-g.y,2)+
Math.pow(a-e.x-g.x,2));target.scaling=!0;c?"x"!==c||target.lockUniScaling?"y"!==c||target.lockUniScaling||target.lockScalingY||b.utility.setVal(target,"scaleY",e.scaleY*a/h):target.lockScalingX||b.utility.setVal(target,"scaleX",e.scaleX*a/h):(target.lockScalingX||b.utility.setVal(target,"scaleX",e.scaleX*a/h),target.lockScalingY||b.utility.setVal(target,"scaleY",e.scaleY*a/h))}},translateObject:function(a,d){var c=b.main.currentTransform.target;c.lockMovementX||b.utility.setVal(c,"x",a-b.main.currentTransform.offsetX);
c.lockMovementY||b.utility.setVal(c,"y",d-b.main.currentTransform.offsetY);return c}}})(window);(function(f){f.vcan.rectangle=function(){return{type:"rectangle",init:function(b){void 0==b.x&&(b.x=b.ex-b.width/2);void 0==b.y&&(b.y=b.ey-b.height/2);return b},draw:function(b,a,d){d=-a.width/2;var c=-a.height/2,e=a.width,g=a.height;b.beginPath();b.strokeStyle=void 0!=a.borderColor?'"'+a.strokeColor+'"':"#000";b.moveTo(d,c);b.stroke();b.lineTo(d+e,c);b.stroke();b.lineTo(d+e,c+g);b.stroke();b.lineTo(d,c+g);b.stroke();b.lineTo(d,c);b.fillStyle=void 0!=a.fillColor?a.fillColor:" ";b.closePath();b.stroke();
void 0!=a.fillColor&&(b.fillStyle=a.fillColor,b.fill())}}}})(window);(function(f){f.vcan.oval=function(){return{type:"oval",init:function(b){void 0==b.width&&(b.width=2*b.rx);void 0==b.height&&(b.height=2*b.ry);void 0==b.borderColor&&(b.borderColor="#000000");void 0!=b.fillColor&&(b.fillStyle=b.fillColor);return b},draw:function(b,a,d){b.beginPath();b.save();var c=2*Math.PI;b.lineWidth=a.lineWidth;var e=a.ry/a.rx,e=e.toFixed(3);0==e&&(e=.01);b.transform(1,0,0,e,0,0);b.arc(d?a.x:0,d?a.y:0,a.rx,0,c,!1);b.closePath();void 0!=a.fillStyle&&(b.fillStyle=a.fillStyle,b.fill());
void 0!=a.borderColor&&(b.fillStyle=a.borderColor,b.stroke());b.restore()}}}})(window);(function(f){f.vcan.triangle=function(){return{type:"triangle",init:function(b){b.fillStyle=b.fillColor;void 0==b.dRoad&&(b.dRoad="ltr");void 0==b.width&&(b.width=b.ex-b.sx);void 0==b.height&&(b.height=b.ey-b.sy);void 0==b.x&&(b.x=b.ex-b.width/2);void 0==b.y&&(b.y=b.ey-b.height/2);return b},draw:function(b,a,d){b.beginPath();if("t2b"==a.dRoad){d=a.width/2;var c=a.height/2}else d=-a.width/2,c=-a.height/2;b.lineWidth=a.lineWidth;void 0!=a.borderColor&&(b.strokeStyle=a.borderColor);b.moveTo(-d,c);b.lineTo(0,
-c);b.lineTo(d,c);b.closePath();void 0!=a.fillStyle&&(b.fillStyle=a.fillStyle,b.fill());b.stroke()}}}})(window);(function(f){f.vcan.line=function(){return{type:"line",init:function(b){var a=b.start.x,d=b.start.y,c=b.end.x,e=b.end.y;void 0==b.width&&(b.width=c-a,b.height=e-d);b.x=a+(c-a)/2;b.y=d+(e-d)/2;return b},draw:function(b,a,d){b.beginPath();d=1===a.width?0:a.width/2;var c=1===a.height?0:a.height/2;b.moveTo(1===a.width?0:-a.width/2,1===a.height?0:-a.height/2);b.lineTo(d,c);b.lineWidth=a.lineWidth;void 0!=a.lineColor&&(b.strokeStyle=a.lineColor);b.closePath();b.stroke()}}}})(window);(function(f){f.vcan.text=function(){return{type:"text",init:function(b){b.lineHeight=1.3;void 0==b.fontSize&&(b.fontSize=30);b.font=b.fontSize+"px Times New Roman";return b},draw:function(b,a,d){b.font=a.font;d=a.text.split(/\r?\n/);a.height=this.getTextHeight(b,d,a);a.width=this.getTextWidth(b,d);b.beginPath();for(var c=0,e=d.length;c<e;c++)b.fillText(d[c],-a.width/2,-a.height/2+c*a.fontSize*a.lineHeight+a.fontSize);b.closePath();a.setCoords()},getTextWidth:function(b,a){for(var d=b.measureText(a[0]).width,
c=1,e=a.length;c<e;c++){var g=b.measureText(a[c]).width;g>d&&(d=g)}return d},getTextHeight:function(b,a,d){return d.fontSize*a.length*d.lineHeight},removeTextNode:function(){for(var b=document.getElementsByClassName("textBoxContainer"),a=0;a<b.length;a++)b[a].parentNode.removeChild(b[a])}}}})(window);(function(f){var b=f.vcan;b.main.freeHandDrawing=function(a){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==a.borderColor?"#000000":a.borderColor;this.freeDrawingLineWidth=void 0!=a.lineWidth?a.lineWidth:"3";return this},fhdStart:function(a,b,e){e=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);
this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(e);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,b){var e=(new Date).getTime();this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(e)},finalizeDrawingPath:function(d,c,e){(new Date).getTime();
this.contextTop.closePath();this.isCurrentlyDrawing=!1;var g=this.utility.min(this.freeDrawingXPoints);c=this.utility.min(this.freeDrawingYPoints);var h=this.utility.max(this.freeDrawingXPoints);e=this.utility.max(this.freeDrawingYPoints);var f=[],m,l,k,p=this.freeDrawingXPoints,q=this.freeDrawingYPoints,s=this.mdTime;f.push("M ",p[0]-g," ",q[0]-c," ",s[0]," ");for(var r=1;m=p[r],l=q[r],k=s[r];r++)f.push("L ",m-g," ",l-c," ",k," ");f=f.join("");if("M 0 0 L 0 0 "!==f)return m=this.freeDrawingXPoints[this.freeDrawingXPoints.length-
1],l=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],k=new b.Path(f,this),k.mp={},k.mp.x=m,k.mp.y=l,k.init(f),k=d.readyObject(k),k.coreObj.type="freeDrawing",k=k.coreObj,k.fill=null,k.stroke=this.freeDrawingColor,k.strokeWidth=this.freeDrawingLineWidth,k.minX=g,k.minY=c,this.utility.objAdd(k),d=b.utility.setVal(k,"x",g+(h-g)/2),d=b.utility.setVal(d,"y",c+(e-c)/2),d.setCoords(),"object"==typeof a&&this.contextTop.restore(),b.renderAll(this.contextTop),d},utility:{max:function(a,b){if(a&&
0!==a.length){var e=a.length-1,g=b?a[e][b]:a[e];if(b)for(;e--;)a[e][b]>=g&&(g=a[e][b]);else for(;e--;)a[e]>=g&&(g=a[e]);return g}},min:function(a,b){if(a&&0!==a.length){var e=a.length-1,g=b?a[e][b]:a[e];if(b)for(;e--;)a[e][b]<g&&(g=a[e][b]);else for(;e--;)a[e]<g&&(g=a[e]);return g}},objAdd:function(a){b.main.children.push(a);return this}}}}})(window);(function(f){var b=f.vcan;b.Path=function(a,d){return{objectType:"path",init:function(a,b){b=b||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(b),this},initializeFromArray:function(a){var b="width"in a,d="height"in a;this.path=this._parsePath();b&&d||(this.utility.extend(this,this._parseDimensions()),b&&(this.width=a.width),d&&(this.height=a.height))},
_render:function(a){var b,d=0;b=0;for(var f=-(this.width/2),n=-(this.height/2),m=0,l=this.path.length;m<l;++m)switch(b=this.path[m],b[0]){case "L":d=b[1];b=b[2];a.lineTo(d+f,b+n);break;case "M":d=b[1],b=b[2],a.moveTo(d+f,b+n)}},replay_render:function(a,b,d,f){var n=y=0;switch(b[0]){case "L":n+=b[1];y+=b[2];a.lineTo(n+d,y+f);a.stroke();break;case "M":n+=b[1],y+=b[2],a.moveTo(n+d,y+f)}},render:function(a,d){a.save();var g=this.transformMatrix;g&&a.transform(g[0],g[1],g[2],g[3],g[4],g[5]);d||b.transform(a,
this);this.overlayFill?a.fillStyle=this.overlayFill:this.fill&&(a.fillStyle=this.fill);this.stroke&&(a.strokeStyle=this.stroke);a.beginPath();this._render(a);this.fill&&a.fill();this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=this.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!d&&this.active&&(this.drawBorders(a),this.hideCorners||this.drawCorners(a));a.restore()},_parsePath:function(){for(var a=[],b,d,f,n=0,m,l=this.path.length;n<l;n++){var k=/\d+\s$/.exec(this.path[n]);null!=k&&(b=this.path[n].indexOf(k),
this.path[n]=this.path[n].substring(0,b));b=this.path[n];d=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);b=[b.charAt(0)];m=0;for(var p=d.length;m<p;m++)f=parseFloat(d[m]),isNaN(f)||b.push(f);d=b[0].toLowerCase();d=this.commandLengths[d];if(b.length-1>d)for(f=1,m=b.length;f<m;f+=d)null==k?a.push([b[0]].concat(b.slice(f,f+d))):(a.push([b[0]].concat(b.slice(f,f+d))),b.push(k),a.push(b));else null!=k&&b.push(k[0]),a.push(b)}return a},_parseDimensions:function(){var a=[],b=[],g,f,n=!1,
m,l;this.path.forEach(function(d,k){if(" "!=d[3])var s=d.splice(3);"H"!==d[0]&&(g=0===k?this.utility.getX(d):this.utility.getX(this.path[k-1]));"V"!==d[0]&&(f=0===k?this.utility.getY(d):this.utility.getY(this.path[k-1]));d[0]===d[0].toLowerCase()&&(n=!0);m=n?g+this.utility.getX(d):"V"===d[0]?g:this.utility.getX(d);l=n?f+this.utility.getY(d):"H"===d[0]?f:this.utility.getY(d);var r=parseInt(m,10);isNaN(r)||a.push(r);r=parseInt(l,10);isNaN(r)||b.push(r);void 0!=s&&1<=s.length&&d.push(s[0])},this);var k=
d.utility.min(a),k={y:d.utility.min(b)-0,x:k-0,bottom:d.utility.max(b)-0,right:d.utility.max(a)-0};k.width=k.right-k.x;k.height=k.bottom-k.y;return k},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,b){for(var d in b)a[d]=b[d];return a}}}}})(window);(function(f){var b=f.vcan;b.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){canvasElement=b.main.canvas;var a={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};for(type in a)"mousedown"==type?canvasElement.addEventListener(type,this.mousedown,!1):"mousemove"==type?canvasElement.addEventListener(type,this.mousemove,!1):"mouseup"==type&&canvasElement.addEventListener(type,this.mouseup,!1)},mousedown:function(a,d){a.detail.hasOwnProperty("cevent")&&
"create"!=b.main.action&&(a.clientX=b.main.offset.x+a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];if("move"==b.main.action){if(!b.main.currentTransform){var c=b.events().findTarget(a);b.utility.getReltivePoint(a);c?(0<b.main.children.length&&
c.setZindex(),c.downObj=!0,c.setupCurrentTransform(a),b.utility.setActiveObject(c),b.main.currObj=c):b.deactivateAll();void 0!=c&&b.renderAll();a.detail.hasOwnProperty("cevent")||(c=(new Date).getTime(),c=b.makeStackObj(c,"d",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y),vApp.wb.uid++,console.log("uid "+vApp.wb.uid),c.uid=vApp.wb.uid,b.main.replayObjs.push(c),vApp.wb.utility.beforeSend({repObj:[c]}),vApp.wb.utility.updateSentPackets(c))}}else"create"==b.main.action&&(a.detail.hasOwnProperty("cevent")&&
(a.clientX=a.detail.cevent.x+vApp.wb.vcan.main.offset.x,a.clientY=a.detail.cevent.y+vApp.wb.vcan.main.offset.y,a.x=a.detail.cevent.x+vApp.wb.vcan.main.offset.x,a.y=a.detail.cevent.x+vApp.wb.vcan.main.offset.y,a.pageX=a.detail.cevent.x+vApp.wb.vcan.main.offset.x,a.pageY=a.detail.cevent.y+vApp.wb.vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y),c=b.events().findTarget(a),b.utility.getReltivePoint(a),c&&"text"==c.type&&"t_text"==vApp.wb.tool.cmd&&c.setupCurrentTransform(a))},mousemove:function(a){a.detail.hasOwnProperty("cevent")&&
(a.clientX=b.main.offset.x+a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);if("move"==b.main.action){var d=b.main;if(d.currentTransform){var c=b.utility.actualPointer(a),e=c.x,c=c.y;d.currentTransform.target.isMoving=!0;if("rotate"===d.currentTransform.action)b.interact.rotateObject(e,
c),d.currentTransform.target.hasRotatingPoint||b.interact.scaleObject(e,c),a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a);else if("scale"===d.currentTransform.action)a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),b.interact.scaleObject(e,c);else if("scaleX"===d.currentTransform.action)a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),b.interact.scaleObject(e,c,"x");else if("scaleY"===d.currentTransform.action)a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a),
b.interact.scaleObject(e,c,"y");else if(d.currentTransform.target.draggable){var f=b.extend({},b.main.currentTransform.target);(new Date).getTime();!0==d.currentTransform.target.downObj&&(b.main.dragMode=!0,d.currentTransform.target.downObj=!1);f=b.interact.translateObject(e,c);a.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(a);f.setActive(!0);f.setCoords()}if("scaleX"===d.currentTransform.action||"scaleY"===d.currentTransform.action||"rotate"===d.currentTransform.action&&!d.currentTransform.target.hasRotatingPoint)b.main.scaleMode=
!0,(new Date).getTime(),d.currentTransform.target.downObj&&(d.currentTransform.target.downObj=!1),f=b.extend({},b.main.currentTransform.target),f.setCoords();b.renderAll()}else b.events().findTarget(a)}},mouseup:function(a){a.detail.hasOwnProperty("cevent")&&(a.clientX=b.main.offset.x+a.detail.cevent.x,a.clientY=b.main.offset.y+a.detail.cevent.y,a.x=b.main.offset.x+a.detail.cevent.x,a.y=b.main.offset.y+a.detail.cevent.y,a.pageX=b.main.offset.x+a.detail.cevent.x,a.pageY=b.main.offset.y+a.detail.cevent.y,
a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);lastmousemovetime=null;if("move"==b.main.action){b.activMouse.mousemove(a);var d=b.main;if(d.currentTransform){var c=d.currentTransform.target;c.scaling&&(c.scaling=!1);for(c=d.children.length;c--;)d.children[c].setCoords()}d.currentTransform=null;b.renderAll();if(!0==b.main.dragMode||!0==b.main.scaleMode){b.utility.actualPointer(a);var e=(new Date).getTime();a.detail.hasOwnProperty("cevent")||b.optimize.calculatePackets(e,"u",a.clientX-b.main.offset.x,
a.clientY-b.main.offset.y);b.main.dragMode&&(b.main.dragMode=!1);b.main.scaleMode&&(b.main.scaleMode=!1)}else a.detail.hasOwnProperty("cevent")||b.optimize.calculatePackets(e,"u",a.clientX-b.main.offset.x,a.clientY-b.main.offset.y);b.wb.sentPack=!0}}}}})(window);(function(f){f.readyFreeHandObj=function(b,a){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=b;this.freeDrawingLineWidth=a},drawStart:function(a){var b=vApp.wb.vcan;if(!0==vApp.wb.obj.freeDrawObj.freesvg){var e=b.main.canvas.getContext("2d");this.fdObj=b.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=b.utility.getReltivePoint(a);this.fdObj.fhdStart(e,pointer)}},wb_draw:function(a){a=vcan.utility.getReltivePoint(a);
this.fdObj.fhRendering(a)},finalizeDraw:function(a){a=vApp.wb.vcan;vApp.wb.prvObj=this.fdObj.finalizeDrawingPath(vApp.wb.canvas);a.main.children[a.main.children.length-1].mt=vApp.wb.utility.stringToNumber(vApp.wb.prvObj.path[vApp.wb.prvObj.path.length-1][3])}}}})(window);(function(f){_replay=function(){return{init:function(b,a){var d=vApp.wb.vcan;this.objs="undefined"!=typeof a?d.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=b;this.callBkfunc=""},renderObj:function(b){vApp.wb.drawMode=!0;if("undefined"==typeof this.objs[this.objNo])console.log("is this happend");else{"undefined"!=typeof b&&(this.callBkfunc=b);if(this.objs[this.objNo].hasOwnProperty("cmd"))vApp.wb.gObj.displayedObjId=this.objs[this.objNo].uid,vApp.wb.toolInit(this.objs[this.objNo].cmd,
"fromFile",!0);else{b="";"d"==this.objs[this.objNo].ac?b="mousedown":"m"==this.objs[this.objNo].ac?b="mousemove":"u"==this.objs[this.objNo].ac&&(b="mouseup");var a=this.objs[this.objNo],a=a.hasOwnProperty("mtext")?{detail:{cevent:{x:a.x,y:a.y,mtext:a.mtext}}}:{detail:{cevent:{x:a.x,y:a.y}}};vApp.wb.gObj.displayedObjId=this.objs[this.objNo].uid;b=new CustomEvent(b,a);vcan.main.canvas.dispatchEvent(b)}"function"==typeof this.callBkfunc&&this.objs[this.objs.length-1].uid==vApp.wb.gObj.displayedObjId&&
this.callBkfunc("callBkfunc");if("object"==typeof this.objs[this.objNo+1]){vApp.wb.replayTime="undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?this.objs[this.objNo].mt-vApp.wb.pageEnteredTime:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;this.objNo++;var d=this;setTimeout(function(){d.renderObj.call(d)},vApp.wb.replayTime)}}}}};f._replay=_replay})(window);(function(f){f.readyTextObj=function(){return{init:function(b){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=b;this.muser=!1},textUtility:function(b,a,d){this.startPosX=b;this.startPosY=a;var c=vApp.wb.vcan,e=c.main.canvas.getContext("2d"),f={};this.textWriteMode++;this.wmode=!0;void 0!=c.main.currentTransform&&""!=c.main.currentTransform?(this.currObject=c.main.currentTransform.target,
void 0!=this.currObject&&"text"==this.currObject.type&&(f={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},vApp.wb.utility.clickOutSidebox(this.textWriteMode)||vApp.wb.obj.drawTextObj.drawTextBoxWrapper(f,this.currObject.id),c.main.currentTransform=""),vApp.wb.utility.clickOutSidebox(this.textWriteMode)&&vApp.wb.obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,e),void 0!=this.currObject&&"text"==this.currObject.type&&
(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):vApp.wb.utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof d?vApp.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,e,d):vApp.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,e):(this.totalBox++,f={x:b,y:a,width:300,height:100},"undefined"==typeof d?vApp.wb.obj.drawTextObj.drawTextBoxWrapper(f,
this.totalBox):vApp.wb.obj.drawTextObj.drawTextBoxWrapper(f,this.totalBox,d))},drawTextBoxWrapper:function(b,a,d){var c=vApp.wb.vcan;d=document.createElement("div");d.id="box"+a;d.className="textBoxContainer";d.style.position="absolute";d.style.left=c.main.offset.x+b.x+"px";d.style.top=b.y+"px";a=document.createElement("textarea");a.id=d.id+"textarea";a.rows=8;a.cols=41;void 0!=b.text&&""!=b.text&&(a.value=b.text);d.appendChild(a);document.getElementById(this.boxContainer).appendChild(d);this.prevTextObj=
d;this.currTextObjWrapper=b;this.prevTextObj.measure=b},renderText:function(b,a,d,c){var e=vApp.wb.vcan;if(""!=this.prevTextObj){if(!vApp.wb.utility.IsObjEmpty(b))for(var f=0;f<e.main.children.length;f++)if(b.id==e.main.children[f].id){e.main.children.splice(f,1);this.currObject="";break}vApp.wb.utility.IsObjEmpty(b)?"undefined"!=typeof c?this.finalizeText(d,this.prevTextObj,void 0,c):this.finalizeText(d,this.prevTextObj):"undefined"!=typeof c?this.finalizeText(d,this.prevTextObj,a,c):this.finalizeText(d,
this.prevTextObj,a);vApp.wb.obj.drawTextObj.wmode=!1}},finalizeText:function(b,a,d,c){d=vApp.wb.vcan;var e=document.getElementById(a.id),f="";if("undefined"==typeof c){c=e.getElementsByTagName("textarea");for(var h=0;h<c.length;h++)if(c[h].id==e.id+"textarea"){f=c[h].value;break}}else f=c;b.font="20px Times New Roman";var n=0,m=f.split(/\r?\n/),n=b.measureText(m[0]).width;c=15;for(h=1;h<m.length;h++){c+=15;var l=b.measureText(m[h]).width;l>n&&(n=l)}n/=2;h=(new Date).getTime();b={type:"text",text:f,
x:a.measure.x+n,y:a.measure.y+c,fontSize:20,fontWidth:b.measureText(f).width,mp:{x:a.measure.x,y:a.measure.y}};!1==vApp.wb.obj.drawTextObj.muser&&(f={mt:h,ac:"d",x:this.startPosX,y:this.startPosY,mtext:b.text},vApp.wb.uid++,f.uid=vApp.wb.uid,d.main.replayObjs.push(f),vApp.storage.store(JSON.stringify(d.main.replayObjs)),vApp.storage.wholeStore(f),vApp.wb.utility.beforeSend({repObj:[f]}),vApp.wb.utility.updateSentPackets(f));b=vApp.wb.canvas.readyObject(b);vApp.wb.canvas.addObject(b);d.main.children[d.main.children.length-
1].mt=h;e.parentNode.removeChild(a);d.renderAll();0<vApp.wb.sentPackets&&null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=vApp.wb.sentPackets)}}}})(window);(function(f){f.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(b){b.shiftKey&&(console.log("what happend mere bhai"),vApp.wb.keyBoard.skey=!0,vApp.wb.keyBoard.prvTool=vApp.wb.tool.cmd,vApp.wb.toolInit("t_activeall"),b={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(b),vApp.wb.utility.beforeSend({repObj:[b]}),vApp.wb.vcan.main.action="move")},triggerdeActiveAll:function(b){vApp.wb.keyBoard.skey&&(console.log("what happend mere bhai ddd"),b=(new Date).getTime(),vApp.wb.utility.deActiveFrmDragDrop(),
vApp.wb.toolInit(vApp.wb.keyBoard.prvTool),b={cmd:vApp.wb.keyBoard.prvTool,mt:b},vcan.main.replayObjs.push(b),vApp.wb.utility.beforeSend({repObj:[b]}))}}})(window);(function(f){f.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init:function(b){!0==vApp.system.wbRtc.peerCon&&!0==vApp.system.wbRtc.userMedia&&(b.mozGetUserMedia?(f.webrtcDetectedBrowser="firefox",this.RTCPeerConnection=mozRTCPeerConnection,this.RTCSessionDescription=mozRTCSessionDescription,this.RTCIceCandidate=mozRTCIceCandidate,b.getUserMedia=b.mozGetUserMedia,this.attachMediaStream=function(a,b){this.videoAdd=!0;console.log("Attaching media stream");a.mozSrcObject=
b;a.play()},reattachMediaStream=function(a,b){console.log("Reattaching media stream");a.mozSrcObject=b.mozSrcObject;a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):b.webkitGetUserMedia?(console.log("This appears to be Chrome"),f.webrtcDetectedBrowser="chrome",this.RTCPeerConnection=webkitRTCPeerConnection,this.RTCSessionDescription=RTCSessionDescription,this.RTCIceCandidate=RTCIceCandidate,b.getUserMedia=b.webkitGetUserMedia,
this.attachMediaStream=function(a,b){a.src=f.URL.createObjectURL(b);this.videoAdd=!0},reattachMediaStream=function(a,b){a.src=b.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=
function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable"));return b}}}})(window);(function(f){repMode=!1;var b=f.io;f.media=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",localStream:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,resampler:new Resampler(44100,8E3,1,4096),rec:"",audioNodes:[],Html5Audio:{audioContext:new AudioContext},init:function(){this.graph=
{height:56,width:4,average:0,display:function(){var a=cthis.video;if("t"==vApp.gObj.uRole){var b=this.height-this.height*this.average/100;this._display(a.tempVidCont,b);this._display(cthis.audio.graph.cvCont,b)}},_display:function(a,b){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,b);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()},canvasForVideo:function(){var a=cthis.video.myVideo.parentNode,b=document.createElement("canvas");b.width=this.width+
3;b.height=this.height;b.id="graphCanvas";a.style.position="relative";b.style.position="absolute";b.style.left=0;b.style.top=-7;a.appendChild(b)}}},ab2str:function(a){return String.fromCharCode.apply(null,new Int8Array(a))},str2ab:function(a){for(var b=new ArrayBuffer(a.length),b=new Int8Array(b),c=0,e=a.length;c<e;c++)b[c]=a.charCodeAt(c);return b},recorderProcess:function(a){(new Date).getTime();repMode||(this.calcAverage(),a=a.inputBuffer.getChannelData(0),a=this.resampler.resampler(a),this.recordAudio||
(this.recordingLength+=this.bufferSize),a=this.audioInLocalStorage(a),vApp.wb.utility.beforeSend({audioSamp:a}))},audioInLocalStorage:function(a){a=convertFloat32ToInt16(a);a=G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1});a=this.ab2str(a);a=LZString.compressToBase64(a);vApp.storage.audioStore(JSON.stringify(a));return a},calcAverage:function(){var a=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);for(var b=0,c=a.length,e=0;e<c;e++)b+=a[e];this.graph.average=b/c},audioInGraph:function(){var a=
cthis.video;if("t"==vApp.gObj.uRole){var b=this.graph.height-this.graph.height*this.graph.average/100;a.tempVidCont.beginPath();a.tempVidCont.moveTo(a.tempVid.width-this.graph.width,this.graph.height);a.tempVidCont.lineTo(a.tempVid.width-this.graph.width,b);a.tempVidCont.lineWidth=this.graph.width;a.tempVidCont.strokeStyle="rgba(247, 25, 77, 1)";a.tempVidCont.closePath();a.tempVidCont.stroke()}},play:function(a,b,c){a=LZString.decompressFromBase64(a);a=this.str2ab(a);a=G711.decode(a,{alaw:"alaw"==
this.encMode?!0:!1,floating_point:!0,Eight:!0});b=this.Html5Audio.audioContext.currentTime+b;var e=this.Html5Audio.audioContext.createBuffer(1,a.length,8E3);e.getChannelData(0).set(a);a=this.Html5Audio.audioContext.createBufferSource();a.buffer=e;a.connect(this.Html5Audio.audioContext.destination);a.start(b,c)},replayInit:function(){vApp.storage.getAllObjs(["audioData"],function(){vApp.gObj.video.audio.replay(0,0)})},replay:function(a,b){repMode=!0;var c,e,f;0<this.audioNodes.length&&(c=this.mergeBuffers(this.audioNodes),
e=this.Html5Audio.audioContext.currentTime+a,f=this.Html5Audio.audioContext.createBuffer(1,c.length,7800),f.getChannelData(0).set(c),c=this.Html5Audio.audioContext.createBufferSource(),c.buffer=f,c.connect(this.Html5Audio.audioContext.destination),c.start(e,b))},mergeBuffers:function(a){for(var b=new Float32Array(this.recordingLength),c=0,e=a.length,f=0;f<e;f++){var h=a[f];console.log("bf Length "+h.length);b.set(h,c);c+=h.length}return b},assignFromLocal:function(a,b){this.init();for(var c=0;c<a.length;c++){var e=
LZString.decompressFromBase64(a[c]),e=this.str2ab(e);samples=G711.decode(e,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});this.audioNodes.push(new Float32Array(samples));this.recordingLength+=16384}"undefined"!=typeof b&&b()},manuPulateStream:function(){var a=cthis.stream;vApp.vutil.chkValueInLocalStorage("recordStart")?vApp.wb.recordStarted=localStorage.getItem("recordStart"):(vApp.wb.recordStarted=(new Date).getTime(),localStorage.setItem("recordStart",vApp.wb.recordStarted));var b=
new (f.AudioContext||f.webkitAudioContext||f.mozAudioContext);analyser=b.createAnalyser();a=b.createMediaStreamSource(a);cthis.audio.bufferSize=16384;cthis.audio.rec=b.createScriptProcessor(cthis.audio.bufferSize,1,1);cthis.audio.initAudioNode();cthis.audio.rec.onaudioprocess=cthis.audio.recorderProcess.bind(cthis.audio);a.connect(analyser);analyser.connect(cthis.audio.rec);cthis.audio.rec.connect(b.destination)},initAudioNode:function(){(new Date).getTime()},updateInfo:function(){this.audioStreamArr=
[];vApp.wb.pageEnteredTime=vApp.wb.recordStarted=(new Date).getTime();repMode=this.recordAudio=!1}},video:{width:75,height:56,tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init:function(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&(this.videoCont.style.maxHeight=this.maxHeight+"px")},calcDimension:function(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser:function(a){a=document.getElementById("user"+a);
null!=a&&a.parentNode.removeChild(a)},createElement:function(a){var b=document.createElement("div");b.className="videoWrapper";var c=document.createElement("div");c.className="videoSubWrapper";c.id="user"+a.id;b.appendChild(c);vidId=a.id;var e=document.createElement("canvas");e.id="video"+vidId;e.className="userVideos";e.width=this.width;e.height=this.height;c.appendChild(e);cthis.video.imageReplaceWithVideo(a.id,b)},updateHightInSideBar:function(a){var b=document.getElementById("widgetRightSide").offsetHeight;
document.getElementById("chatContainer").style.height=b-a+"px"},send:function(){var a=this,b;vApp.gObj.video.smallVid=setInterval(function(){if("t"==vApp.gObj.uRole){if("undefined"==typeof c){var c=document.getElementById("graphCanvas");null!=c&&(cthis.audio.graph.cvCont=c.getContext("2d"))}null!=c&&cthis.audio.graph.cvCont.clearRect(0,0,c.width,c.height)}a.tempVidCont.clearRect(0,0,a.tempVid.width,a.tempVid.height);a.tempVidCont.drawImage(a.myVideo,0,0,a.width,a.height);"t"==vApp.gObj.uRole&&cthis.audio.graph.display();
b=a.tempVid.toDataURL("image/jpg",.3);c={name:vApp.gObj.uName,id:vApp.gObj.uid};"t"==vApp.gObj.uRole&&(c.role=vApp.gObj.uRole);vApp.wb.utility.beforeSend({user:c,videoByImage:b})},1E3)},startToStream:function(){cthis.video.calcDimension();cthis.video.send()},playWithoutSlice:function(a){var b=a.videoByImage,c=new Image;c.src=b;this.remoteVid=document.getElementById("video"+a.user.id);this.remoteVidCont=this.remoteVid.getContext("2d");var e=this;c.onload=function(){e.remoteVidCont.drawImage(this,0,
0)}},justForDemo:function(){var a=0,b=document.getElementById("allVideosCont");b.style.maxHeight="250px";setInterval(function(){if(20>=++a){b=document.getElementById("allVideosCont");var c=document.createElement("div");c.className="videoWrapper";var e=document.createElement("div");e.className="videoSubWrapper";e.setAttribute("data-uname","suman"+a);c.appendChild(e);var f=document.createElement("video");f.className="userVideo";f.src="http://html5demos.com/assets/dizzy.mp4";e.appendChild(f);b.appendChild(c);
250<=b.offsetHeight&&"undefined"!=b.style.overflowY&&"scroll"!=b.style.overflowY&&(b.style.overflowY="scroll",document.getElementById(vApp.gObj.chat.mainChatBoxId).style.borderTop="3px solid #bbb")}},200)},createVideoElement:function(){var a=document.createElement("div");a.className="videoWrapper";var b=document.createElement("div");b.className="videoSubWrapper";a.appendChild(b);var c=document.createElement("video");c.id="video"+vApp.gObj.uid;c.autoplay=!0;b.appendChild(c);return a},imageReplaceWithVideo:function(a,
b){var c=document.getElementById("ml"+a).getElementsByTagName("a")[0],e=c.getElementsByTagName("img")[0];c.replaceChild(b,e)},insertTempVideo:function(a){var b=document.createElement("canvas");b.id="tempVideo";a.parentNode.insertBefore(b,a)},tempVideoInit:function(){cthis.video.tempVid=document.getElementById("tempVideo");cthis.video.tempVid.width=cthis.video.width;cthis.video.tempVid.height=cthis.video.height;cthis.video.tempVidCont=cthis.video.tempVid.getContext("2d")}},init:function(a){cthis=this;
vcan.oneExecuted=!0;a={audio:!0,video:!0};cthis.video.init();vApp.adpt=new vApp.adapter;vApp.adpt.init(navigator).getUserMedia(a,this.handleUserMedia,this.handleUserMediaError);vApp.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(vApp.wb.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0)},handleUserMedia:function(a){cthis.video.tempStream=a;cthis.audio.init();a=document.getElementById("ml"+vApp.gObj.uid);null!=a&&null!=a.getElementsByTagName("video")&&cthis._handleUserMedia()},
_handleUserMedia:function(){var a=cthis.video.tempStream,b=document.getElementById("ml"+vApp.gObj.uid);null!=b&&(b.style.pointerEvents="none");"undefined"!=typeof a&&(b=cthis.video.createVideoElement(),cthis.video.imageReplaceWithVideo(id,b),cthis.video.insertTempVideo(b),cthis.video.tempVideoInit(),cthis.video.myVideo=document.getElementById("video"+vApp.gObj.uid),vApp.adpt.attachMediaStream(cthis.video.myVideo,a),cthis.video.myVideo.muted=!0,a.ontimeupdate=function(){console.log("raja"+a.currentTime)},
"t"==vApp.gObj.uRole&&(cthis.stream=a,cthis.audio.manuPulateStream(),cthis.audio.graph.canvasForVideo()),cthis.video.myVideo.onloadedmetadata=function(){cthis.video.startToStream()})},updateVidContHeight:function(){var a=document.getElementById("vAppCont"),a=vcan.utility.getElementOffset(a),a=f.innerHeight-(a.y+75);document.getElementById("chat_div").style.maxHeight=a+"px"},createDemoUserList:function(){for(var a,b=5;15>b;b++)a={img:"./images/quality-support.png",name:"Student "+b,userid:100+b},memberUpdate({message:[a]});
return[]},close:function(){vApp.gObj.video.hasOwnProperty("smallVid")&&clearInterval(vApp.gObj.video.smallVid)},dispAllVideo:function(a){setTimeout(function(){var b=document.getElementById(a);if(null!=b)for(var b=b.getElementsByTagName("video"),c=0;c<b.length;c++)b[c].play()},1040)},sendMessage:function(a){1<arguments.length?vApp.wb.utility.beforeSend({video:a},arguments[1]):vApp.wb.utility.beforeSend({video:a})},existVideoContainer:function(a){for(var b=document.getElementsByClassName("userVideos"),
c=0;c<b.length;c++)if(b[c].id=="video"+a.id)return!0;return!1},handleUserMediaError:function(a){vApp.wb.view.disappearBox("WebRtc");console.log("navigator.getUserMedia error: ",a)}}};f.onbeforeunload=function(){if("undefined"!=typeof vApp.storage.wholeStoreData){var a=JSON.parse(vApp.storage.wholeStoreData);a.beforeRefresh=!0;vApp.storage.wholeStore(a,"put")}localStorage.removeItem("otherRole");vApp.wb.utility.userIds=[];cthis.sendMessage("bye");b.disconnect()}})(window);(function(f){var b={requestPackets:function(a){1<a.length&&(vApp.wb.gObj.myArr=a);vApp.wb.sentReq=!0;return[vApp.wb.gObj.rcvdPackId,a[0].uid]},makeQueue:function(a){vApp.wb.gObj.rcvdPackId!=vApp.wb.gObj.displayedObjId&&(vApp.wb.gObj.packQueue=vApp.wb.gObj.packQueue.concat(a.message.repObj))},sendPackets:function(a,b){if(0==a.message.getMsPckt[0])var c=-1;else for(c=0;c<vApp.wb.gObj.myrepObj.length&&a.message.getMsPckt[0]!=vApp.wb.gObj.myrepObj[c].uid;c++);for(c+=1;c<a.message.getMsPckt[1];c++)b.push(vApp.wb.gObj.myrepObj[c]);
return b},handleMissedPackets:function(a,d,c){c=this.removeDupObjs(c);vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.concat(c);b.sortingReplyObjs();a!=d&&vApp.storage.store(JSON.stringify(vApp.wb.gObj.replayObjs));this.containsIfQueuePacks(a,d,vApp.wb.gObj.displayedObjId,c)},removeDupObjs:function(a){0<vApp.wb.gObj.myArr.length&&(a[a.length-1].uid==vApp.wb.gObj.myArr[0].uid&&(vApp.wb.gObj.myArr[0].hasOwnProperty("cmd")||vApp.wb.gObj.myArr.shift()),a=a.concat(vApp.wb.gObj.myArr),vApp.wb.gObj.myArr=
[]);return a},containsIfQueuePacks:function(a,b,c,e){a!=b&&c+1!=e[0].uid&&0<vApp.wb.gObj.packQueue.length&&e[e.length-1].uid==vApp.wb.gObj.packQueue[0].uid&&(vApp.wb.gObj.packQueue=e.concat(vApp.wb.gObj.packQueue))},sortingReplyObjs:function(){vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.sort(function(a,b){return a.uid-b.uid})}};f.bridge=b})(window);(function(f){vcan.optimize={sendPacketWithOptimization:function(b,a,d){"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),vApp.wb.sentPackets+=b.length,1==a&&vApp.wb.utility.beforeSend(JSON.parse(b)),vApp.wb.utility.updateSentInformation(b,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=d&&(vApp.wb.sentPackets+=b.length,1==a&&io.send(JSON.parse(b)),vApp.wb.utility.updateSentInformation(b,!0),this.lastarrowtime=(new Date).getTime())},
doOptiMize:function(b){if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),b.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",b.clientX-vcan.main.offset.x,b.clientY-vcan.main.offset.y);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),b.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",b.clientX-vcan.main.offset.x,
b.clientY-vcan.main.offset.y),vcan.optimize.calculatePackets(lastmousemovetime,"m",b.clientX-vcan.main.offset.x,b.clientY-vcan.main.offset.y),lastmousemovetime=(new Date).getTime())},calculatePackets:function(b,a,d,c){b=vcan.makeStackObj(b,a,d,c);vApp.wb.uid++;b.uid=vApp.wb.uid;vcan.main.replayObjs.push(b);vApp.wb.utility.beforeSend({repObj:[b]});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(b);vApp.wb.utility.updateSentPackets(b)}}})(window);(function(f){f.response={reclaimRole:function(b,a){if(b!=a){vApp.wb.utility.removeToolBox();vApp.wb.utility.makeCanvasDisable();"undefined"!=typeof localStorage.teacherId&&localStorage.removeItem("teacherId");vApp.wb.utility.uniqueArrOfObjsToStudent();vApp.wb.view.disappearBox("Canvas");vApp.wb.view.disappearBox("drawArea");var d=document.getElementById("vcanvas");d.className=d.className.replace(/\bteacher\b/," ");d.className="student";localStorage.setItem("canvasDrwMsg",!0);vApp.vutil.chkValueInLocalStorage("orginialTeacherId")||
vApp.wb.utility.setCommandToolHeights(c,"decrement")}else{if(vApp.vutil.chkValueInLocalStorage("orginialTeacherId")){var c=localStorage.getItem("toolHeight");vApp.wb.utility.setCommandToolHeights(c,"increment")}vApp.wb.utility.uniqueArrOfObjsToTeacher();d=document.getElementById("vcanvas");d.className=d.className.replace(/\bstudent\b/," ");d.className="teacher";localStorage.canvasDrwMsg=!0}},assignRole:function(b,a,d,c){b!=a?(vApp.wb.socketOn=parseInt(d),vApp.wb.utility.setClass("vcanvas","socketon"),
vApp.wb.utility.assignRole(a),vApp.wb.utility.uniqueArrOfObjsToTeacher(),vApp.vutil.chkValueInLocalStorage("canvasDrwMsg")||(f.vApp.wb.view.canvasDrawMsg("Canvas"),f.vApp.wb.view.drawLabel("drawArea"),localStorage.setItem("canvasDrwMsg",!0)),b=document.getElementById("vcanvas"),b.className=b.className.replace(/\bstudent\b/," "),b.className="teacher",c=localStorage.getItem("toolHeight"),vApp.wb.utility.setCommandToolHeights(c,"increment")):(vApp.wb.utility.uniqueArrOfObjsToStudent(),vApp.vutil.chkValueInLocalStorage("orginalTeacherId")||
(b=document.getElementById("vcanvas"),b.className=b.className.replace(/\bteacher\b/," "),b.className="student"),null==localStorage.getItem("orginialTeacherId")&&vApp.wb.utility.setCommandToolHeights(c,"decrement"),localStorage.setItem("canvasDrwMsg",!0))},checkUser:function(b,a,d){"undefined"!=typeof vcan.teacher||d||vApp.wb.utility.makeCanvasDisable();vApp.wb.utility.initDefaultInfo(b,wbUser.role);vApp.wb.utility.makeUserAvailable(b.message.checkUser.e.clientLen)},clearAll:function(b,a,d,c){b!=a&&
(vApp.wb.tool=new vApp.wb.tool_obj("t_clearall"),vApp.wb.utility.t_clearallInit(),vApp.wb.utility.makeDefaultValue(),vApp.storage.clearStorageData());c&&vApp.wb.utility.updateRcvdInformation(d)},replayAll:function(){f.vApp.wb.vcan.main.replayObjs=vApp.wb.gObj.replayObjs;vApp.wb.utility.clearAll(!1);vApp.wb.toolInit("t_replay","fromFile")},createArrow:function(b,a){var d=vApp.wb.arrImg,c={};c.mp={x:b.x,y:b.y};vApp.wb.utility.drawArrowImg(d,c);a&&vApp.wb.utility.updateRcvdInformation(b)},replayObj:function(b){f.vApp.wb.vcan.main.replayObjs=
[];0<b.length&&vApp.wb.gObj.displayedObjId+1==b[0].uid&&(f.vApp.wb.vcan.main.replayObjs=b,vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket))},chunk:function(b,a,d){vApp.wb.bridge.handleMissedPackets(b,a,d)},repObjForMissedPkts:function(b){(0!=vApp.wb.gObj.rcvdPackId||0<vApp.wb.uid&&0==vApp.wb.gObj.rcvdPackId)&&("object"==typeof b||b instanceof Array)&&b[0].hasOwnProperty("uid")&&vApp.wb.gObj.rcvdPackId+1!=b[0].uid&&!b.hasOwnProperty("chunk")&&Number(vApp.wb.gObj.rcvdPackId)<
Number(b[0].uid)&&(b=vApp.wb.bridge.requestPackets(b),vApp.wb.utility.beforeSend({getMsPckt:b}))}}})(window);
